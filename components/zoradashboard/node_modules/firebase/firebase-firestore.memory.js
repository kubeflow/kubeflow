!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).firebase)}(this,function(xd){"use strict";try{!function(){function t(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var e=t(xd),r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var o=function(){return(o=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function y(t,s,a,u){return new(a=a||Promise)(function(n,e){function r(t){try{o(u.next(t))}catch(t){e(t)}}function i(t){try{o(u.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof a?e:new a(function(t){t(e)})).then(r,i)}o((u=u.apply(t,s||[])).next())})}function g(n,r){var i,o,s,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,(e=s?[2&e[0],s.value]:e)[0]){case 0:case 1:s=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,o=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){a.label=e[1];break}if(6===e[0]&&a.label<s[1]){a.label=s[1],s=e;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(e);break}s[2]&&a.ops.pop(),a.trys.pop();continue}e=r.call(n,a)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function s(t,e){for(var n=0,r=e.length,i=t.length;n<r;n++,i++)t[i]=e[n];return t}var a={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<t.length;i+=3){var o=t[i],s=i+1<t.length,a=s?t[i+1]:0,u=i+2<t.length,c=u?t[i+2]:0,h=(15&a)<<2|c>>6,c=63&c;u||(c=64,s||(h=64)),r.push(n[o>>2],n[(3&o)<<4|a>>4],n[h],n[c])}return r.join("")},encodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);i<128?e[n++]=i:(i<2048?e[n++]=i>>6|192:(55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128):e[n++]=i>>12|224,e[n++]=i>>6&63|128),e[n++]=63&i|128)}return e}(t),e)},decodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){for(var e=[],n=0,r=0;n<t.length;){var i,o,s,a=t[n++];a<128?e[r++]=String.fromCharCode(a):191<a&&a<224?(o=t[n++],e[r++]=String.fromCharCode((31&a)<<6|63&o)):239<a&&a<365?(i=((7&a)<<18|(63&(o=t[n++]))<<12|(63&(s=t[n++]))<<6|63&t[n++])-65536,e[r++]=String.fromCharCode(55296+(i>>10)),e[r++]=String.fromCharCode(56320+(1023&i))):(o=t[n++],s=t[n++],e[r++]=String.fromCharCode((15&a)<<12|(63&o)<<6|63&s))}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray:function(t,e){this.init_();for(var n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<t.length;){var o=n[t.charAt(i++)],s=i<t.length?n[t.charAt(i)]:0,a=++i<t.length?n[t.charAt(i)]:64,u=++i<t.length?n[t.charAt(i)]:64;if(++i,null==o||null==s||null==a||null==u)throw Error();r.push(o<<2|s>>4),64!==a&&(r.push(s<<4&240|a>>2),64!==u&&r.push(a<<6&192|u))}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),(this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t)>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};function h(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var i,u="FirebaseError",c=(n(l,i=Error),l);function l(t,e,n){e=i.call(this,e)||this;return e.code=t,e.customData=n,e.name=u,Object.setPrototypeOf(e,l.prototype),Error.captureStackTrace&&Error.captureStackTrace(e,f.prototype.create),e}var f=(p.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r,i=e[0]||{},o=this.service+"/"+t,t=this.errors[t],t=t?(r=i,t.replace(v,function(t,e){var n=r[e];return null!=n?String(n):"<"+e+"?>"})):"Error",t=this.serviceName+": "+t+" ("+o+").";return new c(o,t,i)},p);function p(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var d,v=/\{\$([^}]+)}/g;function m(t){return t&&t._delegate?t._delegate:t}(N=d=d||{})[N.DEBUG=0]="DEBUG",N[N.VERBOSE=1]="VERBOSE",N[N.INFO=2]="INFO",N[N.WARN=3]="WARN",N[N.ERROR=4]="ERROR",N[N.SILENT=5]="SILENT";function w(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),o=E[e];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[o].apply(console,s(["["+i+"]  "+t.name+":"],n))}}var b={debug:d.DEBUG,verbose:d.VERBOSE,info:d.INFO,warn:d.WARN,error:d.ERROR,silent:d.SILENT},_=d.INFO,E=((be={})[d.DEBUG]="log",be[d.VERBOSE]="log",be[d.INFO]="info",be[d.WARN]="warn",be[d.ERROR]="error",be),T=(Object.defineProperty(I.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in d))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),I.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?b[t]:t},Object.defineProperty(I.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),I.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,d.DEBUG],t)),this._logHandler.apply(this,s([this,d.DEBUG],t))},I.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,d.VERBOSE],t)),this._logHandler.apply(this,s([this,d.VERBOSE],t))},I.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,d.INFO],t)),this._logHandler.apply(this,s([this,d.INFO],t))},I.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,d.WARN],t)),this._logHandler.apply(this,s([this,d.WARN],t))},I.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,d.ERROR],t)),this._logHandler.apply(this,s([this,d.ERROR],t))},I);function I(t){this.name=t,this._logLevel=_,this._logHandler=w,this._userLogHandler=null}var S=function(t,e){return(S=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function A(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return{value:(t=t&&r>=t.length?void 0:t)&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var N,D="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},C={},R=D||self;function k(){}function O(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function L(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var P="closure_uid_"+(1e9*Math.random()>>>0),M=0;function F(t,e,n){return t.call.apply(t.bind,arguments)}function x(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function V(t,e,n){return(V=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?F:x).apply(null,arguments)}function U(e){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function q(t,o){function e(){}e.prototype=o.prototype,t.Z=o.prototype,t.prototype=new e,(t.prototype.constructor=t).Vb=function(t,e,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return o.prototype[e].apply(t,r)}}function j(){this.s=this.s,this.o=this.o}var B={};j.prototype.s=!1,j.prototype.na=function(){var t;!this.s&&(this.s=!0,this.M(),0)&&(t=this,t=Object.prototype.hasOwnProperty.call(t,P)&&t[P]||(t[P]=++M),delete B[t])},j.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var G=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},K=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function H(){return Array.prototype.concat.apply([],arguments)}function W(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function Q(t){return/^[\s\xa0]*$/.test(t)}var z,Y=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function X(t,e){return-1!=t.indexOf(e)}function J(t,e){return t<e?-1:e<t?1:0}t:{var $=R.navigator;if($){$=$.userAgent;if($){z=$;break t}}z=""}function Z(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function tt(t){var e,n={};for(e in t)n[e]=t[e];return n}var et="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function nt(t){for(var e,n,r=1;r<arguments.length;r++){for(e in n=arguments[r])t[e]=n[e];for(var i=0;i<et.length;i++)e=et[i],Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}}function rt(t){return rt[" "](t),t}rt[" "]=k;var it,ot=X(z,"Opera"),st=X(z,"Trident")||X(z,"MSIE"),at=X(z,"Edge"),ut=at||st,ct=X(z,"Gecko")&&!(X(z.toLowerCase(),"webkit")&&!X(z,"Edge"))&&!(X(z,"Trident")||X(z,"MSIE"))&&!X(z,"Edge"),ht=X(z.toLowerCase(),"webkit")&&!X(z,"Edge");function lt(){var t=R.document;return t?t.documentMode:void 0}t:{var ft="",pt=(pt=z,ct?/rv:([^\);]+)(\)|;)/.exec(pt):at?/Edge\/([\d\.]+)/.exec(pt):st?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(pt):ht?/WebKit\/(\S+)/.exec(pt):ot?/(?:Version)[ \/]?(\S+)/.exec(pt):void 0);if(pt&&(ft=pt?pt[1]:""),st){pt=lt();if(null!=pt&&pt>parseFloat(ft)){it=String(pt);break t}}it=ft}var dt={};function yt(){return t=function(){for(var t=0,e=Y(String(it)).split("."),n=Y("9").split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++)for(var o=e[i]||"",s=n[i]||"";o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],(0!=o[0].length||0!=s[0].length)&&(t=J(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||J(0==o[2].length,0==s[2].length)||J(o[2],s[2]),o=o[3],s=s[3],0==t););return 0<=t},e=dt,Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=t(9);var t,e}var gt=R.document&&st&&(lt()||parseInt(it,10))||void 0,vt=function(){if(!R.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{R.addEventListener("test",k,e),R.removeEventListener("test",k,e)}catch(t){}return t}();function mt(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}function wt(t,e){if(mt.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(ct){t:{try{rt(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:bt[t.pointerType]||"",this.state=t.state,(this.i=t).defaultPrevented&&wt.Z.h.call(this)}}mt.prototype.h=function(){this.defaultPrevented=!0},q(wt,mt);var bt={2:"touch",3:"pen",4:"mouse"};wt.prototype.h=function(){wt.Z.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var _t="closure_listenable_"+(1e6*Math.random()|0),Et=0;function Tt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ia=i,this.key=++Et,this.ca=this.fa=!1}function It(t){t.ca=!0,t.listener=null,t.proxy=null,t.src=null,t.ia=null}function St(t){this.src=t,this.g={},this.h=0}function At(t,e){var n,r,i,o=e.type;o in t.g&&(n=t.g[o],(i=0<=(r=G(n,e)))&&Array.prototype.splice.call(n,r,1),i&&(It(e),0==t.g[o].length&&(delete t.g[o],t.h--)))}function Nt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.ca&&o.listener==e&&o.capture==!!n&&o.ia==r)return i}return-1}St.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.g[o])||(t=this.g[o]=[],this.h++);var s=Nt(t,e,r,i);return-1<s?(e=t[s],n||(e.fa=!1)):((e=new Tt(e,this.src,o,!!r,i)).fa=n,t.push(e)),e};var Dt="closure_lm_"+(1e6*Math.random()|0),Ct={};function Rt(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}r=xt(r);return e&&e[_t]?e.O(n,r,L(i)?!!i.capture:!!i,o):kt(e,n,r,!0,i,o)}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Rt(t,e[o],n,r,i);return null}return n=xt(n),t&&t[_t]?t.N(e,n,L(r)?!!r.capture:!!r,i):kt(t,e,n,!1,r,i)}function kt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s,a=L(i)?!!i.capture:!!i,u=Mt(t);if(u||(t[Dt]=u=new St(t)),(n=u.add(e,n,r,a,o)).proxy)return n;if(s=Pt,(n.proxy=r=function t(e){return s.call(t.src,t.listener,e)}).src=t,r.listener=n,t.addEventListener)void 0===(i=!vt?a:i)&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Lt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Ot(t){var e,n,r;"number"!=typeof t&&t&&!t.ca&&((e=t.src)&&e[_t]?At(e.i,t):(n=t.type,r=t.proxy,e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Lt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Mt(e))?(At(n,t),0==n.h&&(n.src=null,e[Dt]=null)):It(t)))}function Lt(t){return t in Ct?Ct[t]:Ct[t]="on"+t}function Pt(t,e){var n,r;return t=!!t.ca||(e=new wt(e,this),n=t.listener,r=t.ia||t.src,t.fa&&Ot(t),n.call(r,e))}function Mt(t){return(t=t[Dt])instanceof St?t:null}var Ft="__closure_events_fn_"+(1e9*Math.random()>>>0);function xt(e){return"function"==typeof e?e:(e[Ft]||(e[Ft]=function(t){return e.handleEvent(t)}),e[Ft])}function Vt(){j.call(this),this.i=new St(this),(this.P=this).I=null}function Ut(t,e){var n,r=t.I;if(r)for(n=[];r;r=r.I)n.push(r);if(t=t.P,r=e.type||e,"string"==typeof e?e=new mt(e,t):e instanceof mt?e.target=e.target||t:(s=e,nt(e=new mt(r,t),s)),s=!0,n)for(var i=n.length-1;0<=i;i--)var o=e.g=n[i],s=qt(o,r,!0,e)&&s;if(s=qt(o=e.g=t,r,!0,e)&&s,s=qt(o,r,!1,e)&&s,n)for(i=0;i<n.length;i++)s=qt(o=e.g=n[i],r,!1,e)&&s}function qt(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s,a,u=e[o];u&&!u.ca&&u.capture==n&&(s=u.listener,a=u.ia||u.src,u.fa&&At(t.i,u),i=!1!==s.call(a,r)&&i)}return i&&!r.defaultPrevented}q(Vt,j),Vt.prototype[_t]=!0,Vt.prototype.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=L(i)?!!i.capture:!!i,r=xt(r),e&&e[_t]?(e=e.i,(n=String(n).toString())in e.g&&-1<(r=Nt(s=e.g[n],r,i,o))&&(It(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.g[n],e.h--))):(e=e&&Mt(e))&&(n=e.g[n.toString()],(r=(e=-1)<(e=n?Nt(n,r,i,o):e)?n[e]:null)&&Ot(r))}(this,t,e,n,r)},Vt.prototype.M=function(){if(Vt.Z.M.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)It(n[r]);delete e.g[t],e.h--}}this.I=null},Vt.prototype.N=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},Vt.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};var jt=R.JSON.stringify;var Bt=(Gt.prototype.add=function(t,e){var n=Kt.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n},Gt);function Gt(){this.h=this.g=null}var Kt=(Ht.prototype.get=function(){var t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t},new Ht(function(){return new Qt},function(t){return t.reset()}));function Ht(t,e){this.i=t,this.j=e,this.h=0,this.g=null}var Wt,Qt=(zt.prototype.set=function(t,e){this.h=t,this.g=e,this.next=null},zt.prototype.reset=function(){this.next=this.g=this.h=null},zt);function zt(){this.next=this.g=this.h=null}function Yt(t,e){var n;Wt||(n=R.Promise.resolve(void 0),Wt=function(){n.then($t)}),Xt||(Wt(),Xt=!0),Jt.add(t,e)}var Xt=!1,Jt=new Bt;function $t(){for(var t;e=t=void 0,e=null,(t=Jt).g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),t=e;){try{t.h.call(t.g)}catch(t){!function(t){R.setTimeout(function(){throw t},0)}(t)}var e=Kt;e.j(t),e.h<100&&(e.h++,t.next=e.g,e.g=t)}Xt=!1}function Zt(t,e){Vt.call(this),this.h=t||1,this.g=e||R,this.j=V(this.kb,this),this.l=Date.now()}function te(t){t.da=!1,t.S&&(t.g.clearTimeout(t.S),t.S=null)}function ee(t,e,n){if("function"==typeof t)n&&(t=V(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=V(t.handleEvent,t)}return 2147483647<Number(e)?-1:R.setTimeout(t,e||0)}q(Zt,Vt),(N=Zt.prototype).da=!1,N.S=null,N.kb=function(){var t;this.da&&(0<(t=Date.now()-this.l)&&t<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-t):(this.S&&(this.g.clearTimeout(this.S),this.S=null),Ut(this,"tick"),this.da&&(te(this),this.start())))},N.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},N.M=function(){Zt.Z.M.call(this),te(this),delete this.g};var ne,re=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}S(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(ie,ne=j),ie.prototype.l=function(t){this.h=arguments,this.g?this.i=!0:function t(e){e.g=ee(function(){e.g=null,e.i&&(e.i=!1,t(e))},e.j);var n=e.h;e.h=null,e.m.apply(null,n)}(this)},ie.prototype.M=function(){ne.prototype.M.call(this),this.g&&(R.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)},ie);function ie(t,e){var n=ne.call(this)||this;return n.m=t,n.j=e,n.h=null,n.i=!1,n.g=null,n}function oe(t){j.call(this),this.h=t,this.g={}}q(oe,j);var se=[];function ae(t,e,n,r){Array.isArray(n)||(n&&(se[0]=n.toString()),n=se);for(var i=0;i<n.length;i++){var o=Rt(e,n[i],r||t.handleEvent,!1,t.h||t);if(!o)break;t.g[o.key]=o}}function ue(t){Z(t.g,function(t,e){this.g.hasOwnProperty(e)&&Ot(t)},t),t.g={}}function ce(){this.g=!0}function he(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(r.length<2)){var i=r[1];if(Array.isArray(i)&&!(i.length<1)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return jt(n)}catch(t){return e}}(t,n)+(r?" "+r:"")})}oe.prototype.M=function(){oe.Z.M.call(this),ue(this)},oe.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},ce.prototype.Aa=function(){this.g=!1},ce.prototype.info=function(){};var le={},fe=null;function pe(){return fe=fe||new Vt}function de(t){mt.call(this,le.Ma,t)}function ye(){var t=pe();Ut(t,new de(t))}function ge(t,e){mt.call(this,le.STAT_EVENT,t),this.stat=e}function ve(t){var e=pe();Ut(e,new ge(e,t))}function me(t,e){mt.call(this,le.Na,t),this.size=e}function we(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return R.setTimeout(function(){t()},e)}le.Ma="serverreachability",q(de,mt),le.STAT_EVENT="statevent",q(ge,mt),le.Na="timingevent",q(me,mt);var be={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},D={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function _e(){}function Ee(t){return t.h||(t.h=t.i())}function Te(){}_e.prototype.h=null;Bt={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function Ie(){mt.call(this,"d")}function Se(){mt.call(this,"c")}function Ae(){}function Ne(t,e,n,r){this.l=t,this.j=e,this.m=n,this.X=r||1,this.V=new oe(this),this.P=Re,this.W=new Zt(t=ut?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new De}function De(){this.i=null,this.g="",this.h=!1}q(Ie,mt),q(Se,mt),q(Ae,_e),Ae.prototype.g=function(){return new XMLHttpRequest},Ae.prototype.i=function(){return{}};var Ce=new Ae,Re=45e3,ke={},Oe={};function Le(t,e,n){t.K=1,t.v=en(Ye(e)),t.s=n,t.U=!0,Pe(t,null)}function Pe(t,e){t.F=Date.now(),xe(t),t.A=Ye(t.v);var s,a,u,c,h,l,n=t.A,r=t.X;Array.isArray(r)||(r=[String(r)]),yn(n.h,"t",r),t.C=0,n=t.l.H,t.h=new De,t.g=gr(t.l,n?e:null,!t.s),0<t.O&&(t.L=new re(V(t.Ia,t,t.g),t.O)),ae(t.V,t.g,"readystatechange",t.gb),e=t.H?tt(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.s,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),ye(),s=t.j,a=t.u,u=t.A,c=t.m,h=t.X,l=t.s,s.info(function(){if(s.g)if(l)for(var t="",e=l.split("&"),n=0;n<e.length;n++){var r,i,o=e[n].split("=");1<o.length&&(r=o[0],o=o[1],t=2<=(i=r.split("_")).length&&"type"==i[1]?t+(r+"=")+o+"&":t+(r+"=redacted&"))}else t=null;else t=l;return"XMLHTTP REQ ("+c+") [attempt "+h+"]: "+a+"\n"+u+"\n"+t})}function Me(t){return t.g&&("GET"==t.u&&2!=t.K&&t.l.Ba)}function Fe(t,e,n){for(var r,i,o,s,a,u=!0;!t.I&&t.C<n.length;){if(o=n,a=s=void 0,s=(i=t).C,(r=-1==(a=o.indexOf("\n",s))?Oe:(s=Number(o.substring(s,a)),isNaN(s)?ke:(a+=1)+s>o.length?Oe:(o=o.substr(a,s),i.C=a+s,o)))==Oe){4==e&&(t.o=4,ve(14),u=!1),he(t.j,t.m,null,"[Incomplete Response]");break}if(r==ke){t.o=4,ve(15),he(t.j,t.m,n,"[Invalid Chunk]"),u=!1;break}he(t.j,t.m,r,null),Be(t,r)}Me(t)&&r!=Oe&&r!=ke&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,ve(16),u=!1),t.i=t.i&&u,u?0<n.length&&!t.aa&&(t.aa=!0,(e=t.l).g==t&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),ur(e),e.L=!0,ve(11))):(he(t.j,t.m,n,"[Invalid Chunked Response]"),je(t),qe(t))}function xe(t){t.Y=Date.now()+t.P,Ve(t,t.P)}function Ve(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=we(V(t.eb,t),e)}function Ue(t){t.B&&(R.clearTimeout(t.B),t.B=null)}function qe(t){0==t.l.G||t.I||lr(t.l,t)}function je(t){Ue(t);var e=t.L;e&&"function"==typeof e.na&&e.na(),t.L=null,te(t.W),ue(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function Be(t,e){try{var n=t.l;if(0!=n.G&&(n.g==t||Tn(n.i,t)))if(n.I=t.N,!t.J&&Tn(n.i,t)&&3==n.G){try{var r=n.Ca.g.parse(e)}catch(y){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;hr(n),Zn(n)}ar(n),ve(18)}}else n.ta=i[1],0<n.ta-n.U&&i[2]<37500&&n.N&&0==n.A&&!n.v&&(n.v=we(V(n.ab,n),6e3));if(En(n.i)<=1&&n.ka){try{n.ka()}catch(y){}n.ka=void 0}}else pr(n,11)}else if(!t.J&&n.g!=t||hr(n),!Q(e))for(i=n.Ca.g.parse(e),e=0;e<i.length;e++){var o,s,a,u,c,h,l,f,p,d,y=i[e];n.U=y[0],y=y[1],2==n.G?"c"==y[0]?(n.J=y[1],n.la=y[2],null!=(o=y[3])&&(n.ma=o,n.h.info("VER="+n.ma)),null!=(s=y[4])&&(n.za=s,n.h.info("SVER="+n.za)),null!=(a=y[5])&&"number"==typeof a&&0<a&&(r=1.5*a,n.K=r,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n,(u=t.g)&&(!(c=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null)||!(h=r.i).g&&(X(c,"spdy")||X(c,"quic")||X(c,"h2"))&&(h.j=h.l,h.g=new Set,h.h&&(In(h,h.h),h.h=null)),!r.D||(l=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null)&&(r.sa=l,tn(r.F,r.D,l))),n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-t.F,n.h.info("Handshake RTT: "+n.O+"ms")),f=t,(r=n).oa=yr(r,r.H?r.la:null,r.W),f.J?(Sn(r.i,f),p=f,(d=r.K)&&p.setTimeout(d),p.B&&(Ue(p),xe(p)),r.g=f):sr(r),0<n.l.length&&nr(n)):"stop"!=y[0]&&"close"!=y[0]||pr(n,7):3==n.G&&("stop"==y[0]||"close"==y[0]?"stop"==y[0]?pr(n,7):$n(n):"noop"!=y[0]&&n.j&&n.j.wa(y),n.A=0)}ye()}catch(y){}}function Ge(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(O(t)||"string"==typeof t)K(t,e,void 0);else{if(t.T&&"function"==typeof t.T)var n=t.T();else if(t.R&&"function"==typeof t.R)n=void 0;else if(O(t)||"string"==typeof t)for(var n=[],r=t.length,i=0;i<r;i++)n.push(i);else for(i in n=[],r=0,t)n[r++]=i;for(var i=(r=function(t){if(t.R&&"function"==typeof t.R)return t.R();if("string"==typeof t)return t.split("");if(O(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length,o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Ke(t,e){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Ke)for(n=t.T(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function He(t){if(t.i!=t.g.length){for(var e=0,n=0;e<t.g.length;){var r=t.g[e];We(t.h,r)&&(t.g[n++]=r),e++}t.g.length=n}if(t.i!=t.g.length){for(var i={},n=e=0;e<t.g.length;)We(i,r=t.g[e])||(i[t.g[n++]=r]=1),e++;t.g.length=n}}function We(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(N=Ne.prototype).setTimeout=function(t){this.P=t},N.gb=function(t){t=t.target;var e=this.L;e&&3==Qn(t)?e.l():this.Ia(t)},N.Ia=function(t){try{if(t==this.g)t:{var e=Qn(this.g),n=this.g.Da();this.g.ba();if(!(e<3)&&(3!=e||ut||this.g&&(this.h.h||this.g.ga()||zn(this.g)))){this.I||4!=e||7==n||ye(),Ue(this);var r=this.g.ba();this.N=r;e:if(Me(this)){var i=zn(this.g);t="";var o=i.length,s=4==Qn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){je(this),qe(this);var a="";break e}this.h.i=new R.TextDecoder}for(n=0;n<o;n++)this.h.h=!0,t+=this.h.i.decode(i[n],{stream:s&&n==o-1});i.splice(0,o),this.h.g+=t,this.C=0,a=this.h.g}else a=this.g.ga();if(this.i=200==r,l=this.j,f=this.u,p=this.A,d=this.m,y=this.X,g=e,v=r,l.info(function(){return"XMLHTTP RESP ("+d+") [ attempt "+y+"]: "+f+"\n"+p+"\n"+g+" "+v}),this.i){if(this.$&&!this.J){e:{if(this.g){var u,c=this.g;if((u=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Q(u)){var h=u;break e}}h=null}if(!(r=h)){this.i=!1,this.o=3,ve(12),je(this),qe(this);break t}he(this.j,this.m,r,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Be(this,r)}this.U?(Fe(this,e,a),ut&&this.i&&3==e&&(ae(this.V,this.W,"tick",this.fb),this.W.start())):(he(this.j,this.m,a,null),Be(this,a)),4==e&&je(this),this.i&&!this.I&&(4==e?lr(this.l,this):(this.i=!1,xe(this)))}else 400==r&&0<a.indexOf("Unknown SID")?(this.o=3,ve(12)):(this.o=0,ve(13)),je(this),qe(this)}}}catch(e){}var l,f,p,d,y,g,v},N.fb=function(){var t,e;this.g&&(t=Qn(this.g),e=this.g.ga(),this.C<e.length&&(Ue(this),Fe(this,t,e),this.i&&4!=t&&xe(this)))},N.cancel=function(){this.I=!0,je(this)},N.eb=function(){this.B=null;var t,e,n=Date.now();0<=n-this.Y?(t=this.j,e=this.A,t.info(function(){return"TIMEOUT: "+e}),2!=this.K&&(ye(),ve(17)),je(this),this.o=2,qe(this)):Ve(this,this.Y-n)},(N=Ke.prototype).R=function(){He(this);for(var t=[],e=0;e<this.g.length;e++)t.push(this.h[this.g[e]]);return t},N.T=function(){return He(this),this.g.concat()},N.get=function(t,e){return We(this.h,t)?this.h[t]:e},N.set=function(t,e){We(this.h,t)||(this.i++,this.g.push(t)),this.h[t]=e},N.forEach=function(t,e){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Qe=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function ze(t,e){var n;this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,t instanceof ze?(this.g=void 0!==e?e:t.g,Xe(this,t.j),this.s=t.s,Je(this,t.i),$e(this,t.m),this.l=t.l,e=t.h,(n=new ln).i=e.i,e.g&&(n.g=new Ke(e.g),n.h=e.h),Ze(this,n),this.o=t.o):t&&(n=String(t).match(Qe))?(this.g=!!e,Xe(this,n[1]||"",!0),this.s=nn(n[2]||""),Je(this,n[3]||"",!0),$e(this,n[4]),this.l=nn(n[5]||"",!0),Ze(this,n[6]||"",!0),this.o=nn(n[7]||"")):(this.g=!!e,this.h=new ln(null,this.g))}function Ye(t){return new ze(t)}function Xe(t,e,n){t.j=n?nn(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function Je(t,e,n){t.i=n?nn(e,!0):e}function $e(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.m=e}else t.m=null}function Ze(t,e,n){var r,i;e instanceof ln?(t.h=e,r=t.h,(i=t.g)&&!r.j&&(fn(r),r.i=null,r.g.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(pn(this,e),yn(this,n,t))},r)),r.j=i):(n||(e=rn(e,cn)),t.h=new ln(e,t.g))}function tn(t,e,n){t.h.set(e,n)}function en(t){return tn(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function nn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function rn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,on),t=n?t.replace(/%25([0-9a-fA-F]{2})/g,"%$1"):t):null}function on(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}ze.prototype.toString=function(){var t=[],e=this.j;e&&t.push(rn(e,sn,!0),":");var n=this.i;return!n&&"file"!=e||(t.push("//"),(e=this.s)&&t.push(rn(e,sn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&t.push("/"),t.push(rn(n,"/"==n.charAt(0)?un:an,!0))),(n=this.h.toString())&&t.push("?",n),(n=this.o)&&t.push("#",rn(n,hn)),t.join("")};var sn=/[#\/\?@]/g,an=/[#\?:]/g,un=/[#\?]/g,cn=/[#\?@]/g,hn=/#/g;function ln(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function fn(n){n.g||(n.g=new Ke,n.h=0,n.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r,i=t[n].indexOf("="),o=null;0<=i?(r=t[n].substring(0,i),o=t[n].substring(i+1)):r=t[n],e(r,o?decodeURIComponent(o.replace(/\+/g," ")):"")}}}(n.i,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function pn(t,e){fn(t),e=gn(t,e),We(t.g.h,e)&&(t.i=null,t.h-=t.g.get(e).length,We((t=t.g).h,e)&&(delete t.h[e],t.i--,t.g.length>2*t.i&&He(t)))}function dn(t,e){return fn(t),e=gn(t,e),We(t.g.h,e)}function yn(t,e,n){pn(t,e),0<n.length&&(t.i=null,t.g.set(gn(t,e),W(n)),t.h+=n.length)}function gn(t,e){return e=String(e),e=t.j?e.toLowerCase():e}(N=ln.prototype).add=function(t,e){fn(this),this.i=null,t=gn(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},N.forEach=function(n,r){fn(this),this.g.forEach(function(t,e){K(t,function(t){n.call(r,t,e,this)},this)},this)},N.T=function(){fn(this);for(var t=this.g.R(),e=this.g.T(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},N.R=function(t){fn(this);var e=[];if("string"==typeof t)dn(this,t)&&(e=H(e,this.g.get(gn(this,t))));else{t=this.g.R();for(var n=0;n<t.length;n++)e=H(e,t[n])}return e},N.set=function(t,e){return fn(this),this.i=null,dn(this,t=gn(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},N.get=function(t,e){return t&&0<(t=this.R(t)).length?String(t[0]):e},N.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var t=[],e=this.g.T(),n=0;n<e.length;n++)for(var r=e[n],i=encodeURIComponent(String(r)),r=this.R(r),o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}return this.i=t.join("&")};var vn=function(t,e){this.h=t,this.g=e};function mn(t){this.l=t||bn,t=R.PerformanceNavigationTiming?0<(t=R.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(R.g&&R.g.Ea&&R.g.Ea()&&R.g.Ea().Zb),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var wn,bn=10;function _n(t){return t.h||t.g&&t.g.size>=t.j}function En(t){return t.h?1:t.g?t.g.size:0}function Tn(t,e){return t.h?t.h==e:t.g&&t.g.has(e)}function In(t,e){t.g?t.g.add(e):t.h=e}function Sn(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function An(t){var e,n;if(null!=t.h)return t.i.concat(t.h.D);if(null==t.g||0===t.g.size)return W(t.i);var r=t.i;try{for(var i=A(t.g.values()),o=i.next();!o.done;o=i.next())var s=o.value,r=r.concat(s.D)}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function Nn(){}function Dn(){this.g=new Nn}function Cn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}function Rn(t){this.l=t.$b||null,this.j=t.ib||!1}function kn(t,e){Vt.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=On,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}mn.prototype.cancel=function(){var e,t;if(this.i=An(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){try{for(var n=A(this.g.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.g.clear()}},Nn.prototype.stringify=function(t){return R.JSON.stringify(t,void 0)},Nn.prototype.parse=function(t){return R.JSON.parse(t,void 0)},q(Rn,_e),Rn.prototype.g=function(){return new kn(this.l,this.j)},Rn.prototype.i=(wn={},function(){return wn}),q(kn,Vt);var On=0;function Ln(t){t.j.read().then(t.Sa.bind(t)).catch(t.ha.bind(t))}function Pn(t){t.readyState=4,t.l=null,t.j=null,t.A=null,Mn(t)}function Mn(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(N=kn.prototype).open=function(t,e){if(this.readyState!=On)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,Mn(this)},N.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||R).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},N.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Pn(this)),this.readyState=On},N.Va=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,Mn(this)),this.g&&(this.readyState=3,Mn(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==R.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Ln(this)}else t.text().then(this.Ua.bind(this),this.ha.bind(this))},N.Sa=function(t){var e;this.g&&(this.u&&t.value?this.response.push(t.value):this.u||(e=t.value||new Uint8Array(0),(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)),(t.done?Pn:Mn)(this),3==this.readyState&&Ln(this))},N.Ua=function(t){this.g&&(this.response=this.responseText=t,Pn(this))},N.Ta=function(t){this.g&&(this.response=t,Pn(this))},N.ha=function(){this.g&&Pn(this)},N.setRequestHeader=function(t,e){this.v.append(t,e)},N.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},N.getAllResponseHeaders=function(){if(!this.h)return"";for(var t=[],e=this.h.entries(),n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(kn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var Fn=R.JSON.parse;function xn(t){Vt.call(this),this.headers=new Ke,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Vn,this.K=this.L=!1}q(xn,Vt);var Vn="",Un=/^https?$/i,qn=["POST","PUT"];function jn(t){return"content-type"==t.toLowerCase()}function Bn(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Gn(t),Hn(t)}function Gn(t){t.D||(t.D=!0,Ut(t,"complete"),Ut(t,"error"))}function Kn(t){if(t.h&&void 0!==C&&(!t.C[1]||4!=Qn(t)||2!=t.ba()))if(t.v&&4==Qn(t))ee(t.Fa,0,t);else if(Ut(t,"readystatechange"),4==Qn(t)){t.h=!1;try{var e,n,r,i,o=t.ba();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var s=!0;break t;default:s=!1}if((e=s)||((n=0===o)&&(!(i=String(t.H).match(Qe)[1]||null)&&R.self&&R.self.location&&(i=(r=R.self.location.protocol).substr(0,r.length-1)),n=!Un.test(i?i.toLowerCase():"")),e=n),e)Ut(t,"complete"),Ut(t,"success");else{t.m=6;try{var a=2<Qn(t)?t.g.statusText:""}catch(t){a=""}t.j=a+" ["+t.ba()+"]",Gn(t)}}finally{Hn(t)}}}function Hn(t,e){if(t.g){Wn(t);var n=t.g,r=t.C[0]?k:null;t.g=null,t.C=null,e||Ut(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function Wn(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(R.clearTimeout(t.A),t.A=null)}function Qn(t){return t.g?t.g.readyState:0}function zn(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case Vn:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Yn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}var i;r||(i="",Z(n,function(t,e){i+=e,i+=":",i+=t,i+="\r\n"}),n=i,"string"==typeof t?null!=n&&encodeURIComponent(String(n)):tn(t,e,n))}function Xn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Jn(t){this.za=0,this.l=[],this.h=new ce,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Xn("failFast",!1,t),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Xn("baseRetryDelayMs",5e3,t),this.$a=Xn("retryDelaySeedMs",1e4,t),this.Ya=Xn("forwardChannelMaxRetries",2,t),this.ra=Xn("forwardChannelRequestTimeoutMs",2e4,t),this.qa=t&&t.xmlHttpFactory||void 0,this.Ba=t&&t.Yb||!1,this.K=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.J="",this.i=new mn(t&&t.concurrentRequestLimit),this.Ca=new Dn,this.ja=t&&t.fastHandshake||!1,this.Ra=t&&t.Wb||!1,t&&t.Aa&&this.h.Aa(),t&&t.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&t&&t.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!t||!1!==t.Xb}function $n(t){var e,n;tr(t),3==t.G&&(e=t.V++,tn(n=Ye(t.F),"SID",t.J),tn(n,"RID",e),tn(n,"TYPE","terminate"),ir(t,n),(e=new Ne(t,t.h,e,void 0)).K=2,e.v=en(Ye(n)),n=!1,!(n=R.navigator&&R.navigator.sendBeacon?R.navigator.sendBeacon(e.v.toString(),""):n)&&R.Image&&((new Image).src=e.v,n=!0),n||(e.g=gr(e.l,null),e.g.ea(e.v)),e.F=Date.now(),xe(e)),dr(t)}function Zn(t){t.g&&(ur(t),t.g.cancel(),t.g=null)}function tr(t){Zn(t),t.u&&(R.clearTimeout(t.u),t.u=null),hr(t),t.i.cancel(),t.m&&("number"==typeof t.m&&R.clearTimeout(t.m),t.m=null)}function er(t,e){t.l.push(new vn(t.Za++,e)),3==t.G&&nr(t)}function nr(t){_n(t.i)||t.m||(t.m=!0,Yt(t.Ha,t),t.C=0)}function rr(t,e){var n=e?e.m:t.V++,r=Ye(t.F);tn(r,"SID",t.J),tn(r,"RID",n),tn(r,"AID",t.U),ir(t,r),t.o&&t.s&&Yn(r,t.o,t.s),n=new Ne(t,t.h,n,t.C+1),null===t.o&&(n.H=t.s),e&&(t.l=e.D.concat(t.l)),e=or(t,n,1e3),n.setTimeout(Math.round(.5*t.ra)+Math.round(.5*t.ra*Math.random())),In(t.i,n),Le(n,r,e)}function ir(t,n){t.j&&Ge({},function(t,e){tn(n,e,t)})}function or(t,e,n){n=Math.min(t.l.length,n);var r=t.j?V(t.j.Oa,t.j,t):null;t:for(var i=t.l,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].h,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var c=i[u].h,h=i[u].g;if((c-=o)<0)o=Math.max(0,i[u].h-100),a=!1;else try{!function(t,r,e){var i=e||"";try{Ge(t,function(t,e){var n=t;L(t)&&(n=jt(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}(h,s,"req"+c+"_")}catch(t){r&&r(h)}}if(a){r=s.join("&");break t}}return t=t.l.splice(0,n),e.D=t,r}function sr(t){t.g||t.u||(t.Y=1,Yt(t.Ga,t),t.A=0)}function ar(t){return!(t.g||t.u||3<=t.A)&&(t.Y++,t.u=we(V(t.Ga,t),fr(t,t.A)),t.A++,1)}function ur(t){null!=t.B&&(R.clearTimeout(t.B),t.B=null)}function cr(t){t.g=new Ne(t,t.h,"rpc",t.Y),null===t.o&&(t.g.H=t.s),t.g.O=0;var e=Ye(t.oa);tn(e,"RID","rpc"),tn(e,"SID",t.J),tn(e,"CI",t.N?"0":"1"),tn(e,"AID",t.U),ir(t,e),tn(e,"TYPE","xmlhttp"),t.o&&t.s&&Yn(e,t.o,t.s),t.K&&t.g.setTimeout(t.K);var n=t.g;t=t.la,n.K=1,n.v=en(Ye(e)),n.s=null,n.U=!0,Pe(n,t)}function hr(t){null!=t.v&&(R.clearTimeout(t.v),t.v=null)}function lr(t,e){var n,r,i,o=null;if(t.g==e){hr(t),ur(t),t.g=null;var s=2}else{if(!Tn(t.i,e))return;o=e.D,Sn(t.i,e),s=1}if(t.I=e.N,0!=t.G)if(e.i)1==s?(o=e.s?e.s.length:0,e=Date.now()-e.F,n=t.C,Ut(s=pe(),new me(s,o)),nr(t)):sr(t);else if(3==(n=e.o)||0==n&&0<t.I||(1!=s||(i=e,En((r=t).i)>=r.i.j-(r.m?1:0)||(r.m?(r.l=i.D.concat(r.l),0):1==r.G||2==r.G||r.C>=(r.Xa?0:r.Ya)||(r.m=we(V(r.Ha,r,i),fr(r,r.C)),r.C++,0))))&&(2!=s||!ar(t)))switch(o&&0<o.length&&(e=t.i,e.i=e.i.concat(o)),n){case 1:pr(t,5);break;case 4:pr(t,10);break;case 3:pr(t,6);break;default:pr(t,2)}}function fr(t,e){var n=t.Pa+Math.floor(Math.random()*t.$a);return t.j||(n*=2),n*e}function pr(t,e){var n,r,i,o;t.h.info("Error code "+e),2==e?(r=null,t.j&&(r=null),o=V(t.jb,t),r||(r=new ze("//www.google.com/images/cleardot.gif"),R.location&&"http"==R.location.protocol||Xe(r,"https"),en(r)),n=r.toString(),r=o,o=new ce,R.Image?((i=new Image).onload=U(Cn,o,i,"TestLoadImage: loaded",!0,r),i.onerror=U(Cn,o,i,"TestLoadImage: error",!1,r),i.onabort=U(Cn,o,i,"TestLoadImage: abort",!1,r),i.ontimeout=U(Cn,o,i,"TestLoadImage: timeout",!1,r),R.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=n):r(!1)):ve(2),t.G=0,t.j&&t.j.va(e),dr(t),tr(t)}function dr(t){t.G=0,t.I=-1,t.j&&(0==An(t.i).length&&0==t.l.length||(t.i.i.length=0,W(t.l),t.l.length=0),t.j.ua())}function yr(t,e,n){var r,i,o,s,a,u=(s=n)instanceof ze?Ye(s):new ze(s,void 0);return""!=u.i?(e&&Je(u,e+"."+u.i),$e(u,u.m)):(a=R.location,r=a.protocol,i=e?e+"."+a.hostname:a.hostname,o=+a.port,s=n,a=new ze(null,void 0),r&&Xe(a,r),i&&Je(a,i),o&&$e(a,o),s&&(a.l=s),u=a),t.aa&&Z(t.aa,function(t,e){tn(u,e,t)}),e=t.D,n=t.sa,e&&n&&tn(u,e,n),tn(u,"VER",t.ma),ir(t,u),u}function gr(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=n&&t.Ba&&!t.qa?new xn(new Rn({ib:!0})):new xn(t.qa)).L=t.H,e}function vr(){}function mr(){if(st&&!(10<=Number(gt)))throw Error("Environmental error: no available transport.")}function wr(t,e){Vt.call(this),this.g=new Jn(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.P=t,(t=e&&e.httpHeadersOverwriteParam)&&!Q(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Q(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&(e in(t=this.h)&&delete t[e])),this.j=new Er(this)}function br(t){Ie.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function _r(){Se.call(this),this.status=1}function Er(t){this.g=t}(N=xn.prototype).ea=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=(this.u||Ce).g(),this.C=this.u?Ee(this.u):Ee(Ce),this.g.onreadystatechange=V(this.Fa,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(t){return void Bn(this,t)}t=n||"";var i,o=new Ke(this.headers);r&&Ge(r,function(t,e){o.set(e,t)}),r=function(t){t:{for(var e=jn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:"string"==typeof t?t.charAt(e):t[e]}(o.T()),n=R.FormData&&t instanceof R.FormData,0<=G(qn,e)&&!r&&!n&&o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.g.setRequestHeader(e,t)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Wn(this),0<this.B&&((this.K=(i=this.g,st&&yt()&&"number"==typeof i.timeout&&void 0!==i.ontimeout))?(this.g.timeout=this.B,this.g.ontimeout=V(this.pa,this)):this.A=ee(this.pa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){Bn(this,t)}},N.pa=function(){void 0!==C&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Ut(this,"timeout"),this.abort(8))},N.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,Ut(this,"complete"),Ut(this,"abort"),Hn(this))},N.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Hn(this,!0)),xn.Z.M.call(this)},N.Fa=function(){this.s||(this.F||this.v||this.l?Kn(this):this.cb())},N.cb=function(){Kn(this)},N.ba=function(){try{return 2<Qn(this)?this.g.status:-1}catch(t){return-1}},N.ga=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},N.Qa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Fn(e)}},N.Da=function(){return this.m},N.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(N=Jn.prototype).ma=8,N.G=1,N.hb=function(t){try{this.h.info("Origin Trials invoked: "+t)}catch(t){}},N.Ha=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;var e=new Ne(this,this.h,t,void 0),n=this.s;if(this.P&&(n?nt(n=tt(n),this.P):n=this.P),null===this.o&&(e.H=n),this.ja)t:{for(var r=0,i=0;i<this.l.length;i++){var o=this.l[i];if("__data__"in o.g&&"string"==typeof(o=o.g.__data__)?o=o.length:o=void 0,void 0===o)break;if(4096<(r+=o)){r=i;break t}if(4096===r||i===this.l.length-1){r=i+1;break t}}r=1e3}else r=1e3;r=or(this,e,r),tn(i=Ye(this.F),"RID",t),tn(i,"CVER",22),this.D&&tn(i,"X-HTTP-Session-Id",this.D),ir(this,i),this.o&&n&&Yn(i,this.o,n),In(this.i,e),this.Ra&&tn(i,"TYPE","init"),this.ja?(tn(i,"$req",r),tn(i,"SID","null"),e.$=!0,Le(e,i,null)):Le(e,i,r),this.G=2}}else 3==this.G&&(t?rr(this,t):0==this.l.length||_n(this.i)||rr(this))},N.Ga=function(){var t;this.u=null,cr(this),this.$&&!(this.L||null==this.g||this.O<=0)&&(t=2*this.O,this.h.info("BP detection timer enabled: "+t),this.B=we(V(this.bb,this),t))},N.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,ve(10),Zn(this),cr(this))},N.ab=function(){null!=this.v&&(this.v=null,Zn(this),ar(this),ve(19))},N.jb=function(t){t?(this.h.info("Successfully pinged google.com"),ve(2)):(this.h.info("Failed to ping google.com"),ve(1))},(N=vr.prototype).xa=function(){},N.wa=function(){},N.va=function(){},N.ua=function(){},N.Oa=function(){},mr.prototype.g=function(t,e){return new wr(t,e)},q(wr,Vt),wr.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;t.Wa&&(t.h.info("Origin Trials enabled."),Yt(V(t.hb,t,e))),ve(0),t.W=e,t.aa=n||{},t.N=t.X,t.F=yr(t,null,t.W),nr(t)},wr.prototype.close=function(){$n(this.g)},wr.prototype.u=function(t){var e;"string"==typeof t?((e={}).__data__=t,er(this.g,e)):this.v?((e={}).__data__=jt(t),er(this.g,e)):er(this.g,t)},wr.prototype.M=function(){this.g.j=null,delete this.j,$n(this.g),delete this.g,wr.Z.M.call(this)},q(br,Ie),q(_r,Se),q(Er,vr),Er.prototype.xa=function(){Ut(this.g,"a")},Er.prototype.wa=function(t){Ut(this.g,new br(t))},Er.prototype.va=function(t){Ut(this.g,new _r)},Er.prototype.ua=function(){Ut(this.g,"b")},mr.prototype.createWebChannel=mr.prototype.g,wr.prototype.send=wr.prototype.u,wr.prototype.open=wr.prototype.m,be.NO_ERROR=0,be.TIMEOUT=8,be.HTTP_ERROR=6,D.COMPLETE="complete",(Te.EventType=Bt).OPEN="a",Bt.CLOSE="b",Bt.ERROR="c",Bt.MESSAGE="d",Vt.prototype.listen=Vt.prototype.N,xn.prototype.listenOnce=xn.prototype.O,xn.prototype.getLastError=xn.prototype.La,xn.prototype.getLastErrorCode=xn.prototype.Da,xn.prototype.getStatus=xn.prototype.ba,xn.prototype.getResponseJson=xn.prototype.Qa,xn.prototype.getResponseText=xn.prototype.ga,xn.prototype.send=xn.prototype.ea;var Tr=pe,Ir=be,Sr=D,Ar=le,Nr=10,Dr=11,Cr=Rn,Rr=Te,kr=xn,Or=(Lr.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},Lr.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},Lr);function Lr(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}Or.o=-1;var Pr,Mr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Fr=(n(Vr,Pr=Error),Vr),xr=new T("@firebase/firestore");function Vr(t,e){var n=this;return(n=Pr.call(this,e)||this).code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}function Ur(){return xr.logLevel}function qr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];xr.logLevel<=d.DEBUG&&(e=n.map(Gr),xr.debug.apply(xr,s(["Firestore (8.8.0): "+t],e)))}function jr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];xr.logLevel<=d.ERROR&&(e=n.map(Gr),xr.error.apply(xr,s(["Firestore (8.8.0): "+t],e)))}function Br(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];xr.logLevel<=d.WARN&&(e=n.map(Gr),xr.warn.apply(xr,s(["Firestore (8.8.0): "+t],e)))}function Gr(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function Kr(t){t="FIRESTORE (8.8.0) INTERNAL ASSERTION FAILED: "+(t=void 0===t?"Unexpected state":t);throw jr(t),new Error(t)}function Hr(t){t||Kr()}var Wr=(Qr.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=function(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},Qr);function Qr(){}function zr(t,e){return t<e?-1:e<t?1:0}function Yr(t,n,r){return t.length===n.length&&t.every(function(t,e){return r(t,n[e])})}var Xr=(Zr.now=function(){return Zr.fromMillis(Date.now())},Zr.fromDate=function(t){return Zr.fromMillis(t.getTime())},Zr.fromMillis=function(t){var e=Math.floor(t/1e3);return new Zr(e,Math.floor(1e6*(t-1e3*e)))},Zr.prototype.toDate=function(){return new Date(this.toMillis())},Zr.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},Zr.prototype._compareTo=function(t){return this.seconds===t.seconds?zr(this.nanoseconds,t.nanoseconds):zr(this.seconds,t.seconds)},Zr.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},Zr.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},Zr.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},Zr.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},Zr),Jr=($r.fromTimestamp=function(t){return new $r(t)},$r.min=function(){return new $r(new Xr(0,0))},$r.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},$r.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},$r.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},$r.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},$r.prototype.toTimestamp=function(){return this.timestamp},$r);function $r(t){this.timestamp=t}function Zr(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new Fr(Mr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new Fr(Mr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Fr(Mr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new Fr(Mr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}function ti(t){var e,n=0;for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&n++;return n}function ei(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function ni(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var ri,ii,D=(Object.defineProperty(di.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),di.prototype.isEqual=function(t){return 0===di.comparator(this,t)},di.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof di?t.forEach(function(t){e.push(t)}):e.push(t),this.construct(e)},di.prototype.limit=function(){return this.offset+this.length},di.prototype.popFirst=function(t){return this.construct(this.segments,this.offset+(t=void 0===t?1:t),this.length-t)},di.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},di.prototype.firstSegment=function(){return this.segments[this.offset]},di.prototype.lastSegment=function(){return this.get(this.length-1)},di.prototype.get=function(t){return this.segments[this.offset+t]},di.prototype.isEmpty=function(){return 0===this.length},di.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},di.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},di.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},di.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},di.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},di),oi=(n(pi,ii=D),pi.prototype.construct=function(t,e,n){return new pi(t,e,n)},pi.prototype.canonicalString=function(){return this.toArray().join("/")},pi.prototype.toString=function(){return this.canonicalString()},pi.fromString=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=[],r=0,i=t;r<i.length;r++){var o=i[r];if(0<=o.indexOf("//"))throw new Fr(Mr.INVALID_ARGUMENT,"Invalid segment ("+o+"). Paths must not contain // in them.");n.push.apply(n,o.split("/").filter(function(t){return 0<t.length}))}return new pi(n)},pi.emptyPath=function(){return new pi([])},pi),si=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ai=(n(fi,ri=D),fi.prototype.construct=function(t,e,n){return new fi(t,e,n)},fi.isValidIdentifier=function(t){return si.test(t)},fi.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),t=!fi.isValidIdentifier(t)?"`"+t+"`":t}).join(".")},fi.prototype.toString=function(){return this.canonicalString()},fi.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},fi.keyField=function(){return new fi(["__name__"])},fi.fromServerFormat=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new Fr(Mr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var s=t[r];if("\\"===s){if(r+1===t.length)throw new Fr(Mr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var a=t[r+1];if("\\"!==a&&"."!==a&&"`"!==a)throw new Fr(Mr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=a,r+=2}else"`"===s?o=!o:"."!==s||o?n+=s:i(),r++}if(i(),o)throw new Fr(Mr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new fi(e)},fi.emptyPath=function(){return new fi([])},fi),ui=(li.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},li.prototype.isEqual=function(t){return Yr(this.fields,t.fields,function(t,e){return t.isEqual(e)})},li),ci=(hi.fromBase64String=function(t){return new hi(atob(t))},hi.fromUint8Array=function(t){return new hi(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t))},hi.prototype.toBase64=function(){return t=this.binaryString,btoa(t);var t},hi.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},hi.prototype.approximateByteSize=function(){return 2*this.binaryString.length},hi.prototype.compareTo=function(t){return zr(this.binaryString,t.binaryString)},hi.prototype.isEqual=function(t){return this.binaryString===t.binaryString},hi);function hi(t){this.binaryString=t}function li(t){(this.fields=t).sort(ai.comparator)}function fi(){return null!==ri&&ri.apply(this,arguments)||this}function pi(){return null!==ii&&ii.apply(this,arguments)||this}function di(t,e,n){void 0===e?e=0:e>t.length&&Kr(),void 0===n?n=t.length-e:n>t.length-e&&Kr(),this.segments=t,this.offset=e,this.len=n}ci.EMPTY_BYTE_STRING=new ci("");var yi=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function gi(t){if(Hr(!!t),"string"!=typeof t)return{seconds:vi(t.seconds),nanos:vi(t.nanos)};var e=0,n=yi.exec(t);Hr(!!n),n[1]&&(n=((n=n[1])+"000000000").substr(0,9),e=Number(n));t=new Date(t);return{seconds:Math.floor(t.getTime()/1e3),nanos:e}}function vi(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function mi(t){return"string"==typeof t?ci.fromBase64String(t):ci.fromUint8Array(t)}function wi(t){return"server_timestamp"===(null===(t=((null===(t=null==t?void 0:t.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function bi(t){t=gi(t.mapValue.fields.__local_write_time__.timestampValue);return new Xr(t.seconds,t.nanos)}function _i(t){return null==t}function Ei(t){return 0===t&&1/t==-1/0}var Ti=(Ii.fromPath=function(t){return new Ii(oi.fromString(t))},Ii.fromName=function(t){return new Ii(oi.fromString(t).popFirst(5))},Ii.prototype.hasCollectionId=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},Ii.prototype.isEqual=function(t){return null!==t&&0===oi.comparator(this.path,t.path)},Ii.prototype.toString=function(){return this.path.toString()},Ii.comparator=function(t,e){return oi.comparator(t.path,e.path)},Ii.isDocumentKey=function(t){return t.length%2==0},Ii.fromSegments=function(t){return new Ii(new oi(t.slice()))},Ii);function Ii(t){this.path=t}function Si(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?wi(t)?4:10:Kr()}function Ai(r,i){var t,e,n=Si(r);if(n!==Si(i))return!1;switch(n){case 0:return!0;case 1:return r.booleanValue===i.booleanValue;case 4:return bi(r).isEqual(bi(i));case 3:return function(t){if("string"==typeof r.timestampValue&&"string"==typeof t.timestampValue&&r.timestampValue.length===t.timestampValue.length)return r.timestampValue===t.timestampValue;var e=gi(r.timestampValue),t=gi(t.timestampValue);return e.seconds===t.seconds&&e.nanos===t.nanos}(i);case 5:return r.stringValue===i.stringValue;case 6:return e=i,mi(r.bytesValue).isEqual(mi(e.bytesValue));case 7:return r.referenceValue===i.referenceValue;case 8:return t=i,vi((e=r).geoPointValue.latitude)===vi(t.geoPointValue.latitude)&&vi(e.geoPointValue.longitude)===vi(t.geoPointValue.longitude);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return vi(t.integerValue)===vi(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){t=vi(t.doubleValue),e=vi(e.doubleValue);return t===e?Ei(t)===Ei(e):isNaN(t)&&isNaN(e)}return!1}(r,i);case 9:return Yr(r.arrayValue.values||[],i.arrayValue.values||[],Ai);case 10:return function(){var t,e=r.mapValue.fields||{},n=i.mapValue.fields||{};if(ti(e)!==ti(n))return!1;for(t in e)if(e.hasOwnProperty(t)&&(void 0===n[t]||!Ai(e[t],n[t])))return!1;return!0}();default:return Kr()}}function Ni(t,e){return void 0!==(t.values||[]).find(function(t){return Ai(t,e)})}function Di(t,e){var n,r,i,o=Si(t),s=Si(e);if(o!==s)return zr(o,s);switch(o){case 0:return 0;case 1:return zr(t.booleanValue,e.booleanValue);case 2:return r=e,i=vi(t.integerValue||t.doubleValue),r=vi(r.integerValue||r.doubleValue),i<r?-1:r<i?1:i===r?0:isNaN(i)?isNaN(r)?0:-1:1;case 3:return Ci(t.timestampValue,e.timestampValue);case 4:return Ci(bi(t),bi(e));case 5:return zr(t.stringValue,e.stringValue);case 6:return function(t,e){t=mi(t),e=mi(e);return t.compareTo(e)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=zr(n[i],r[i]);if(0!==o)return o}return zr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return n=t.geoPointValue,i=e.geoPointValue,0!==(r=zr(vi(n.latitude),vi(i.latitude)))?r:zr(vi(n.longitude),vi(i.longitude));case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=Di(n[i],r[i]);if(o)return o}return zr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=zr(r[s],o[s]);if(0!==a)return a;a=Di(n[r[s]],i[o[s]]);if(0!==a)return a}return zr(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Kr()}}function Ci(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return zr(t,e);var n=gi(t),t=gi(e),e=zr(n.seconds,t.seconds);return 0!==e?e:zr(n.nanos,t.nanos)}function Ri(t){return function s(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){t=gi(t);return"time("+t.seconds+","+t.nanos+")"}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?mi(t.bytesValue).toBase64():"referenceValue"in t?(e=t.referenceValue,Ti.fromName(e).toString()):"geoPointValue"in t?"geo("+(e=t.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=s(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+s(t.fields[o])}return e+"}"}(t.mapValue):Kr();var e}(t)}function ki(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function Oi(t){return t&&"integerValue"in t}function Li(t){return!!t&&"arrayValue"in t}function Pi(t){return t&&"nullValue"in t}function Mi(t){return t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Fi(t){return t&&"mapValue"in t}function xi(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){var n={mapValue:{fields:{}}};return ei(t.mapValue.fields,function(t,e){return n.mapValue.fields[t]=xi(e)}),n}if(t.arrayValue){for(var e={arrayValue:{values:[]}},r=0;r<(t.arrayValue.values||[]).length;++r)e.arrayValue.values[r]=xi(t.arrayValue.values[r]);return e}return Object.assign({},t)}var Vi=(Ui.empty=function(){return new Ui({mapValue:{}})},Ui.prototype.field=function(t){if(t.isEmpty())return this.value;for(var e=this.value,n=0;n<t.length-1;++n)if(!Fi(e=(e.mapValue.fields||{})[t.get(n)]))return null;return(e=(e.mapValue.fields||{})[t.lastSegment()])||null},Ui.prototype.set=function(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=xi(e)},Ui.prototype.setAll=function(t){var r=this,i=ai.emptyPath(),o={},s=[];t.forEach(function(t,e){var n;i.isImmediateParentOf(e)||(n=r.getFieldsMap(i),r.applyChanges(n,o,s),o={},s=[],i=e.popLast()),t?o[e.lastSegment()]=xi(t):s.push(e.lastSegment())});t=this.getFieldsMap(i);this.applyChanges(t,o,s)},Ui.prototype.delete=function(t){var e=this.field(t.popLast());Fi(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]},Ui.prototype.isEqual=function(t){return Ai(this.value,t.value)},Ui.prototype.getFieldsMap=function(t){var e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(var n=0;n<t.length;++n){var r=e.mapValue.fields[t.get(n)];Fi(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields},Ui.prototype.applyChanges=function(n,t,e){ei(t,function(t,e){return n[t]=e});for(var r=0,i=e;r<i.length;r++){var o=i[r];delete n[o]}},Ui.prototype.clone=function(){return new Ui(xi(this.value))},Ui);function Ui(t){this.value=t}var qi=(Bi.newInvalidDocument=function(t){return new Bi(t,0,Jr.min(),Vi.empty(),0)},Bi.newFoundDocument=function(t,e,n){return new Bi(t,1,e,n,0)},Bi.newNoDocument=function(t,e){return new Bi(t,2,e,Vi.empty(),0)},Bi.newUnknownDocument=function(t,e){return new Bi(t,3,e,Vi.empty(),2)},Bi.prototype.convertToFoundDocument=function(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this},Bi.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=Vi.empty(),this.documentState=0,this},Bi.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=Vi.empty(),this.documentState=2,this},Bi.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},Bi.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(Bi.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(Bi.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(Bi.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),Bi.prototype.isValidDocument=function(){return 0!==this.documentType},Bi.prototype.isFoundDocument=function(){return 1===this.documentType},Bi.prototype.isNoDocument=function(){return 2===this.documentType},Bi.prototype.isUnknownDocument=function(){return 3===this.documentType},Bi.prototype.isEqual=function(t){return t instanceof Bi&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)},Bi.prototype.clone=function(){return new Bi(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},Bi.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.value)+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},Bi),ji=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};function Bi(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}function Gi(t,e,n,r,i,o,s){return new ji(t,e=void 0===e?null:e,n=void 0===n?[]:n,r=void 0===r?[]:r,i=void 0===i?null:i,o=void 0===o?null:o,s=void 0===s?null:s)}function Ki(t){var e=t;return null===e.h&&(t=e.path.canonicalString(),null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(function(t){return(t=t).field.canonicalString()+t.op.toString()+Ri(t.value)}).join(","),t+="|ob:",t+=e.orderBy.map(function(t){return(t=t).field.canonicalString()+t.dir}).join(","),_i(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=bo(e.startAt)),e.endAt&&(t+="|ub:",t+=bo(e.endAt)),e.h=t),e.h}function Hi(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n,r,i=0;i<t.orderBy.length;i++)if(n=t.orderBy[i],r=e.orderBy[i],n.dir!==r.dir||!n.field.isEqual(r.field))return!1;if(t.filters.length!==e.filters.length)return!1;for(var o,s,a=0;a<t.filters.length;a++)if(o=t.filters[a],s=e.filters[a],o.op!==s.op||!o.field.isEqual(s.field)||!Ai(o.value,s.value))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!To(t.startAt,e.startAt)&&To(t.endAt,e.endAt)}function Wi(t){return Ti.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var Qi,zi=(n(Yi,Qi=function(){}),Yi.create=function(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.l(t,e,n):new Zi(t,e,n):"array-contains"===e?new ho(t,n):"in"===e?new lo(t,n):"not-in"===e?new fo(t,n):"array-contains-any"===e?new po(t,n):new Yi(t,e,n)},Yi.l=function(t,e,n){return new("in"===e?to:eo)(t,n)},Yi.prototype.matches=function(t){t=t.data.field(this.field);return"!="===this.op?null!==t&&this.m(Di(t,this.value)):null!==t&&Si(this.value)===Si(t)&&this.m(Di(t,this.value))},Yi.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return 0<t;case">=":return 0<=t;default:return Kr()}},Yi.prototype.g=function(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)},Yi);function Yi(t,e,n){var r=this;return(r=Qi.call(this)||this).field=t,r.op=e,r.value=n,r}var Xi,Ji,$i,Zi=(n(io,$i=zi),io.prototype.matches=function(t){t=Ti.comparator(t.key,this.key);return this.m(t)},io),to=(n(ro,Ji=zi),ro.prototype.matches=function(e){return this.keys.some(function(t){return t.isEqual(e.key)})},ro),eo=(n(no,Xi=zi),no.prototype.matches=function(e){return!this.keys.some(function(t){return t.isEqual(e.key)})},no);function no(t,e){var n=this;return(n=Xi.call(this,t,"not-in",e)||this).keys=oo(0,e),n}function ro(t,e){var n=this;return(n=Ji.call(this,t,"in",e)||this).keys=oo(0,e),n}function io(t,e,n){var r=this;return(r=$i.call(this,t,e,n)||this).key=Ti.fromName(n.referenceValue),r}function oo(t,e){return((null===(e=e.arrayValue)||void 0===e?void 0:e.values)||[]).map(function(t){return Ti.fromName(t.referenceValue)})}var so,ao,uo,co,ho=(n(wo,co=zi),wo.prototype.matches=function(t){t=t.data.field(this.field);return Li(t)&&Ni(t.arrayValue,this.value)},wo),lo=(n(mo,uo=zi),mo.prototype.matches=function(t){t=t.data.field(this.field);return null!==t&&Ni(this.value.arrayValue,t)},mo),fo=(n(vo,ao=zi),vo.prototype.matches=function(t){if(Ni(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;t=t.data.field(this.field);return null!==t&&!Ni(this.value.arrayValue,t)},vo),po=(n(go,so=zi),go.prototype.matches=function(t){var e=this,t=t.data.field(this.field);return!(!Li(t)||!t.arrayValue.values)&&t.arrayValue.values.some(function(t){return Ni(e.value.arrayValue,t)})},go),yo=function(t,e){this.position=t,this.before=e};function go(t,e){return so.call(this,t,"array-contains-any",e)||this}function vo(t,e){return ao.call(this,t,"not-in",e)||this}function mo(t,e){return uo.call(this,t,"in",e)||this}function wo(t,e){return co.call(this,t,"array-contains",e)||this}function bo(t){return(t.before?"b":"a")+":"+t.position.map(Ri).join(",")}var _o=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function Eo(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i],r=o.field.isKeyField()?Ti.comparator(Ti.fromName(s.referenceValue),n.key):Di(s,n.data.field(o.field));if("desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function To(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!Ai(t.position[n],e.position[n]))return!1;return!0}var Io=function(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null,this.startAt,this.endAt};function So(t){return new Io(t)}function Ao(t){return!_i(t.limit)&&"F"===t.limitType}function No(t){return!_i(t.limit)&&"L"===t.limitType}function Do(t){return 0<t.explicitOrderBy.length?t.explicitOrderBy[0].field:null}function Co(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function Ro(t){return null!==t.collectionGroup}function ko(t){var e=t;if(null===e.p){e.p=[];var n=Co(e),t=Do(e);if(null!==n&&null===t)n.isKeyField()||e.p.push(new _o(n)),e.p.push(new _o(ai.keyField(),"asc"));else{for(var r=!1,i=0,o=e.explicitOrderBy;i<o.length;i++){var s=o[i];e.p.push(s),s.field.isKeyField()&&(r=!0)}r||(n=0<e.explicitOrderBy.length?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc",e.p.push(new _o(ai.keyField(),n)))}}return e.p}function Oo(t){var e=t;if(!e.T)if("F"===e.limitType)e.T=Gi(e.path,e.collectionGroup,ko(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=ko(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new _o(o.field,s))}var a=e.endAt?new yo(e.endAt.position,!e.endAt.before):null,t=e.startAt?new yo(e.startAt.position,!e.startAt.before):null;e.T=Gi(e.path,e.collectionGroup,n,e.filters,e.limit,a,t)}return e.T}function Lo(t,e,n){return new Io(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Po(t,e){return Hi(Oo(t),Oo(e))&&t.limitType===e.limitType}function Mo(t){return Ki(Oo(t))+"|lt:"+t.limitType}function Fo(t){return"Query(target="+(e=Oo(t),n=e.path.canonicalString(),null!==e.collectionGroup&&(n+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(n+=", filters: ["+e.filters.map(function(t){return(t=t).field.canonicalString()+" "+t.op+" "+Ri(t.value)}).join(", ")+"]"),_i(e.limit)||(n+=", limit: "+e.limit),0<e.orderBy.length&&(n+=", orderBy: ["+e.orderBy.map(function(t){return(t=t).field.canonicalString()+" ("+t.dir+")"}).join(", ")+"]"),e.startAt&&(n+=", startAt: "+bo(e.startAt)),e.endAt&&(n+=", endAt: "+bo(e.endAt)),"Target("+n+")")+"; limitType="+t.limitType+")";var e,n}function xo(i,t){return t.isFoundDocument()&&(e=i,n=t.key.path,null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):Ti.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n))&&function(t){for(var e=0,n=i.explicitOrderBy;e<n.length;e++){var r=n[e];if(!r.field.isKeyField()&&null===t.data.field(r.field))return}return 1}(t)&&function(t){for(var e=0,n=i.filters;e<n.length;e++)if(!n[e].matches(t))return;return 1}(t)&&(n=t,(!(t=i).startAt||Eo(t.startAt,ko(t),n))&&(!t.endAt||!Eo(t.endAt,ko(t),n)));var e,n}function Vo(a){return function(t,e){for(var n=!1,r=0,i=ko(a);r<i.length;r++){var o=i[r],s=function(t,r,e){var n=t.field.isKeyField()?Ti.comparator(r.key,e.key):function(t,e){var n=r.data.field(t),t=e.data.field(t);return null!==n&&null!==t?Di(n,t):Kr()}(t.field,e);switch(t.dir){case"asc":return n;case"desc":return-1*n;default:return Kr()}}(o,t,e);if(0!==s)return s;n=n||o.field.isKeyField()}return 0}}function Uo(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ei(e)?"-0":e}}function qo(t){return{integerValue:""+t}}function jo(t,e){return"number"==typeof(n=e)&&Number.isInteger(n)&&!Ei(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER?qo(e):Uo(t,e);var n}T=function(){this._=void 0};function Bo(t,e){return t instanceof es?Oi(t=e)||t&&"doubleValue"in t?e:{integerValue:0}:null}var Go,Ko,Ho=(n(zo,Ko=T),zo),Wo=(n(Qo,Go=T),Qo);function Qo(t){var e=this;return(e=Go.call(this)||this).elements=t,e}function zo(){return null!==Ko&&Ko.apply(this,arguments)||this}function Yo(t,e){for(var n=is(e),r=0,i=t.elements;r<i.length;r++)!function(e){n.some(function(t){return Ai(t,e)})||n.push(e)}(i[r]);return{arrayValue:{values:n}}}var Xo,Jo=(n($o,Xo=T),$o);function $o(t){var e=this;return(e=Xo.call(this)||this).elements=t,e}function Zo(t,e){for(var n=is(e),r=0,i=t.elements;r<i.length;r++)!function(e){n=n.filter(function(t){return!Ai(t,e)})}(i[r]);return{arrayValue:{values:n}}}var ts,es=(n(ns,ts=T),ns);function ns(t,e){var n=this;return(n=ts.call(this)||this).R=t,n.A=e,n}function rs(t){return vi(t.integerValue||t.doubleValue)}function is(t){return Li(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function os(t,e){this.field=t,this.transform=e}function ss(t,e){this.version=t,this.transformResults=e}var as=(us.none=function(){return new us},us.exists=function(t){return new us(void 0,t)},us.updateTime=function(t){return new us(t)},Object.defineProperty(us.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),us.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},us);function us(t,e){this.updateTime=t,this.exists=e}function cs(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}D=function(){};function hs(t,e,n){var r,i,o,s;t instanceof ys?(i=e,o=n,cs((r=t).precondition,i)&&(s=r.value.clone(),o=_s(r.fieldTransforms,o,i),s.setAll(o),i.convertToFoundDocument(fs(i),s).setHasLocalMutations())):t instanceof gs?(o=e,i=n,cs((s=t).precondition,o)&&(n=_s(s.fieldTransforms,i,o),(i=o.data).setAll(ws(s)),i.setAll(n),o.convertToFoundDocument(fs(o),i).setHasLocalMutations())):(e=e,cs(t.precondition,e)&&e.convertToNoDocument(Jr.min()))}function ls(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&(n=t.fieldTransforms,r=e.fieldTransforms,!!(void 0===n&&void 0===r||n&&r&&Yr(n,r,function(t,e){return e=e,(t=t).field.isEqual(e.field)&&(t=t.transform,e=e.transform,t instanceof Wo&&e instanceof Wo||t instanceof Jo&&e instanceof Jo?Yr(t.elements,e.elements,Ai):t instanceof es&&e instanceof es?Ai(t.A,e.A):t instanceof Ho&&e instanceof Ho)})))&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask));var n,r}function fs(t){return t.isFoundDocument()?t.version:Jr.min()}var ps,ds,ys=(n(ms,ds=D),ms),gs=(n(vs,ps=D),vs);function vs(t,e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=ps.call(this)||this).key=t,o.data=e,o.fieldMask=n,o.precondition=r,o.fieldTransforms=i,o.type=1,o}function ms(t,e,n,r){void 0===r&&(r=[]);var i=this;return(i=ds.call(this)||this).key=t,i.value=e,i.precondition=n,i.fieldTransforms=r,i.type=0,i}function ws(n){var r=new Map;return n.fieldMask.fields.forEach(function(t){var e;t.isEmpty()||(e=n.data.field(t),r.set(t,e))}),r}function bs(t,e,n){var r=new Map;Hr(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=e.data.field(o.field);r.set(o.field,(o=s,s=a,a=n[i],o instanceof Wo?Yo(o,s):o instanceof Jo?Zo(o,s):a))}return r}function _s(t,e,n){for(var r,i=new Map,o=0,s=t;o<s.length;o++){var a=s[o],u=a.transform,c=n.data.field(a.field);i.set(a.field,(r=c,a=e,c=void 0,(u=u)instanceof Ho?(c={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}},r&&(c.fields.__previous_value__=r),{mapValue:c}):u instanceof Wo?Yo(u,r):u instanceof Jo?Zo(u,r):(u=Bo(c=u,r),r=rs(u)+rs(c.A),Oi(u)&&Oi(c.A)?qo(r):Uo(c.R,r))))}return i}function Es(t){this.count=t}var Ts,Is,Ss,As=(n(Cs,Ss=D),Cs),Ns=(n(Ds,Is=D),Ds);function Ds(t,e){var n=this;return(n=Is.call(this)||this).key=t,n.precondition=e,n.type=3,n.fieldTransforms=[],n}function Cs(t,e){var n=this;return(n=Ss.call(this)||this).key=t,n.precondition=e,n.type=2,n.fieldTransforms=[],n}function Rs(t){switch(t){case Mr.OK:return Kr(),0;case Mr.CANCELLED:case Mr.UNKNOWN:case Mr.DEADLINE_EXCEEDED:case Mr.RESOURCE_EXHAUSTED:case Mr.INTERNAL:case Mr.UNAVAILABLE:case Mr.UNAUTHENTICATED:return;case Mr.INVALID_ARGUMENT:case Mr.NOT_FOUND:case Mr.ALREADY_EXISTS:case Mr.PERMISSION_DENIED:case Mr.FAILED_PRECONDITION:case Mr.ABORTED:case Mr.OUT_OF_RANGE:case Mr.UNIMPLEMENTED:case Mr.DATA_LOSS:return 1;default:return Kr(),0}}function ks(t){if(void 0===t)return jr("GRPC error has no .code"),Mr.UNKNOWN;switch(t){case Ts.OK:return Mr.OK;case Ts.CANCELLED:return Mr.CANCELLED;case Ts.UNKNOWN:return Mr.UNKNOWN;case Ts.DEADLINE_EXCEEDED:return Mr.DEADLINE_EXCEEDED;case Ts.RESOURCE_EXHAUSTED:return Mr.RESOURCE_EXHAUSTED;case Ts.INTERNAL:return Mr.INTERNAL;case Ts.UNAVAILABLE:return Mr.UNAVAILABLE;case Ts.UNAUTHENTICATED:return Mr.UNAUTHENTICATED;case Ts.INVALID_ARGUMENT:return Mr.INVALID_ARGUMENT;case Ts.NOT_FOUND:return Mr.NOT_FOUND;case Ts.ALREADY_EXISTS:return Mr.ALREADY_EXISTS;case Ts.PERMISSION_DENIED:return Mr.PERMISSION_DENIED;case Ts.FAILED_PRECONDITION:return Mr.FAILED_PRECONDITION;case Ts.ABORTED:return Mr.ABORTED;case Ts.OUT_OF_RANGE:return Mr.OUT_OF_RANGE;case Ts.UNIMPLEMENTED:return Mr.UNIMPLEMENTED;case Ts.DATA_LOSS:return Mr.DATA_LOSS;default:return Kr()}}(T=Ts=Ts||{})[T.OK=0]="OK",T[T.CANCELLED=1]="CANCELLED",T[T.UNKNOWN=2]="UNKNOWN",T[T.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",T[T.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",T[T.NOT_FOUND=5]="NOT_FOUND",T[T.ALREADY_EXISTS=6]="ALREADY_EXISTS",T[T.PERMISSION_DENIED=7]="PERMISSION_DENIED",T[T.UNAUTHENTICATED=16]="UNAUTHENTICATED",T[T.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",T[T.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",T[T.ABORTED=10]="ABORTED",T[T.OUT_OF_RANGE=11]="OUT_OF_RANGE",T[T.UNIMPLEMENTED=12]="UNIMPLEMENTED",T[T.INTERNAL=13]="INTERNAL",T[T.UNAVAILABLE=14]="UNAVAILABLE",T[T.DATA_LOSS=15]="DATA_LOSS";var Os=(xs.prototype.insert=function(t,e){return new xs(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Ps.BLACK,null,null))},xs.prototype.remove=function(t){return new xs(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Ps.BLACK,null,null))},xs.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},xs.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},xs.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(xs.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),xs.prototype.minKey=function(){return this.root.minKey()},xs.prototype.maxKey=function(){return this.root.maxKey()},xs.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},xs.prototype.forEach=function(n){this.inorderTraversal(function(t,e){return n(t,e),!1})},xs.prototype.toString=function(){var n=[];return this.inorderTraversal(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},xs.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},xs.prototype.getIterator=function(){return new Ls(this.root,null,this.comparator,!1)},xs.prototype.getIteratorFrom=function(t){return new Ls(this.root,t,this.comparator,!1)},xs.prototype.getReverseIterator=function(){return new Ls(this.root,null,this.comparator,!0)},xs.prototype.getReverseIteratorFrom=function(t){return new Ls(this.root,t,this.comparator,!0)},xs),Ls=(Fs.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},Fs.prototype.hasNext=function(){return 0<this.nodeStack.length},Fs.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},Fs),Ps=(Ms.prototype.copy=function(t,e,n,r,i){return new Ms(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},Ms.prototype.isEmpty=function(){return!1},Ms.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},Ms.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},Ms.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},Ms.prototype.minKey=function(){return this.min().key},Ms.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},Ms.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},Ms.prototype.removeMin=function(){if(this.left.isEmpty())return Ms.EMPTY;var t=this;return(t=(t=!t.left.isRed()&&!t.left.left.isRed()?t.moveRedLeft():t).copy(null,null,null,t.left.removeMin(),null)).fixUp()},Ms.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r=(r=!(r.left.isEmpty()||r.left.isRed()||r.left.left.isRed())?r.moveRedLeft():r).copy(null,null,null,r.left.remove(t,e),null);else{if(0===e(t,(r=!((r=r.left.isRed()?r.rotateRight():r).right.isEmpty()||r.right.isRed()||r.right.left.isRed())?r.moveRedRight():r).key)){if(r.right.isEmpty())return Ms.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()},Ms.prototype.isRed=function(){return this.color},Ms.prototype.fixUp=function(){var t=this;return t=(t=(t=t.right.isRed()&&!t.left.isRed()?t.rotateLeft():t).left.isRed()&&t.left.left.isRed()?t.rotateRight():t).left.isRed()&&t.right.isRed()?t.colorFlip():t},Ms.prototype.moveRedLeft=function(){var t=this.colorFlip();return t=t.right.left.isRed()?(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip():t},Ms.prototype.moveRedRight=function(){var t=this.colorFlip();return t=t.left.left.isRed()?(t=t.rotateRight()).colorFlip():t},Ms.prototype.rotateLeft=function(){var t=this.copy(null,null,Ms.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},Ms.prototype.rotateRight=function(){var t=this.copy(null,null,Ms.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},Ms.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},Ms.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},Ms.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Kr();if(this.right.isRed())throw Kr();var t=this.left.check();if(t!==this.right.check())throw Kr();return t+(this.isRed()?0:1)},Ms);function Ms(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:Ms.RED,this.left=null!=r?r:Ms.EMPTY,this.right=null!=i?i:Ms.EMPTY,this.size=this.left.size+1+this.right.size}function Fs(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}function xs(t,e){this.comparator=t,this.root=e||Ps.EMPTY}function Vs(){this.size=0}Ps.EMPTY=null,Ps.RED=!0,Ps.BLACK=!1,Ps.EMPTY=(Object.defineProperty(Vs.prototype,"key",{get:function(){throw Kr()},enumerable:!1,configurable:!0}),Object.defineProperty(Vs.prototype,"value",{get:function(){throw Kr()},enumerable:!1,configurable:!0}),Object.defineProperty(Vs.prototype,"color",{get:function(){throw Kr()},enumerable:!1,configurable:!0}),Object.defineProperty(Vs.prototype,"left",{get:function(){throw Kr()},enumerable:!1,configurable:!0}),Object.defineProperty(Vs.prototype,"right",{get:function(){throw Kr()},enumerable:!1,configurable:!0}),Vs.prototype.copy=function(t,e,n,r,i){return this},Vs.prototype.insert=function(t,e,n){return new Ps(t,e)},Vs.prototype.remove=function(t,e){return this},Vs.prototype.isEmpty=function(){return!0},Vs.prototype.inorderTraversal=function(t){return!1},Vs.prototype.reverseTraversal=function(t){return!1},Vs.prototype.minKey=function(){return null},Vs.prototype.maxKey=function(){return null},Vs.prototype.isRed=function(){return!1},Vs.prototype.checkMaxDepth=function(){return!0},Vs.prototype.check=function(){return 0},new Vs);var Us=(Gs.prototype.has=function(t){return null!==this.data.get(t)},Gs.prototype.first=function(){return this.data.minKey()},Gs.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(Gs.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),Gs.prototype.indexOf=function(t){return this.data.indexOf(t)},Gs.prototype.forEach=function(n){this.data.inorderTraversal(function(t,e){return n(t),!1})},Gs.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,t[1]))return;e(r.key)}},Gs.prototype.forEachWhile=function(t,e){for(var n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},Gs.prototype.firstAfterOrEqual=function(t){t=this.data.getIteratorFrom(t);return t.hasNext()?t.getNext().key:null},Gs.prototype.getIterator=function(){return new qs(this.data.getIterator())},Gs.prototype.getIteratorFrom=function(t){return new qs(this.data.getIteratorFrom(t))},Gs.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},Gs.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},Gs.prototype.isEmpty=function(){return this.data.isEmpty()},Gs.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},Gs.prototype.isEqual=function(t){if(!(t instanceof Gs))return!1;if(this.size!==t.size)return!1;for(var e=this.data.getIterator(),n=t.data.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(0!==this.comparator(r,i))return!1}return!0},Gs.prototype.toArray=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},Gs.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},Gs.prototype.copy=function(t){var e=new Gs(this.comparator);return e.data=t,e},Gs),qs=(Bs.prototype.getNext=function(){return this.iter.getNext().key},Bs.prototype.hasNext=function(){return this.iter.hasNext()},Bs),js=new Os(Ti.comparator);function Bs(t){this.iter=t}function Gs(t){this.comparator=t,this.data=new Os(this.comparator)}var Ks=new Os(Ti.comparator);var Hs=new Os(Ti.comparator);var Ws=new Us(Ti.comparator);function Qs(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Ws,r=0,i=t;r<i.length;r++)var o=i[r],n=n.add(o);return n}var zs=new Us(zr);var Ys=(oa.createSynthesizedRemoteEventForCurrentChange=function(t,e){var n=new Map;return n.set(t,Xs.createSynthesizedTargetChangeForCurrentChange(t,e)),new oa(Jr.min(),n,zs,js,Qs())},oa),Xs=(ia.createSynthesizedTargetChangeForCurrentChange=function(t,e){return new ia(ci.EMPTY_BYTE_STRING,e,Qs(),Qs(),Qs())},ia),Js=function(t,e,n,r){this.v=t,this.removedTargetIds=e,this.key=n,this.P=r},$s=function(t,e){this.targetId=t,this.V=e},Zs=function(t,e,n,r){void 0===n&&(n=ci.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},ta=(Object.defineProperty(ra.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(ra.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(ra.prototype,"k",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(ra.prototype,"$",{get:function(){return this.F},enumerable:!1,configurable:!0}),ra.prototype.O=function(t){0<t.approximateByteSize()&&(this.F=!0,this.C=t)},ra.prototype.M=function(){var n=Qs(),r=Qs(),i=Qs();return this.D.forEach(function(t,e){switch(e){case 0:n=n.add(t);break;case 2:r=r.add(t);break;case 1:i=i.add(t);break;default:Kr()}}),new Xs(this.C,this.N,n,r,i)},ra.prototype.L=function(){this.F=!1,this.D=aa()},ra.prototype.B=function(t,e){this.F=!0,this.D=this.D.insert(t,e)},ra.prototype.q=function(t){this.F=!0,this.D=this.D.remove(t)},ra.prototype.U=function(){this.S+=1},ra.prototype.K=function(){--this.S},ra.prototype.j=function(){this.F=!0,this.N=!0},ra),ea=(na.prototype.X=function(t){for(var e=0,n=t.v;e<n.length;e++){var r=n[e];t.P&&t.P.isFoundDocument()?this.Z(r,t.P):this.tt(r,t.key,t.P)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.tt(r,t.key,t.P)},na.prototype.et=function(n){var r=this;this.forEachTarget(n,function(t){var e=r.nt(t);switch(n.state){case 0:r.st(t)&&e.O(n.resumeToken);break;case 1:e.K(),e.k||e.L(),e.O(n.resumeToken);break;case 2:e.K(),e.k||r.removeTarget(t);break;case 3:r.st(t)&&(e.j(),e.O(n.resumeToken));break;case 4:r.st(t)&&(r.it(t),e.O(n.resumeToken));break;default:Kr()}})},na.prototype.forEachTarget=function(t,n){var r=this;0<t.targetIds.length?t.targetIds.forEach(n):this.G.forEach(function(t,e){r.st(e)&&n(e)})},na.prototype.rt=function(t){var e=t.targetId,n=t.V.count,t=this.ot(e);t&&(Wi(t=t.target)?0===n?(t=new Ti(t.path),this.tt(e,t,qi.newNoDocument(t,Jr.min()))):Hr(1===n):this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e)))},na.prototype.ut=function(r){var i=this,o=new Map;this.G.forEach(function(t,e){var n=i.ot(e);n&&(t.current&&Wi(n.target)&&(n=new Ti(n.target.path),null!==i.H.get(n)||i.at(e,n)||i.tt(e,n,qi.newNoDocument(n,r))),t.$&&(o.set(e,t.M()),t.L()))});var s=Qs();this.J.forEach(function(t,e){var n=!0;e.forEachWhile(function(t){t=i.ot(t);return!t||2===t.purpose||(n=!1)}),n&&(s=s.add(t))});var t=new Ys(r,o,this.Y,this.H,s);return this.H=js,this.J=sa(),this.Y=new Us(zr),t},na.prototype.Z=function(t,e){var n;this.st(t)&&(n=this.at(t,e.key)?2:0,this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t)))},na.prototype.tt=function(t,e,n){var r;this.st(t)&&(r=this.nt(t),this.at(t,e)?r.B(e,1):r.q(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n)))},na.prototype.removeTarget=function(t){this.G.delete(t)},na.prototype.ct=function(t){var e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},na.prototype.U=function(t){this.nt(t).U()},na.prototype.nt=function(t){var e=this.G.get(t);return e||(e=new ta,this.G.set(t,e)),e},na.prototype.ht=function(t){var e=this.J.get(t);return e||(e=new Us(zr),this.J=this.J.insert(t,e)),e},na.prototype.st=function(t){var e=null!==this.ot(t);return e||qr("WatchChangeAggregator","Detected inactive target",t),e},na.prototype.ot=function(t){var e=this.G.get(t);return e&&e.k?null:this.W.lt(t)},na.prototype.it=function(e){var n=this;this.G.set(e,new ta),this.W.getRemoteKeysForTarget(e).forEach(function(t){n.tt(e,t,null)})},na.prototype.at=function(t,e){return this.W.getRemoteKeysForTarget(t).has(e)},na);function na(t){this.W=t,this.G=new Map,this.H=js,this.J=sa(),this.Y=new Us(zr)}function ra(){this.S=0,this.D=aa(),this.C=ci.EMPTY_BYTE_STRING,this.N=!1,this.F=!0}function ia(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}function oa(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}function sa(){return new Os(Ti.comparator)}function aa(){return new Os(Ti.comparator)}var ua={asc:"ASCENDING",desc:"DESCENDING"},ca={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ha=function(t,e){this.databaseId=t,this.I=e};function la(t,e){return t.I?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function fa(t,e){return t.I?e.toBase64():e.toUint8Array()}function pa(t){return Hr(!!t),Jr.fromTimestamp((t=gi(t),new Xr(t.seconds,t.nanos)))}function da(t,e){return new oi(["projects",t.projectId,"databases",t.database]).child("documents").child(e).canonicalString()}function ya(t){t=oi.fromString(t);return Hr(ka(t)),t}function ga(t,e){return da(t.databaseId,e.path)}function va(t,e){e=ya(e);if(e.get(1)!==t.databaseId.projectId)throw new Fr(Mr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+t.databaseId.projectId);if(e.get(3)!==t.databaseId.database)throw new Fr(Mr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+t.databaseId.database);return new Ti(ba(e))}function ma(t,e){return da(t.databaseId,e)}function wa(t){return new oi(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function ba(t){return Hr(4<t.length&&"documents"===t.get(4)),t.popFirst(5)}function _a(t,e,n){return{name:ga(t,e),fields:n.value.mapValue.fields}}function Ea(t,e){var n,r,i;if(e instanceof ys)n={update:_a(t,e.key,e.value)};else if(e instanceof As)n={delete:ga(t,e.key)};else if(e instanceof gs)n={update:_a(t,e.key,e.data),updateMask:(r=e.fieldMask,i=[],r.fields.forEach(function(t){return i.push(t.canonicalString())}),{fieldPaths:i})};else{if(!(e instanceof Ns))return Kr();n={verify:ga(t,e.key)}}return 0<e.fieldTransforms.length&&(n.updateTransforms=e.fieldTransforms.map(function(t){var e=t.transform;if(e instanceof Ho)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(e instanceof Wo)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:e.elements}};if(e instanceof Jo)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:e.elements}};if(e instanceof es)return{fieldPath:t.field.canonicalString(),increment:e.A};throw Kr()})),e.precondition.isNone||(n.currentDocument=void 0!==(e=e.precondition).updateTime?{updateTime:la(t,e.updateTime.toTimestamp())}:void 0!==e.exists?{exists:e.exists}:Kr()),n}function Ta(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=ma(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=ma(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);r=function(t){if(0!==t.length){t=t.map(function(t){if("=="===t.op){if(Mi(t.value))return{unaryFilter:{field:Na(t.field),op:"IS_NAN"}};if(Pi(t.value))return{unaryFilter:{field:Na(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Mi(t.value))return{unaryFilter:{field:Na(t.field),op:"IS_NOT_NAN"}};if(Pi(t.value))return{unaryFilter:{field:Na(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Na(t.field),op:(e=t.op,ca[e]),value:t.value}};var e});return 1===t.length?t[0]:{compositeFilter:{op:"AND",filters:t}}}}(e.filters);r&&(n.structuredQuery.where=r);r=function(t){if(0!==t.length)return t.map(function(t){return{field:Na((t=t).field),direction:(t=t.dir,ua[t])}})}(e.orderBy);r&&(n.structuredQuery.orderBy=r);r=e.limit,r=t.I||_i(r)?r:{value:r};return null!==r&&(n.structuredQuery.limit=r),e.startAt&&(n.structuredQuery.startAt=Sa(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Sa(e.endAt)),n}function Ia(t){var e=4===(o=ya(t.parent)).length?oi.emptyPath():ba(o),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;0<r&&(Hr(1===r),(s=n.from[0]).allDescendants?i=s.collectionId:e=e.child(s.collectionId));var o=[];n.where&&(o=function e(t){return t?void 0!==t.unaryFilter?[Ra(t)]:void 0!==t.fieldFilter?[Ca(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e(t)}).reduce(function(t,e){return t.concat(e)}):Kr():[]}(n.where));t=[];n.orderBy&&(t=n.orderBy.map(function(t){return new _o(Da((e=t).field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}());var e}));r=null;n.limit&&(r=_i(a="object"==typeof(a=n.limit)?a.value:a)?null:a);var s=null;n.startAt&&(s=Aa(n.startAt));var a=null;return n.endAt&&(a=Aa(n.endAt)),new Io(e,i,t,o,r,"F",s,a)}function Sa(t){return{before:t.before,values:t.position}}function Aa(t){var e=!!t.before,t=t.values||[];return new yo(t,e)}function Na(t){return{fieldPath:t.canonicalString()}}function Da(t){return ai.fromServerFormat(t.fieldPath)}function Ca(t){return zi.create(Da(t.fieldFilter.field),function(){switch(t.fieldFilter.op){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Kr()}}(),t.fieldFilter.value)}function Ra(t){switch(t.unaryFilter.op){case"IS_NAN":var e=Da(t.unaryFilter.field);return zi.create(e,"==",{doubleValue:NaN});case"IS_NULL":e=Da(t.unaryFilter.field);return zi.create(e,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var n=Da(t.unaryFilter.field);return zi.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":n=Da(t.unaryFilter.field);return zi.create(n,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Kr()}}function ka(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)}var D=(Ma.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},Ma.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(t){return t()})},Ma),Oa=function(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})},La=(Pa.prototype.catch=function(t){return this.next(void 0,t)},Pa.prototype.next=function(r,i){var o=this;return this.callbackAttached&&Kr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(r,this.result):new Pa(function(e,n){o.nextCallback=function(t){o.wrapSuccess(r,t).next(e,n)},o.catchCallback=function(t){o.wrapFailure(i,t).next(e,n)}})},Pa.prototype.toPromise=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},Pa.prototype.wrapUserFunction=function(t){try{var e=t();return e instanceof Pa?e:Pa.resolve(e)}catch(t){return Pa.reject(t)}},Pa.prototype.wrapSuccess=function(t,e){return t?this.wrapUserFunction(function(){return t(e)}):Pa.resolve(e)},Pa.prototype.wrapFailure=function(t,e){return t?this.wrapUserFunction(function(){return t(e)}):Pa.reject(e)},Pa.resolve=function(n){return new Pa(function(t,e){t(n)})},Pa.reject=function(n){return new Pa(function(t,e){e(n)})},Pa.waitFor=function(t){return new Pa(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},Pa.or=function(t){for(var n=Pa.resolve(!1),e=0,r=t;e<r.length;e++)!function(e){n=n.next(function(t){return t?Pa.resolve(t):e()})}(r[e]);return n},Pa.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.waitFor(i)},Pa);function Pa(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}function Ma(){this.onCommittedListeners=[]}function Fa(t){return"IndexedDbTransactionError"===t.name}function xa(t){this.Lt=t}var Va=(Ga.prototype.applyToRemoteDocument=function(t,e){for(var n,r,i,o,s,a,u=e.mutationResults,c=0;c<this.mutations.length;c++){var h=this.mutations[c];h.key.isEqual(t.key)&&(n=h,r=t,i=u[c],h=a=s=o=void 0,n instanceof ys?(s=r,a=i,h=(o=n).value.clone(),o=bs(o.fieldTransforms,s,a.transformResults),h.setAll(o),s.convertToFoundDocument(a.version,h).setHasCommittedMutations()):n instanceof gs?(o=r,s=i,cs((a=n).precondition,o)?(h=bs(a.fieldTransforms,o,s.transformResults),(n=o.data).setAll(ws(a)),n.setAll(h),o.convertToFoundDocument(s.version,n).setHasCommittedMutations()):o.convertToUnknownDocument(s.version)):r.convertToNoDocument(i.version).setHasCommittedMutations())}},Ga.prototype.applyToLocalView=function(t){for(var e=0,n=this.baseMutations;e<n.length;e++)(r=n[e]).key.isEqual(t.key)&&hs(r,t,this.localWriteTime);for(var r,i=0,o=this.mutations;i<o.length;i++)(r=o[i]).key.isEqual(t.key)&&hs(r,t,this.localWriteTime)},Ga.prototype.applyToLocalDocumentSet=function(n){var r=this;this.mutations.forEach(function(t){var e=n.get(t.key),t=e;r.applyToLocalView(t),e.isValidDocument()||t.convertToNoDocument(Jr.min())})},Ga.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},Qs())},Ga.prototype.isEqual=function(t){return this.batchId===t.batchId&&Yr(this.mutations,t.mutations,ls)&&Yr(this.baseMutations,t.baseMutations,ls)},Ga),Ua=(Ba.from=function(t,e,n){Hr(t.mutations.length===n.length);for(var r=Hs,i=t.mutations,o=0;o<i.length;o++)r=r.insert(i[o].key,n[o].version);return new Ba(t,e,n,r)},Ba),qa=(ja.prototype.withSequenceNumber=function(t){return new ja(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},ja.prototype.withResumeToken=function(t,e){return new ja(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},ja.prototype.withLastLimboFreeSnapshotVersion=function(t){return new ja(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)},ja);function ja(t,e,n,r,i,o,s){void 0===i&&(i=Jr.min()),void 0===o&&(o=Jr.min()),void 0===s&&(s=ci.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}function Ba(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}function Ga(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}function Ka(t){var e=Ia({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Lo(e,e.limit,"L"):e}var Ha=(Xa.prototype.addToCollectionParentIndex=function(t,e){return this.Bt.add(e),La.resolve()},Xa.prototype.getCollectionParents=function(t,e){return La.resolve(this.Bt.getEntries(e))},Xa),Wa=(Ya.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Us(oi.comparator),t=!r.has(n);return this.index[e]=r.add(n),t},Ya.prototype.has=function(t){var e=t.lastSegment(),t=t.popLast(),e=this.index[e];return e&&e.has(t)},Ya.prototype.getEntries=function(t){return(this.index[t]||new Us(oi.comparator)).toArray()},Ya),Qa=(za.prototype.next=function(){return this.Ht+=2,this.Ht},za.Jt=function(){return new za(0)},za.Yt=function(){return new za(-1)},za);function za(t){this.Ht=t}function Ya(){this.index={}}function Xa(){this.Bt=new Wa}function Ja(e){return y(this,void 0,void 0,function(){return g(this,function(t){if(e.code!==Mr.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==e.message)throw e;return qr("LocalStore","Unexpectedly lost primary lease"),[2]})})}function $a(t,e){this.progress=t,this.wn=e}var Za=(cu.prototype.get=function(t){var e=this.mapKeyFn(t),e=this.inner[e];if(void 0!==e)for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],i=i[1];if(this.equalsFn(o,t))return i}},cu.prototype.has=function(t){return void 0!==this.get(t)},cu.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},cu.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},cu.prototype.forEach=function(s){ei(this.inner,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],i=i[1];s(o,i)}})},cu.prototype.isEmpty=function(){return ni(this.inner)},cu),T=(uu.prototype.getReadTime=function(t){t=this.changes.get(t);return t?t.readTime:Jr.min()},uu.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})},uu.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{document:qi.newInvalidDocument(t),readTime:e})},uu.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?La.resolve(n.document):this.getFromCache(t,e)},uu.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},uu.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},uu.prototype.assertNotApplied=function(){},uu),tu=(au.prototype.mn=function(e,n){var r=this;return this._n.getAllMutationBatchesAffectingDocumentKey(e,n).next(function(t){return r.yn(e,n,t)})},au.prototype.yn=function(t,e,r){return this.Ue.getEntry(t,e).next(function(t){for(var e=0,n=r;e<n.length;e++)n[e].applyToLocalView(t);return t})},au.prototype.gn=function(t,i){t.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)r[n].applyToLocalView(e)})},au.prototype.pn=function(e,t){var n=this;return this.Ue.getEntries(e,t).next(function(t){return n.En(e,t).next(function(){return t})})},au.prototype.En=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next(function(t){return n.gn(e,t)})},au.prototype.getDocumentsMatchingQuery=function(t,e,n){return r=e,Ti.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.Tn(t,e.path):Ro(e)?this.In(t,e,n):this.An(t,e,n);var r},au.prototype.Tn=function(t,e){return this.mn(t,new Ti(e)).next(function(t){var e=Ks;return e=t.isFoundDocument()?e.insert(t.key,t):e})},au.prototype.In=function(n,r,i){var o=this,s=r.collectionGroup,a=Ks;return this.Ut.getCollectionParents(n,s).next(function(t){return La.forEach(t,function(t){var e,e=(e=r,t=t.child(s),new Io(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt));return o.An(n,e,i).next(function(t){t.forEach(function(t,e){a=a.insert(t,e)})})}).next(function(){return a})})},au.prototype.An=function(e,n,t){var c,h,r=this;return this.Ue.getDocumentsMatchingQuery(e,n,t).next(function(t){return c=t,r._n.getAllMutationBatchesAffectingQuery(e,n)}).next(function(t){return h=t,r.Rn(e,h,c).next(function(t){c=t;for(var e=0,n=h;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var s=o[i],a=s.key,u=c.get(a);null==u&&(u=qi.newInvalidDocument(a),c=c.insert(a,u)),hs(s,u,r.localWriteTime),u.isFoundDocument()||(c=c.remove(a))}})}).next(function(){return c.forEach(function(t,e){xo(n,e)||(c=c.remove(t))}),c})},au.prototype.Rn=function(t,e,n){for(var r=Qs(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof gs&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.Ue.getEntries(t,r).next(function(t){return t.forEach(function(t,e){e.isFoundDocument()&&(c=c.insert(t,e))}),c})},au),eu=(su.Pn=function(t,e){for(var n=Qs(),r=Qs(),i=0,o=e.docChanges;i<o.length;i++){var s=o[i];switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}}return new su(t,e.fromCache,n,r)},su),nu=(ou.prototype.Vn=function(t){this.Sn=t},ou.prototype.getDocumentsMatchingQuery=function(e,r,i,o){var s=this;return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.explicitOrderBy.length||1===r.explicitOrderBy.length&&r.explicitOrderBy[0].field.isKeyField())||i.isEqual(Jr.min())?this.Dn(e,r):this.Sn.pn(e,o).next(function(t){var n=s.Cn(r,t);return(Ao(r)||No(r))&&s.Nn(r.limitType,n,o,i)?s.Dn(e,r):(Ur()<=d.DEBUG&&qr("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Fo(r)),s.Sn.getDocumentsMatchingQuery(e,r,i).next(function(e){return n.forEach(function(t){e=e.insert(t.key,t)}),e}))})},ou.prototype.Cn=function(n,t){var r=new Us(Vo(n));return t.forEach(function(t,e){xo(n,e)&&(r=r.add(e))}),r},ou.prototype.Nn=function(t,e,n,r){if(n.size!==e.size)return!0;e="F"===t?e.last():e.first();return!!e&&(e.hasPendingWrites||0<e.version.compareTo(r))},ou.prototype.Dn=function(t,e){return Ur()<=d.DEBUG&&qr("QueryEngine","Using full collection scan to execute query:",Fo(e)),this.Sn.getDocumentsMatchingQuery(t,e,Jr.min())},ou),ru=(iu.prototype.collectGarbage=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(t){return e.collect(t,n.Fn)})},iu);function iu(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.Fn=new Os(zr),this.kn=new Za(Ki,Hi),this.$n=Jr.min(),this._n=t.getMutationQueue(n),this.On=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new tu(this.On,this._n,this.persistence.getIndexManager()),this.Ke=t.getBundleCache(),this.xn.Vn(this.Mn)}function ou(){}function su(t,e,n,r){this.targetId=t,this.fromCache=e,this.bn=n,this.vn=r}function au(t,e,n){this.Ue=t,this._n=e,this.Ut=n}function uu(){this.changes=new Za(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.changesApplied=!1}function cu(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}function hu(i,o){return y(this,void 0,void 0,function(){var e,n,m,r;return g(this,function(t){switch(t.label){case 0:return n=(e=i)._n,m=e.Mn,[4,e.persistence.runTransaction("Handle user change","readonly",function(g){var v;return e._n.getAllMutationBatches(g).next(function(t){return v=t,n=e.persistence.getMutationQueue(o),m=new tu(e.On,n,e.persistence.getIndexManager()),n.getAllMutationBatches(g)}).next(function(t){for(var e=[],n=[],r=Qs(),i=0,o=v;i<o.length;i++){var s=o[i];e.push(s.batchId);for(var a=0,u=s.mutations;a<u.length;a++)var c=u[a],r=r.add(c.key)}for(var h=0,l=t;h<l.length;h++){var f=l[h];n.push(f.batchId);for(var p=0,d=f.mutations;p<d.length;p++){var y=d[p];r=r.add(y.key)}}return m.pn(g,r).next(function(t){return{Ln:t,removedBatchIds:e,addedBatchIds:n}})})})];case 1:return r=t.sent(),[2,(e._n=n,e.Mn=m,e.xn.Vn(e.Mn),r)]}})})}function lu(t,h){var l=t;return l.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var e,r,i,o,s,n,a,u=h.batch.keys(),c=l.On.newChangeBuffer({trackRemovals:!0});return e=l,r=t,o=c,s=(i=h).batch,n=s.keys(),a=La.resolve(),n.forEach(function(n){a=a.next(function(){return o.getEntry(r,n)}).next(function(t){var e=i.docVersions.get(n);Hr(null!==e),t.version.compareTo(e)<0&&(s.applyToRemoteDocument(t,i),t.isValidDocument()&&o.addEntry(t,i.commitVersion))})}),a.next(function(){return e._n.removeMutationBatch(r,s)}).next(function(){return c.apply(t)}).next(function(){return l._n.performConsistencyCheck(t)}).next(function(){return l.Mn.pn(t,u)})})}function fu(t){var e=t;return e.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.qe.getLastRemoteSnapshotVersion(t)})}function pu(t,r){var u=t,c=r.snapshotVersion,h=u.Fn;return u.persistence.runTransaction("Apply remote event","readwrite-primary",function(s){var t=u.On.newChangeBuffer({trackRemovals:!0});h=u.Fn;var a=[];r.targetChanges.forEach(function(t,e){var n,r,i,o=h.get(e);o&&(a.push(u.qe.removeMatchingKeys(s,t.removedDocuments,e).next(function(){return u.qe.addMatchingKeys(s,t.addedDocuments,e)})),0<(i=t.resumeToken).approximateByteSize()&&(n=o.withResumeToken(i,c).withSequenceNumber(s.currentSequenceNumber),h=h.insert(e,n),r=o,i=t,Hr(0<(o=n).resumeToken.approximateByteSize()),(0===r.resumeToken.approximateByteSize()||3e8<=o.snapshotVersion.toMicroseconds()-r.snapshotVersion.toMicroseconds()||0<i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size)&&a.push(u.qe.updateTargetData(s,n))))});var e,n=js;return r.documentUpdates.forEach(function(t,e){r.resolvedLimboDocuments.has(t)&&a.push(u.persistence.referenceDelegate.updateLimboDocument(s,t))}),a.push(du(s,t,r.documentUpdates,c,void 0).next(function(t){n=t})),c.isEqual(Jr.min())||(e=u.qe.getLastRemoteSnapshotVersion(s).next(function(t){return u.qe.setTargetsMetadata(s,s.currentSequenceNumber,c)}),a.push(e)),La.waitFor(a).next(function(){return t.apply(s)}).next(function(){return u.Mn.En(s,n)}).next(function(){return n})}).then(function(t){return u.Fn=h,t})}function du(t,s,e,a,u){var n=Qs();return e.forEach(function(t){return n=n.add(t)}),s.getEntries(t,n).next(function(i){var o=js;return e.forEach(function(t,e){var n=i.get(t),r=(null==u?void 0:u.get(t))||a;e.isNoDocument()&&e.version.isEqual(Jr.min())?(s.removeEntry(t,r),o=o.insert(t,e)):!n.isValidDocument()||0<e.version.compareTo(n.version)||0===e.version.compareTo(n.version)&&n.hasPendingWrites?(s.addEntry(e,r),o=o.insert(t,e)):qr("LocalStore","Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version)}),o})}function yu(t,r){var i=t;return i.persistence.runTransaction("Allocate target","readwrite",function(e){var n;return i.qe.getTargetData(e,r).next(function(t){return t?(n=t,La.resolve(n)):i.qe.allocateTargetId(e).next(function(t){return n=new qa(r,t,0,e.currentSequenceNumber),i.qe.addTargetData(e,n).next(function(){return n})})})}).then(function(t){var e=i.Fn.get(t.targetId);return(null===e||0<t.snapshotVersion.compareTo(e.snapshotVersion))&&(i.Fn=i.Fn.insert(t.targetId,t),i.kn.set(r,t.targetId)),t})}function gu(i,o,s){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:n=(e=i).Fn.get(o),r=s?"readwrite":"readwrite-primary",t.label=1;case 1:return t.trys.push([1,4,,5]),s?[3,3]:[4,e.persistence.runTransaction("Release target",r,function(t){return e.persistence.referenceDelegate.removeTarget(t,n)})];case 2:t.sent(),t.label=3;case 3:return[3,5];case 4:if(!Fa(r=t.sent()))throw r;return qr("LocalStore","Failed to update sequence numbers for target "+o+": "+r),[3,5];case 5:return e.Fn=e.Fn.remove(o),e.kn.delete(n.target),[2]}})})}function vu(t,o,s){var a=t,u=Jr.min(),c=Qs();return a.persistence.runTransaction("Execute query","readonly",function(e){return t=a,n=e,r=Oo(o),(void 0!==(t=(i=t).kn.get(r))?La.resolve(i.Fn.get(t)):i.qe.getTargetData(n,r)).next(function(t){if(t)return u=t.lastLimboFreeSnapshotVersion,a.qe.getMatchingKeysForTargetId(e,t.targetId).next(function(t){c=t})}).next(function(){return a.xn.getDocumentsMatchingQuery(e,o,s?u:Jr.min(),s?c:Qs())}).next(function(t){return{documents:t,Bn:c}});var t,n,r,i})}var mu,wu,bu=(ju.prototype.getBundleMetadata=function(t,e){return La.resolve(this.Qn.get(e))},ju.prototype.saveBundleMetadata=function(t,e){return this.Qn.set(e.id,{id:e.id,version:e.version,createTime:pa(e.createTime)}),La.resolve()},ju.prototype.getNamedQuery=function(t,e){return La.resolve(this.jn.get(e))},ju.prototype.saveNamedQuery=function(t,e){return this.jn.set(e.name,{name:(e=e).name,query:Ka(e.bundledQuery),readTime:pa(e.readTime)}),La.resolve()},ju),_u=(qu.prototype.isEmpty=function(){return this.Wn.isEmpty()},qu.prototype.addReference=function(t,e){e=new Eu(t,e);this.Wn=this.Wn.add(e),this.zn=this.zn.add(e)},qu.prototype.Jn=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},qu.prototype.removeReference=function(t,e){this.Yn(new Eu(t,e))},qu.prototype.Xn=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},qu.prototype.Zn=function(t){var e=this,n=new Ti(new oi([])),r=new Eu(n,t),t=new Eu(n,t+1),i=[];return this.zn.forEachInRange([r,t],function(t){e.Yn(t),i.push(t.key)}),i},qu.prototype.ts=function(){var e=this;this.Wn.forEach(function(t){return e.Yn(t)})},qu.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},qu.prototype.es=function(t){var e=new Ti(new oi([])),n=new Eu(e,t),t=new Eu(e,t+1),r=Qs();return this.zn.forEachInRange([n,t],function(t){r=r.add(t.key)}),r},qu.prototype.containsKey=function(t){var e=new Eu(t,0),e=this.Wn.firstAfterOrEqual(e);return null!==e&&t.isEqual(e.key)},qu),Eu=(Uu.Gn=function(t,e){return Ti.comparator(t.key,e.key)||zr(t.ns,e.ns)},Uu.Hn=function(t,e){return zr(t.ns,e.ns)||Ti.comparator(t.key,e.key)},Uu),Tu=(Vu.prototype.checkEmpty=function(t){return La.resolve(0===this._n.length)},Vu.prototype.addMutationBatch=function(t,e,n,r){var i=this.ss;this.ss++,0<this._n.length&&this._n[this._n.length-1];n=new Va(i,e,n,r);this._n.push(n);for(var o=0,s=r;o<s.length;o++){var a=s[o];this.rs=this.rs.add(new Eu(a.key,i)),this.Ut.addToCollectionParentIndex(t,a.key.path.popLast())}return La.resolve(n)},Vu.prototype.lookupMutationBatch=function(t,e){return La.resolve(this.os(e))},Vu.prototype.getNextMutationBatchAfterBatchId=function(t,e){e=this.cs(e+1),e=e<0?0:e;return La.resolve(this._n.length>e?this._n[e]:null)},Vu.prototype.getHighestUnacknowledgedBatchId=function(){return La.resolve(0===this._n.length?-1:this.ss-1)},Vu.prototype.getAllMutationBatches=function(t){return La.resolve(this._n.slice())},Vu.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new Eu(e,0),e=new Eu(e,Number.POSITIVE_INFINITY),i=[];return this.rs.forEachInRange([r,e],function(t){t=n.os(t.ns);i.push(t)}),La.resolve(i)},Vu.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Us(zr);return e.forEach(function(t){var e=new Eu(t,0),t=new Eu(t,Number.POSITIVE_INFINITY);n.rs.forEachInRange([e,t],function(t){r=r.add(t.ns)})}),La.resolve(this.us(r))},Vu.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,e=n;Ti.isDocumentKey(e)||(e=e.child(""));var e=new Eu(new Ti(e),0),i=new Us(zr);return this.rs.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(i=i.add(t.ns)),!0)},e),La.resolve(this.us(i))},Vu.prototype.us=function(t){var e=this,n=[];return t.forEach(function(t){t=e.os(t);null!==t&&n.push(t)}),n},Vu.prototype.removeMutationBatch=function(n,r){var i=this;Hr(0===this.hs(r.batchId,"removed")),this._n.shift();var o=this.rs;return La.forEach(r.mutations,function(t){var e=new Eu(t.key,r.batchId);return o=o.delete(e),i.referenceDelegate.markPotentiallyOrphaned(n,t.key)}).next(function(){i.rs=o})},Vu.prototype.Gt=function(t){},Vu.prototype.containsKey=function(t,e){var n=new Eu(e,0),n=this.rs.firstAfterOrEqual(n);return La.resolve(e.isEqual(n&&n.key))},Vu.prototype.performConsistencyCheck=function(t){return this._n.length,La.resolve()},Vu.prototype.hs=function(t,e){return this.cs(t)},Vu.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},Vu.prototype.os=function(t){t=this.cs(t);return t<0||t>=this._n.length?null:this._n[t]},Vu),Iu=(xu.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,i=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:i,readTime:n}),this.size+=i-o,this.Ut.addToCollectionParentIndex(t,r.path.popLast())},xu.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},xu.prototype.getEntry=function(t,e){var n=this.docs.get(e);return La.resolve(n?n.document.clone():qi.newInvalidDocument(e))},xu.prototype.getEntries=function(t,e){var n=this,r=js;return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.document.clone():qi.newInvalidDocument(t))}),La.resolve(r)},xu.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=js,i=new Ti(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=o.getNext(),a=s.key,u=s.value,s=u.document,u=u.readTime;if(!e.path.isPrefixOf(a.path))break;u.compareTo(n)<=0||xo(e,s)&&(r=r.insert(s.key,s.clone()))}return La.resolve(r)},xu.prototype.fs=function(t,e){return La.forEach(this.docs,function(t){return e(t)})},xu.prototype.newChangeBuffer=function(t){return new Su(this)},xu.prototype.getSize=function(t){return La.resolve(this.size)},xu),Su=(n(Fu,wu=T),Fu.prototype.applyChanges=function(n){var r=this,i=[];return this.changes.forEach(function(t,e){e.document.isValidDocument()?i.push(r.Ie.addEntry(n,e.document,r.getReadTime(t))):r.Ie.removeEntry(t)}),La.waitFor(i)},Fu.prototype.getFromCache=function(t,e){return this.Ie.getEntry(t,e)},Fu.prototype.getAllFromCache=function(t,e){return this.Ie.getEntries(t,e)},Fu),Au=(Mu.prototype.forEachTarget=function(t,n){return this.ds.forEach(function(t,e){return n(e)}),La.resolve()},Mu.prototype.getLastRemoteSnapshotVersion=function(t){return La.resolve(this.lastRemoteSnapshotVersion)},Mu.prototype.getHighestSequenceNumber=function(t){return La.resolve(this.ws)},Mu.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),La.resolve(this.highestTargetId)},Mu.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),La.resolve()},Mu.prototype.te=function(t){this.ds.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ys=new Qa(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},Mu.prototype.addTargetData=function(t,e){return this.te(e),this.targetCount+=1,La.resolve()},Mu.prototype.updateTargetData=function(t,e){return this.te(e),La.resolve()},Mu.prototype.removeTargetData=function(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),--this.targetCount,La.resolve()},Mu.prototype.removeTargets=function(n,r,i){var o=this,s=0,a=[];return this.ds.forEach(function(t,e){e.sequenceNumber<=r&&null===i.get(e.targetId)&&(o.ds.delete(t),a.push(o.removeMatchingKeysForTargetId(n,e.targetId)),s++)}),La.waitFor(a).next(function(){return s})},Mu.prototype.getTargetCount=function(t){return La.resolve(this.targetCount)},Mu.prototype.getTargetData=function(t,e){e=this.ds.get(e)||null;return La.resolve(e)},Mu.prototype.addMatchingKeys=function(t,e,n){return this._s.Jn(e,n),La.resolve()},Mu.prototype.removeMatchingKeys=function(e,t,n){this._s.Xn(t,n);var r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(function(t){i.push(r.markPotentiallyOrphaned(e,t))}),La.waitFor(i)},Mu.prototype.removeMatchingKeysForTargetId=function(t,e){return this._s.Zn(e),La.resolve()},Mu.prototype.getMatchingKeysForTargetId=function(t,e){e=this._s.es(e);return La.resolve(e)},Mu.prototype.containsKey=function(t,e){return La.resolve(this._s.containsKey(e))},Mu),Nu=(Pu.prototype.start=function(){return Promise.resolve()},Pu.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(Pu.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),Pu.prototype.setDatabaseDeletedListener=function(){},Pu.prototype.setNetworkEnabled=function(){},Pu.prototype.getIndexManager=function(){return this.Ut},Pu.prototype.getMutationQueue=function(t){var e=this.gs[t.toKey()];return e||(e=new Tu(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=e),e},Pu.prototype.getTargetCache=function(){return this.qe},Pu.prototype.getRemoteDocumentCache=function(){return this.Ue},Pu.prototype.getBundleCache=function(){return this.Ke},Pu.prototype.runTransaction=function(t,e,n){var r=this;qr("MemoryPersistence","Starting transaction:",t);var i=new Du(this.Ne.next());return this.referenceDelegate.Es(),n(i).next(function(t){return r.referenceDelegate.Ts(i).next(function(){return t})}).toPromise().then(function(t){return i.raiseOnCommittedEvent(),t})},Pu.prototype.Is=function(e,n){return La.or(Object.values(this.gs).map(function(t){return function(){return t.containsKey(e,n)}}))},Pu),Du=(n(Lu,mu=D),Lu),Cu=(Ou.bs=function(t){return new Ou(t)},Object.defineProperty(Ou.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw Kr()},enumerable:!1,configurable:!0}),Ou.prototype.addReference=function(t,e,n){return this.As.addReference(n,e),this.vs.delete(n.toString()),La.resolve()},Ou.prototype.removeReference=function(t,e,n){return this.As.removeReference(n,e),this.vs.add(n.toString()),La.resolve()},Ou.prototype.markPotentiallyOrphaned=function(t,e){return this.vs.add(e.toString()),La.resolve()},Ou.prototype.removeTarget=function(t,e){var n=this;this.As.Zn(e.targetId).forEach(function(t){return n.vs.add(t.toString())});var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.vs.add(t.toString())})}).next(function(){return r.removeTargetData(t,e)})},Ou.prototype.Es=function(){this.Rs=new Set},Ou.prototype.Ts=function(n){var r=this,i=this.persistence.getRemoteDocumentCache().newChangeBuffer();return La.forEach(this.vs,function(t){var e=Ti.fromPath(t);return r.Ps(n,e).next(function(t){t||i.removeEntry(e)})}).next(function(){return r.Rs=null,i.apply(n)})},Ou.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ps(t,e).next(function(t){t?n.vs.delete(e.toString()):n.vs.add(e.toString())})},Ou.prototype.ps=function(t){return 0},Ou.prototype.Ps=function(t,e){var n=this;return La.or([function(){return La.resolve(n.As.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Is(t,e)}])},Ou),Ru=(ku.prototype.isAuthenticated=function(){return null!=this.uid},ku.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},ku.prototype.isEqual=function(t){return t.uid===this.uid},ku);function ku(t){this.uid=t}function Ou(t){this.persistence=t,this.As=new _u,this.Rs=null}function Lu(t){var e=this;return(e=mu.call(this)||this).currentSequenceNumber=t,e}function Pu(t,e){var n=this;this.gs={},this.Ne=new Or(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new Au(this),this.Ut=new Ha,this.Ue=(t=this.Ut,new Iu(t,function(t){return n.referenceDelegate.ps(t)})),this.R=new xa(e),this.Ke=new bu(this.R)}function Mu(t){this.persistence=t,this.ds=new Za(Ki,Hi),this.lastRemoteSnapshotVersion=Jr.min(),this.highestTargetId=0,this.ws=0,this._s=new _u,this.targetCount=0,this.ys=Qa.Jt()}function Fu(t){var e=this;return(e=wu.call(this)||this).Ie=t,e}function xu(t,e){this.Ut=t,this.ls=e,this.docs=new Os(Ti.comparator),this.size=0}function Vu(t,e){this.Ut=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new Us(Eu.Gn)}function Uu(t,e){this.key=t,this.ns=e}function qu(){this.Wn=new Us(Eu.Gn),this.zn=new Us(Eu.Hn)}function ju(t){this.R=t,this.Qn=new Map,this.jn=new Map}Ru.UNAUTHENTICATED=new Ru(null),Ru.GOOGLE_CREDENTIALS=new Ru("google-credentials-uid"),Ru.FIRST_PARTY=new Ru("first-party-uid");var Bu,Gu=(nc.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},nc.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},nc.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},nc),Ku=(ec.prototype.addPendingMutation=function(t){},ec.prototype.updateMutationState=function(t,e,n){},ec.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},ec.prototype.updateQueryState=function(t,e,n){this.fi[t]=e},ec.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},ec.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},ec.prototype.clearQueryState=function(t){delete this.fi[t]},ec.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},ec.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},ec.prototype.start=function(){return this.li=new Gu,Promise.resolve()},ec.prototype.handleUserChange=function(t,e,n){},ec.prototype.setOnlineState=function(t){},ec.prototype.shutdown=function(){},ec.prototype.writeSequenceNumber=function(t){},ec.prototype.notifyBundleLoaded=function(){},ec),Hu=(tc.prototype.di=function(t){},tc.prototype.shutdown=function(){},tc),Wu=(Zu.prototype.di=function(t){this.gi.push(t)},Zu.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},Zu.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},Zu.prototype._i=function(){qr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(0)},Zu.prototype.yi=function(){qr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(1)},Zu.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},Zu),Qu={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},zu=($u.prototype.Ii=function(t){this.Ai=t},$u.prototype.Ri=function(t){this.bi=t},$u.prototype.onMessage=function(t){this.vi=t},$u.prototype.close=function(){this.Ti()},$u.prototype.send=function(t){this.Ei(t)},$u.prototype.Pi=function(){this.Ai()},$u.prototype.Vi=function(t){this.bi(t)},$u.prototype.Si=function(t){this.vi(t)},$u),Yu=(Ju.prototype.Ni=function(e,t,n,r){var i=this.xi(e,t);qr("RestConnection","Sending: ",i,n);t={};return this.Fi(t,r),this.ki(e,i,t,n).then(function(t){return qr("RestConnection","Received: ",t),t},function(t){throw Br("RestConnection",e+" failed with error: ",t,"url: ",i,"request:",n),t})},Ju.prototype.$i=function(t,e,n,r){return this.Ni(t,e,n,r)},Ju.prototype.Fi=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.8.0",t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},Ju.prototype.xi=function(t,e){return this.Di+"/v1/"+e+":"+Qu[t]},n(Xu,Bu=Ju),Xu.prototype.ki=function(u,e,n,r){return new Promise(function(o,s){var a=new kr;a.listenOnce(Sr.COMPLETE,function(){try{switch(a.getLastErrorCode()){case Ir.NO_ERROR:var t=a.getResponseJson();qr("Connection","XHR received:",JSON.stringify(t)),o(t);break;case Ir.TIMEOUT:qr("Connection",'RPC "'+u+'" timed out'),s(new Fr(Mr.DEADLINE_EXCEEDED,"Request time out"));break;case Ir.HTTP_ERROR:var e,n,r=a.getStatus();qr("Connection",'RPC "'+u+'" failed with status:',r,"response text:",a.getResponseText()),0<r?(e=a.getResponseJson().error)&&e.status&&e.message?(i=e.status.toLowerCase().replace(/_/g,"-"),n=0<=Object.values(Mr).indexOf(i)?i:Mr.UNKNOWN,s(new Fr(n,e.message))):s(new Fr(Mr.UNKNOWN,"Server responded with status "+a.getStatus())):s(new Fr(Mr.UNAVAILABLE,"Connection failed."));break;default:Kr()}}finally{qr("Connection",'RPC "'+u+'" completed.')}var i});var t=JSON.stringify(r);a.send(e,"POST",t,n,15)})},Xu.prototype.Oi=function(t,e){var n,r=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=new mr,o=Tr(),t={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(t.xmlHttpFactory=new Cr({})),this.Fi(t.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(h())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=h().indexOf("Electron/")||(0<=(n=h()).indexOf("MSIE ")||0<=n.indexOf("Trident/"))||0<=h().indexOf("MSAppHost/")||"object"==typeof(n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==n.id||(t.httpHeadersOverwriteParam="$httpHeaders");r=r.join("");qr("Connection","Creating WebChannel: "+r,t);var s=i.createWebChannel(r,t),a=!1,u=!1,c=new zu({Ei:function(t){u?qr("Connection","Not sending because WebChannel is closed:",t):(a||(qr("Connection","Opening WebChannel transport."),s.open(),a=!0),qr("Connection","WebChannel sending:",t),s.send(t))},Ti:function(){return s.close()}}),t=function(t,e,n){t.listen(e,function(t){try{n(t)}catch(t){setTimeout(function(){throw t},0)}})};return t(s,Rr.EventType.OPEN,function(){u||qr("Connection","WebChannel transport opened.")}),t(s,Rr.EventType.CLOSE,function(){u||(u=!0,qr("Connection","WebChannel transport closed"),c.Vi())}),t(s,Rr.EventType.ERROR,function(t){u||(u=!0,Br("Connection","WebChannel transport errored:",t),c.Vi(new Fr(Mr.UNAVAILABLE,"The operation could not be completed")))}),t(s,Rr.EventType.MESSAGE,function(t){var e,n,r,i;u||(Hr(!!(e=t.data[0])),(n=e.error||(null===(i=e[0])||void 0===i?void 0:i.error))?(qr("Connection","WebChannel received error:",n),r=n.status,t=function(){var t=Ts[r];if(void 0!==t)return ks(t)}(),i=n.message,void 0===t&&(t=Mr.INTERNAL,i="Unknown error status: "+r+" with message "+n.message),u=!0,c.Vi(new Fr(t,i)),s.close()):(qr("Connection","WebChannel received:",e),c.Si(e)))}),t(o,Ar.STAT_EVENT,function(t){t.stat===Nr?qr("Connection","Detected buffering proxy"):t.stat===Dr&&qr("Connection","Detected no buffering proxy")}),setTimeout(function(){c.Pi()},0),c},Xu);function Xu(t){var e=this;return(e=Bu.call(this,t)||this).forceLongPolling=t.forceLongPolling,e.autoDetectLongPolling=t.autoDetectLongPolling,e.useFetchStreams=t.useFetchStreams,e}function Ju(t){this.databaseInfo=t,this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.Di=e+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}function $u(t){this.Ei=t.Ei,this.Ti=t.Ti}function Zu(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}function tc(){}function ec(){this.li=new Gu,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}function nc(){this.activeTargetIds=zs}function rc(){return"undefined"!=typeof document?document:null}function ic(t){return new ha(t,!0)}function oc(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.kr=[],this.$r=new Map,this.Or=new Set,this.Mr=[],this.Lr=i,this.Lr.di(function(t){n.enqueueAndForget(function(){return y(o,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return Dc(this)?(qr("RemoteStore","Restarting streams for network reachability change."),[4,function(n){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return(e=n).Or.add(4),[4,_c(e)];case 1:return t.sent(),e.Br.set("Unknown"),e.Or.delete(4),[4,bc(e)];case 2:return t.sent(),[2]}})})}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.Br=new pc(n,r)}var sc,ac,uc,cc=(wc.prototype.reset=function(){this.qi=0},wc.prototype.Qi=function(){this.qi=this.Bi},wc.prototype.ji=function(t){var e=this;this.cancel();var n=Math.floor(this.qi+this.Wi()),r=Math.max(0,Date.now()-this.Ki),i=Math.max(0,n-r);0<i&&qr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.qi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,i,function(){return e.Ki=Date.now(),t()}),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},wc.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},wc.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},wc.prototype.Wi=function(){return(Math.random()-.5)*this.qi},wc),T=(mc.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},mc.prototype.er=function(){return 2===this.state},mc.prototype.start=function(){3!==this.state?this.auth():this.nr()},mc.prototype.stop=function(){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},mc.prototype.sr=function(){this.state=0,this.Zi.reset()},mc.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,function(){return t.rr()}))},mc.prototype.cr=function(t){this.ur(),this.stream.send(t)},mc.prototype.rr=function(){return y(this,void 0,void 0,function(){return g(this,function(t){return this.er()?[2,this.close(0)]:[2]})})},mc.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},mc.prototype.close=function(e,n){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==e?this.Zi.reset():n&&n.code===Mr.RESOURCE_EXHAUSTED?(jr(n.toString()),jr("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Qi()):n&&n.code===Mr.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.Ri(n)];case 1:return t.sent(),[2]}})})},mc.prototype.ar=function(){},mc.prototype.auth=function(){var n=this;this.state=1;var t=this.hr(this.Yi),e=this.Yi;this.Ji.getToken().then(function(t){n.Yi===e&&n.lr(t)},function(e){t(function(){var t=new Fr(Mr.UNKNOWN,"Fetching auth token failed: "+e.message);return n.dr(t)})})},mc.prototype.lr=function(t){var e=this,n=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii(function(){n(function(){return e.state=2,e.listener.Ii()})}),this.stream.Ri(function(t){n(function(){return e.dr(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},mc.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji(function(){return y(t,void 0,void 0,function(){return g(this,function(t){return this.state=0,this.start(),[2]})})})},mc.prototype.dr=function(t){return qr("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},mc.prototype.hr=function(e){var n=this;return function(t){n.Se.enqueueAndForget(function(){return n.Yi===e?t():(qr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},mc),hc=(n(vc,uc=T),vc.prototype.wr=function(t){return this.Hi.Oi("Listen",t)},vc.prototype.onMessage=function(t){this.Zi.reset();var e=function(t,e){if("targetChange"in e){e.targetChange;var n="NO_CHANGE"===(o=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===o?1:"REMOVE"===o?2:"CURRENT"===o?3:"RESET"===o?4:Kr(),r=e.targetChange.targetIds||[],i=(s=e.targetChange.resumeToken,t.I?(Hr(void 0===s||"string"==typeof s),ci.fromBase64String(s||"")):(Hr(void 0===s||s instanceof Uint8Array),ci.fromUint8Array(s||new Uint8Array))),o=(a=e.targetChange.cause)&&(u=void 0===(c=a).code?Mr.UNKNOWN:ks(c.code),new Fr(u,c.message||"")),s=new Zs(n,r,i,o||null)}else if("documentChange"in e){e.documentChange,(n=e.documentChange).document,n.document.name,n.document.updateTime;var r=va(t,n.document.name),i=pa(n.document.updateTime),a=new Vi({mapValue:{fields:n.document.fields}}),u=(o=qi.newFoundDocument(r,i,a),n.targetIds||[]),c=n.removedTargetIds||[];s=new Js(u,c,o.key,o)}else if("documentDelete"in e)e.documentDelete,(n=e.documentDelete).document,r=va(t,n.document),i=n.readTime?pa(n.readTime):Jr.min(),a=qi.newNoDocument(r,i),o=n.removedTargetIds||[],s=new Js([],o,a.key,a);else if("documentRemove"in e)e.documentRemove,(n=e.documentRemove).document,r=va(t,n.document),i=n.removedTargetIds||[],s=new Js([],i,r,null);else{if(!("filter"in e))return Kr();e.filter;e=e.filter;e.targetId,n=e.count||0,r=new Es(n),i=e.targetId,s=new $s(i,r)}return s}(this.R,t),t=function(t){if(!("targetChange"in t))return Jr.min();t=t.targetChange;return(!t.targetIds||!t.targetIds.length)&&t.readTime?pa(t.readTime):Jr.min()}(t);return this.listener._r(e,t)},vc.prototype.mr=function(t){var e,n,r,i={};i.database=wa(this.R),i.addTarget=(e=this.R,(r=Wi(r=(n=t).target)?{documents:{documents:[ma(e,r.path)]}}:{query:Ta(e,r)}).targetId=n.targetId,0<n.resumeToken.approximateByteSize()?r.resumeToken=fa(e,n.resumeToken):0<n.snapshotVersion.compareTo(Jr.min())&&(r.readTime=la(e,n.snapshotVersion.toTimestamp())),r);var o,t=(this.R,o=t,null==(t=function(){switch(o.purpose){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Kr()}}())?null:{"goog-listen-tags":t});t&&(i.labels=t),this.cr(i)},vc.prototype.yr=function(t){var e={};e.database=wa(this.R),e.removeTarget=t,this.cr(e)},vc),lc=(n(gc,ac=T),Object.defineProperty(gc.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),gc.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,ac.prototype.start.call(this)},gc.prototype.ar=function(){this.gr&&this.Er([])},gc.prototype.wr=function(t){return this.Hi.Oi("Write",t)},gc.prototype.onMessage=function(t){if(Hr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.gr){this.Zi.reset();var e=(n=t.writeResults,r=t.commitTime,n&&0<n.length?(Hr(void 0!==r),n.map(function(t){return n=r,(t=(e=t).updateTime?pa(e.updateTime):pa(n)).isEqual(Jr.min())&&(t=pa(n)),new ss(t,e.transformResults||[]);var e,n})):[]),n=pa(t.commitTime);return this.listener.Tr(n,e)}var n,r;return Hr(!t.writeResults||0===t.writeResults.length),this.gr=!0,this.listener.Ir()},gc.prototype.Ar=function(){var t={};t.database=wa(this.R),this.cr(t)},gc.prototype.Er=function(t){var e=this,t={streamToken:this.lastStreamToken,writes:t.map(function(t){return Ea(e.R,t)})};this.cr(t)},gc),fc=(n(yc,sc=function(){}),yc.prototype.br=function(){if(this.Rr)throw new Fr(Mr.FAILED_PRECONDITION,"The client has already been terminated.")},yc.prototype.Ni=function(e,n,r){var i=this;return this.br(),this.credentials.getToken().then(function(t){return i.Hi.Ni(e,n,r,t)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===Mr.UNAUTHENTICATED&&i.credentials.invalidateToken(),t):new Fr(Mr.UNKNOWN,t.toString())})},yc.prototype.$i=function(e,n,r){var i=this;return this.br(),this.credentials.getToken().then(function(t){return i.Hi.$i(e,n,r,t)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===Mr.UNAUTHENTICATED&&i.credentials.invalidateToken(),t):new Fr(Mr.UNKNOWN,t.toString())})},yc.prototype.terminate=function(){this.Rr=!0},yc),pc=(dc.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()}))},dc.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,1<=this.vr&&(this.Fr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},dc.prototype.set=function(t){this.Fr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},dc.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},dc.prototype.Cr=function(t){t="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Vr?(jr(t),this.Vr=!1):qr("OnlineStateTracker",t)},dc.prototype.Fr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},dc);function dc(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}function yc(t,e,n){var r=this;return(r=sc.call(this)||this).credentials=t,r.Hi=e,r.R=n,r.Rr=!1,r}function gc(t,e,n,r,i){var o=this;return(o=ac.call(this,t,"write_stream_connection_backoff","write_stream_idle",e,n,i)||this).R=r,o.gr=!1,o}function vc(t,e,n,r,i){var o=this;return(o=uc.call(this,t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i)||this).R=r,o}function mc(t,e,n,r,i,o){this.Se=t,this.zi=n,this.Hi=r,this.Ji=i,this.listener=o,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new cc(t,e)}function wc(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=i,this.qi=0,this.Ui=null,this.Ki=Date.now(),this.reset()}function bc(r){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:if(!Dc(r))return[3,4];e=0,n=r.Mr,t.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:t.sent(),t.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function _c(r){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:e=0,n=r.Mr,t.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:t.sent(),t.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function Ec(t,e){t.$r.has(e.targetId)||(t.$r.set(e.targetId,e),Nc(t)?Ac(t):Fc(t).er()&&Ic(t,e))}function Tc(t,e){var n=t,t=Fc(n);n.$r.delete(e),t.er()&&Sc(n,e),0===n.$r.size&&(t.er()?t.ir():Dc(n)&&n.Br.set("Unknown"))}function Ic(t,e){t.qr.U(e.targetId),Fc(t).mr(e)}function Sc(t,e){t.qr.U(e),Fc(t).yr(e)}function Ac(e){e.qr=new ea({getRemoteKeysForTarget:function(t){return e.remoteSyncer.getRemoteKeysForTarget(t)},lt:function(t){return e.$r.get(t)||null}}),Fc(e).start(),e.Br.Sr()}function Nc(t){return Dc(t)&&!Fc(t).tr()&&0<t.$r.size}function Dc(t){return 0===t.Or.size}function Cc(t){t.qr=void 0}function Rc(s,a,u){return y(this,void 0,void 0,function(){var n,o;return g(this,function(t){switch(t.label){case 0:if(s.Br.set("Online"),!(a instanceof Zs&&2===a.state&&a.cause))return[3,6];t.label=1;case 1:return t.trys.push([1,3,,5]),[4,function(o,s){return y(this,void 0,void 0,function(){var e,n,r,i;return g(this,function(t){switch(t.label){case 0:e=s.cause,n=0,r=s.targetIds,t.label=1;case 1:return n<r.length?(i=r[n],o.$r.has(i)?[4,o.remoteSyncer.rejectListen(i,e)]:[3,3]):[3,5];case 2:t.sent(),o.$r.delete(i),o.qr.removeTarget(i),t.label=3;case 3:t.label=4;case 4:return n++,[3,1];case 5:return[2]}})})}(s,a)];case 2:return t.sent(),[3,5];case 3:return n=t.sent(),qr("RemoteStore","Failed to remove targets %s: %s ",a.targetIds.join(","),n),[4,kc(s,n)];case 4:return t.sent(),[3,5];case 5:return[3,13];case 6:if(a instanceof Js?s.qr.X(a):a instanceof $s?s.qr.rt(a):s.qr.et(a),u.isEqual(Jr.min()))return[3,13];t.label=7;case 7:return t.trys.push([7,11,,13]),[4,fu(s.localStore)];case 8:return o=t.sent(),0<=u.compareTo(o)?[4,(i=u,(e=(r=s).qr.ut(i)).targetChanges.forEach(function(t,e){var n;0<t.resumeToken.approximateByteSize()&&((n=r.$r.get(e))&&r.$r.set(e,n.withResumeToken(t.resumeToken,i)))}),e.targetMismatches.forEach(function(t){var e=r.$r.get(t);e&&(r.$r.set(t,e.withResumeToken(ci.EMPTY_BYTE_STRING,e.snapshotVersion)),Sc(r,t),e=new qa(e.target,t,1,e.sequenceNumber),Ic(r,e))}),r.remoteSyncer.applyRemoteEvent(e))]:[3,10];case 9:t.sent(),t.label=10;case 10:return[3,13];case 11:return qr("RemoteStore","Failed to raise snapshot:",o=t.sent()),[4,kc(s,o)];case 12:return t.sent(),[3,13];case 13:return[2]}var r,i,e})})}function kc(n,r,i){return y(this,void 0,void 0,function(){var e=this;return g(this,function(t){switch(t.label){case 0:if(!Fa(r))throw r;return n.Or.add(1),[4,_c(n)];case 1:return t.sent(),n.Br.set("Offline"),i=i||function(){return fu(n.localStore)},n.asyncQueue.enqueueRetryable(function(){return y(e,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return qr("RemoteStore","Retrying IndexedDB access"),[4,i()];case 1:return t.sent(),n.Or.delete(1),[4,bc(n)];case 2:return t.sent(),[2]}})})}),[2]}})})}function Oc(e,n){return n().catch(function(t){return kc(e,t,n)})}function Lc(u){return y(this,void 0,void 0,function(){var i,o,s,a;return g(this,function(t){switch(t.label){case 0:o=xc(i=u),s=0<i.kr.length?i.kr[i.kr.length-1].batchId:-1,t.label=1;case 1:if(!(Dc(i)&&i.kr.length<10))return[3,7];t.label=2;case 2:return t.trys.push([2,4,,6]),[4,(e=i.localStore,n=s,(r=e).persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===n&&(n=-1),r._n.getNextMutationBatchAfterBatchId(t,n)}))];case 3:return null===(a=t.sent())?(0===i.kr.length&&o.ir(),[3,7]):(s=a.batchId,function(t,e){t.kr.push(e);t=xc(t);t.er()&&t.pr&&t.Er(e.mutations)}(i,a),[3,6]);case 4:return a=t.sent(),[4,kc(i,a)];case 5:return t.sent(),[3,6];case 6:return[3,1];case 7:return Pc(i)&&Mc(i),[2]}var e,n,r})})}function Pc(t){return Dc(t)&&!xc(t).tr()&&0<t.kr.length}function Mc(t){xc(t).start()}function Fc(n){var t,e,r,i=this;return n.Ur||(n.Ur=(t=n.datastore,e=n.asyncQueue,r={Ii:function(n){return y(this,void 0,void 0,function(){return g(this,function(t){return n.$r.forEach(function(t,e){Ic(n,t)}),[2]})})}.bind(null,n),Ri:function(e,n){return y(this,void 0,void 0,function(){return g(this,function(t){return Cc(e),Nc(e)?(e.Br.Nr(n),Ac(e)):e.Br.set("Unknown"),[2]})})}.bind(null,n),_r:Rc.bind(null,n)},t.br(),new hc(e,t.Hi,t.credentials,t.R,r)),n.Mr.push(function(e){return y(i,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return e?(n.Ur.sr(),Nc(n)?Ac(n):n.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,n.Ur.stop()];case 2:t.sent(),Cc(n),t.label=3;case 3:return[2]}})})})),n.Ur}function xc(n){var t,e,r,i=this;return n.Kr||(n.Kr=(t=n.datastore,e=n.asyncQueue,r={Ii:function(e){return y(this,void 0,void 0,function(){return g(this,function(t){return xc(e).Ar(),[2]})})}.bind(null,n),Ri:function(e,n){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return n&&xc(e).pr?[4,function(r,i){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return Rs(n=i.code)&&n!==Mr.ABORTED?(e=r.kr.shift(),xc(r).sr(),[4,Oc(r,function(){return r.remoteSyncer.rejectFailedWrite(e.batchId,i)})]):[3,3];case 1:return t.sent(),[4,Lc(r)];case 2:t.sent(),t.label=3;case 3:return[2]}})})}(e,n)]:[3,2];case 1:t.sent(),t.label=2;case 2:return Pc(e)&&Mc(e),[2]}})})}.bind(null,n),Ir:function(o){return y(this,void 0,void 0,function(){var e,n,r,i;return g(this,function(t){for(e=xc(o),n=0,r=o.kr;n<r.length;n++)i=r[n],e.Er(i.mutations);return[2]})})}.bind(null,n),Tr:function(r,i,o){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return e=r.kr.shift(),n=Ua.from(e,i,o),[4,Oc(r,function(){return r.remoteSyncer.applySuccessfulWrite(n)})];case 1:return t.sent(),[4,Lc(r)];case 2:return t.sent(),[2]}})})}.bind(null,n)},t.br(),new lc(e,t.Hi,t.credentials,t.R,r)),n.Mr.push(function(e){return y(i,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return e?(n.Kr.sr(),[4,Lc(n)]):[3,2];case 1:return t.sent(),[3,4];case 2:return[4,n.Kr.stop()];case 3:t.sent(),0<n.kr.length&&(qr("RemoteStore","Stopping write stream with "+n.kr.length+" pending writes"),n.kr=[]),t.label=4;case 4:return[2]}})})})),n.Kr}var Vc=(Uc.createAndSchedule=function(t,e,n,r,i){i=new Uc(t,e,Date.now()+n,r,i);return i.start(n),i},Uc.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},Uc.prototype.skipDelay=function(){return this.handleDelayElapsed()},Uc.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Fr(Mr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},Uc.prototype.handleDelayElapsed=function(){var e=this;this.asyncQueue.enqueueAndForget(function(){return null!==e.timerHandle?(e.clearTimeout(),e.op().then(function(t){return e.deferred.resolve(t)})):Promise.resolve()})},Uc.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},Uc);function Uc(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Oa,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}function qc(t,e){if(jr("AsyncQueue",e+": "+t),Fa(t))return new Fr(Mr.UNAVAILABLE,e+": "+t);throw t}function jc(){this.queries=new Za(Mo,Po),this.onlineState="Unknown",this.Gr=new Set}var Bc=(zc.emptySet=function(t){return new zc(t.comparator)},zc.prototype.has=function(t){return null!=this.keyedMap.get(t)},zc.prototype.get=function(t){return this.keyedMap.get(t)},zc.prototype.first=function(){return this.sortedSet.minKey()},zc.prototype.last=function(){return this.sortedSet.maxKey()},zc.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},zc.prototype.indexOf=function(t){t=this.keyedMap.get(t);return t?this.sortedSet.indexOf(t):-1},Object.defineProperty(zc.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),zc.prototype.forEach=function(n){this.sortedSet.inorderTraversal(function(t,e){return n(t),!1})},zc.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},zc.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},zc.prototype.isEqual=function(t){if(!(t instanceof zc))return!1;if(this.size!==t.size)return!1;for(var e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(!r.isEqual(i))return!1}return!0},zc.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},zc.prototype.copy=function(t,e){var n=new zc;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n},zc),Gc=(Qc.prototype.track=function(t){var e=t.doc.key,n=this.Qr.get(e);!n||0!==t.type&&3===n.type?this.Qr=this.Qr.insert(e,t):3===t.type&&1!==n.type?this.Qr=this.Qr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Qr=this.Qr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Qr=this.Qr.remove(e):1===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):Kr()},Qc.prototype.jr=function(){var n=[];return this.Qr.inorderTraversal(function(t,e){n.push(e)}),n},Qc),Kc=(Wc.fromInitialDocuments=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:0,doc:t})}),new Wc(t,e,Bc.emptySet(e),i,n,r,!0,!1)},Object.defineProperty(Wc.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),Wc.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Po(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},Wc),Hc=function(){this.Wr=void 0,this.listeners=[]};function Wc(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}function Qc(){this.Qr=new Os(Ti.comparator)}function zc(n){this.comparator=n?function(t,e){return n(t,e)||Ti.comparator(t.key,e.key)}:function(t,e){return Ti.comparator(t.key,e.key)},this.keyedMap=Ks,this.sortedSet=new Os(this.comparator)}function Yc(s,a){return y(this,void 0,void 0,function(){var e,n,r,i,o;return g(this,function(t){switch(t.label){case 0:if(e=s,n=a.query,r=!1,(i=e.queries.get(n))||(r=!0,i=new Hc),!r)return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),o=i,[4,e.onListen(n)];case 2:return o.Wr=t.sent(),[3,4];case 3:return o=t.sent(),o=qc(o,"Initialization of query '"+Fo(a.query)+"' failed"),[2,void a.onError(o)];case 4:return e.queries.set(n,i),i.listeners.push(a),a.zr(e.onlineState),i.Wr&&a.Hr(i.Wr)&&Jc(e),[2]}})})}function Xc(s,a){return y(this,void 0,void 0,function(){var e,n,r,i,o;return g(this,function(t){return e=s,n=a.query,r=!1,(i=e.queries.get(n))&&0<=(o=i.listeners.indexOf(a))&&(i.listeners.splice(o,1),r=0===i.listeners.length),r?[2,(e.queries.delete(n),e.onUnlisten(n))]:[2]})})}function Jc(t){t.Gr.forEach(function(t){t.next()})}var $c=(oh.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new Kc(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),o=!0):this.eo(t,this.onlineState)&&(this.no(t),o=!0),this.Xr=t,o},oh.prototype.onError=function(t){this.Jr.error(t)},oh.prototype.zr=function(t){this.onlineState=t;var e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e},oh.prototype.eo=function(t,e){return!t.fromCache||!(this.options.so&&"Offline"!==e||t.docs.isEmpty()&&"Offline"!==e)},oh.prototype.Zr=function(t){if(0<t.docChanges.length)return!0;var e=this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},oh.prototype.no=function(t){t=Kc.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},oh),Zc=(ih.prototype.io=function(){return"metadata"in this.payload},ih),th=(rh.prototype.qn=function(t){return va(this.R,t)},rh.prototype.Un=function(t){return t.metadata.exists?(e=this.R,n=t.document,r=va(e,n.name),e=pa(n.updateTime),n=new Vi({mapValue:{fields:n.fields}}),n=qi.newFoundDocument(r,e,n)):qi.newNoDocument(this.qn(t.metadata.name),this.Kn(t.metadata.readTime));var e,n,r},rh.prototype.Kn=pa,rh),eh=(nh.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},nh.prototype.co=function(t){for(var e=new Map,n=new th(this.R),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.qn(o.metadata.name),a=0,u=o.metadata.queries;a<u.length;a++){var c=u[a],h=(e.get(c)||Qs()).add(s);e.set(c,h)}}return e},nh.prototype.complete=function(){return y(this,void 0,void 0,function(){var e,n,r,i;return g(this,function(t){switch(t.label){case 0:return[4,function(l,f,p,d){return y(this,void 0,void 0,function(){var n,r,i,o,e,s,a,u,c,h;return g(this,function(t){switch(t.label){case 0:for(n=l,r=Qs(),i=js,o=Hs,e=0,s=p;e<s.length;e++)a=s[e],u=f.qn(a.metadata.name),a.document&&(r=r.add(u)),i=i.insert(u,f.Un(a)),o=o.insert(u,f.Kn(a.metadata.readTime));return c=n.On.newChangeBuffer({trackRemovals:!0}),[4,yu(n,Oo(So(oi.fromString("__bundle__/docs/"+d))))];case 1:return h=t.sent(),[2,n.persistence.runTransaction("Apply bundle documents","readwrite",function(e){return du(e,c,i,Jr.min(),o).next(function(t){return c.apply(e),t}).next(function(t){return n.qe.removeMatchingKeysForTargetId(e,h.targetId).next(function(){return n.qe.addMatchingKeys(e,r,h.targetId)}).next(function(){return n.Mn.En(e,t)}).next(function(){return t})})})]}})})}(this.localStore,new th(this.R),this.documents,this.ro.id)];case 1:e=t.sent(),n=this.co(this.documents),r=0,i=this.queries,t.label=2;case 2:return r<i.length?(i=i[r],[4,function(e,i,o){return void 0===o&&(o=Qs()),y(this,void 0,void 0,function(){var n,r;return g(this,function(t){switch(t.label){case 0:return[4,yu(e,Oo(Ka(i.bundledQuery)))];case 1:return n=t.sent(),[2,(r=e).persistence.runTransaction("Save named query","readwrite",function(t){var e=pa(i.readTime);if(0<=n.snapshotVersion.compareTo(e))return r.Ke.saveNamedQuery(t,i);e=n.withResumeToken(ci.EMPTY_BYTE_STRING,e);return r.Fn=r.Fn.insert(e.targetId,e),r.qe.updateTargetData(t,e).next(function(){return r.qe.removeMatchingKeysForTargetId(t,n.targetId)}).next(function(){return r.qe.addMatchingKeys(t,o,n.targetId)}).next(function(){return r.Ke.saveNamedQuery(t,i)})})]}})})}(this.localStore,i,n.get(i.name))]):[3,5];case 3:t.sent(),t.label=4;case 4:return r++,[3,2];case 5:return[2,(this.progress.taskState="Success",new $a(Object.assign({},this.progress),e))]}})})},nh);function nh(t,e,n){this.ro=t,this.localStore=e,this.R=n,this.queries=[],this.documents=[],this.progress=sh(t)}function rh(t){this.R=t}function ih(t,e){this.payload=t,this.byteLength=e}function oh(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}function sh(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}var ah=function(t){this.key=t},uh=function(t){this.key=t},ch=(Object.defineProperty(dh.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),dh.prototype._o=function(t,e){var s=this,a=e?e.mo:new Gc,u=(e||this).fo,c=(e||this).mutatedKeys,h=u,l=!1,f=Ao(this.query)&&u.size===this.query.limit?u.last():null,p=No(this.query)&&u.size===this.query.limit?u.first():null;if(t.inorderTraversal(function(t,e){var n=u.get(t),r=xo(s.query,e)?e:null,i=!!n&&s.mutatedKeys.has(n.key),o=!!r&&(r.hasLocalMutations||s.mutatedKeys.has(r.key)&&r.hasCommittedMutations),e=!1;n&&r?n.data.isEqual(r.data)?i!==o&&(a.track({type:3,doc:r}),e=!0):s.yo(n,r)||(a.track({type:2,doc:r}),e=!0,(f&&0<s.lo(r,f)||p&&s.lo(r,p)<0)&&(l=!0)):!n&&r?(a.track({type:0,doc:r}),e=!0):n&&!r&&(a.track({type:1,doc:n}),e=!0,(f||p)&&(l=!0)),e&&(c=r?(h=h.add(r),o?c.add(t):c.delete(t)):(h=h.delete(t),c.delete(t)))}),Ao(this.query)||No(this.query))for(;h.size>this.query.limit;){var n=Ao(this.query)?h.last():h.first(),h=h.delete(n.key),c=c.delete(n.key);a.track({type:1,doc:n})}return{fo:h,mo:a,Nn:l,mutatedKeys:c}},dh.prototype.yo=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},dh.prototype.applyChanges=function(t,e,n){var o=this,r=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var i=t.mo.jr();i.sort(function(t,e){return r=t.type,i=e.type,n(r)-n(i)||o.lo(t.doc,e.doc);function n(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Kr()}}var r,i}),this.po(n);var s=e?this.Eo():[],n=0===this.ho.size&&this.current?1:0,e=n!==this.ao;return this.ao=n,0!==i.length||e?{snapshot:new Kc(this.query,t.fo,r,i,t.mutatedKeys,0==n,e,!1),To:s}:{To:s}},dh.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new Gc,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},dh.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},dh.prototype.po=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e.uo=e.uo.add(t)}),t.modifiedDocuments.forEach(function(t){}),t.removedDocuments.forEach(function(t){return e.uo=e.uo.delete(t)}),this.current=t.current)},dh.prototype.Eo=function(){var e=this;if(!this.current)return[];var n=this.ho;this.ho=Qs(),this.fo.forEach(function(t){e.Io(t.key)&&(e.ho=e.ho.add(t.key))});var r=[];return n.forEach(function(t){e.ho.has(t)||r.push(new uh(t))}),this.ho.forEach(function(t){n.has(t)||r.push(new ah(t))}),r},dh.prototype.Ao=function(t){this.uo=t.Bn,this.ho=Qs();t=this._o(t.documents);return this.applyChanges(t,!0)},dh.prototype.Ro=function(){return Kc.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},dh),hh=function(t,e,n){this.query=t,this.targetId=e,this.view=n},lh=function(t){this.key=t,this.bo=!1},fh=(Object.defineProperty(ph.prototype,"isPrimaryClient",{get:function(){return!0===this.$o},enumerable:!1,configurable:!0}),ph);function ph(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.vo={},this.Po=new Za(Mo,Po),this.Vo=new Map,this.So=new Set,this.Do=new Os(Ti.comparator),this.Co=new Map,this.No=new _u,this.xo={},this.Fo=new Map,this.ko=Qa.Yt(),this.onlineState="Unknown",this.$o=void 0}function dh(t,e){this.query=t,this.uo=e,this.ao=null,this.current=!1,this.ho=Qs(),this.mutatedKeys=Qs(),this.lo=Vo(t),this.fo=new Bc(this.lo)}function yh(a,u){return y(this,void 0,void 0,function(){var n,r,i,o,s;return g(this,function(t){switch(t.label){case 0:return(e=a).remoteStore.remoteSyncer.applyRemoteEvent=vh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=function(t,e){var n=t,t=n.Co.get(e);if(t&&t.bo)return Qs().add(t.key);var r=Qs(),e=n.Vo.get(e);if(!e)return r;for(var i=0,o=e;i<o.length;i++){var s=o[i],s=n.Po.get(s);r=r.unionWith(s.view.wo)}return r}.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=function(o,s,a){return y(this,void 0,void 0,function(){var e,n,r,i;return g(this,function(t){switch(t.label){case 0:return(e=o).sharedClientState.updateQueryState(s,"rejected",a),i=e.Co.get(s),(n=i&&i.key)?(r=(r=new Os(Ti.comparator)).insert(n,qi.newNoDocument(n,Jr.min())),i=Qs().add(n),i=new Ys(Jr.min(),new Map,new Us(zr),r,i),[4,vh(e,i)]):[3,2];case 1:return t.sent(),e.Do=e.Do.remove(n),e.Co.delete(s),Sh(e),[3,4];case 2:return[4,gu(e.localStore,s,!1).then(function(){return Eh(e,s,a)}).catch(Ja)];case 3:t.sent(),t.label=4;case 4:return[2]}})})}.bind(null,e),e.vo._r=function(t,e){for(var n=t,r=!1,i=0,o=e;i<o.length;i++){var s=o[i],a=s.query,a=n.queries.get(a);if(a){for(var u=0,c=a.listeners;u<c.length;u++)c[u].Hr(s)&&(r=!0);a.Wr=s}}r&&Jc(n)}.bind(null,e.eventManager),e.vo.Mo=function(t,e,n){var r=t;if(t=r.queries.get(e))for(var i=0,o=t.listeners;i<o.length;i++)o[i].onError(n);r.queries.delete(e)}.bind(null,e.eventManager),(s=(n=e).Po.get(u))?(r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.Ro(),[3,4]):[3,1];case 1:return[4,yu(n.localStore,Oo(u))];case 2:return o=t.sent(),s=n.sharedClientState.addLocalQueryTarget(o.targetId),r=o.targetId,[4,function(i,o,s,a){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:return i.Oo=function(t,e,n){return function(r,i,o,s){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return(e=i.view._o(o)).Nn?[4,vu(r.localStore,i.query,!1).then(function(t){t=t.documents;return i.view._o(t,e)})]:[3,2];case 1:e=t.sent(),t.label=2;case 2:return n=s&&s.targetChanges.get(i.targetId),n=i.view.applyChanges(e,r.isPrimaryClient,n),[2,(Ih(r,i.targetId,n.To),n.snapshot)]}})})}(i,t,e,n)},[4,vu(i.localStore,o,!0)];case 1:return n=t.sent(),r=new ch(o,n.Bn),e=r._o(n.documents),n=Xs.createSynthesizedTargetChangeForCurrentChange(s,a&&"Offline"!==i.onlineState),n=r.applyChanges(e,i.isPrimaryClient,n),Ih(i,s,n.To),r=new hh(o,s,r),[2,(i.Po.set(o,r),i.Vo.has(s)?i.Vo.get(s).push(o):i.Vo.set(s,[o]),n.snapshot)]}})})}(n,u,r,"current"===s)];case 3:i=t.sent(),n.isPrimaryClient&&Ec(n.remoteStore,o),t.label=4;case 4:return[2,i]}var e})})}function gh(f,p,d){return y(this,void 0,void 0,function(){var s,l;return g(this,function(t){switch(t.label){case 0:(o=f).remoteStore.remoteSyncer.applySuccessfulWrite=function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:e=i,n=o.batch.batchId,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,lu(e.localStore,o)];case 2:return r=t.sent(),_h(e,n,null),bh(e,n),e.sharedClientState.updateMutationState(n,"acknowledged"),[4,Ah(e,r)];case 3:return t.sent(),[3,6];case 4:return[4,Ja(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})}.bind(null,o),o.remoteStore.remoteSyncer.rejectFailedWrite=function(s,a,u){return y(this,void 0,void 0,function(){var n,o;return g(this,function(t){switch(t.label){case 0:n=s,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,(e=n.localStore,r=a,(i=e).persistence.runTransaction("Reject batch","readwrite-primary",function(e){var n;return i._n.lookupMutationBatch(e,r).next(function(t){return Hr(null!==t),n=t.keys(),i._n.removeMutationBatch(e,t)}).next(function(){return i._n.performConsistencyCheck(e)}).next(function(){return i.Mn.pn(e,n)})}))];case 2:return o=t.sent(),_h(n,a,u),bh(n,a),n.sharedClientState.updateMutationState(a,"rejected",u),[4,Ah(n,o)];case 3:return t.sent(),[3,6];case 4:return[4,Ja(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}var e,r,i})})}.bind(null,o),l=o,t.label=1;case 1:return t.trys.push([1,5,,6]),[4,(r=l.localStore,a=p,c=r,h=Xr.now(),i=a.reduce(function(t,e){return t.add(e.key)},Qs()),c.persistence.runTransaction("Locally write mutations","readwrite",function(s){return c.Mn.pn(s,i).next(function(t){u=t;for(var e=[],n=0,r=a;n<r.length;n++){var i=r[n],o=function(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e.data.field(o.field),s=Bo(o.transform,s||null);null!=s&&(n=null==n?Vi.empty():n).set(o.field,s)}return n||null}(i,u.get(i.key));null!=o&&e.push(new gs(i.key,o,function s(t){var a=[];return ei(t.fields,function(t,e){var n=new ai([t]);if(Fi(e))if(0===(e=s(e.mapValue).fields).length)a.push(n);else for(var r=0,i=e;r<i.length;r++){var o=i[r];a.push(n.child(o))}else a.push(n)}),new ui(a)}(o.value.mapValue),as.exists(!0)))}return c._n.addMutationBatch(s,h,e,a)})}).then(function(t){return t.applyToLocalDocumentSet(u),{batchId:t.batchId,changes:u}}))];case 2:return s=t.sent(),l.sharedClientState.addPendingMutation(s.batchId),e=l,n=s.batchId,o=d,r=(r=(r=e.xo[e.currentUser.toKey()])||new Os(zr)).insert(n,o),e.xo[e.currentUser.toKey()]=r,[4,Ah(l,s.changes)];case 3:return t.sent(),[4,Lc(l.remoteStore)];case 4:return t.sent(),[3,6];case 5:return l=t.sent(),l=qc(l,"Failed to persist write"),d.reject(l),[3,6];case 6:return[2]}var e,n,r,a,u,c,h,i,o})})}function vh(r,i){return y(this,void 0,void 0,function(){var n,e;return g(this,function(t){switch(t.label){case 0:n=r,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,pu(n.localStore,i)];case 2:return e=t.sent(),i.targetChanges.forEach(function(t,e){e=n.Co.get(e);e&&(Hr(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),0<t.addedDocuments.size?e.bo=!0:0<t.modifiedDocuments.size?Hr(e.bo):0<t.removedDocuments.size&&(Hr(e.bo),e.bo=!1))}),[4,Ah(n,e,i)];case 3:return t.sent(),[3,6];case 4:return[4,Ja(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})}function mh(t,n,e){var r,t=t;(t.isPrimaryClient&&0===e||!t.isPrimaryClient&&1===e)&&(r=[],t.Po.forEach(function(t,e){e=e.view.zr(n);e.snapshot&&r.push(e.snapshot)}),function(t,i){t.onlineState=i;var o=!1;t.queries.forEach(function(t,e){for(var n=0,r=e.listeners;n<r.length;n++)r[n].zr(i)&&(o=!0)}),o&&Jc(t)}(t.eventManager,n),r.length&&t.vo._r(r),t.onlineState=n,t.isPrimaryClient&&t.sharedClientState.setOnlineState(n))}function wh(o,s){return y(this,void 0,void 0,function(){var n,r,i;return g(this,function(t){switch(t.label){case 0:Dc((n=o).remoteStore)||qr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,(e=n.localStore).persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e._n.getHighestUnacknowledgedBatchId(t)})];case 2:return-1===(r=t.sent())?[2,void s.resolve()]:((i=n.Fo.get(r)||[]).push(s),n.Fo.set(r,i),[3,4]);case 3:return i=t.sent(),i=qc(i,"Initialization of waitForPendingWrites() operation failed"),s.reject(i),[3,4];case 4:return[2]}var e})})}function bh(t,e){(t.Fo.get(e)||[]).forEach(function(t){t.resolve()}),t.Fo.delete(e)}function _h(t,e,n){var r=t,i=r.xo[r.currentUser.toKey()];i&&((t=i.get(e))&&(n?t.reject(n):t.resolve(),i=i.remove(e)),r.xo[r.currentUser.toKey()]=i)}function Eh(e,t,n){void 0===n&&(n=null),e.sharedClientState.removeLocalQueryTarget(t);for(var r=0,i=e.Vo.get(t);r<i.length;r++){var o=i[r];e.Po.delete(o),n&&e.vo.Mo(o,n)}e.Vo.delete(t),e.isPrimaryClient&&e.No.Zn(t).forEach(function(t){e.No.containsKey(t)||Th(e,t)})}function Th(t,e){t.So.delete(e.path.canonicalString());var n=t.Do.get(e);null!==n&&(Tc(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),Sh(t))}function Ih(t,e,n){for(var r,i,o,s=0,a=n;s<a.length;s++){var u=a[s];u instanceof ah?(t.No.addReference(u.key,e),r=t,o=void 0,i=(o=(i=u).key).path.canonicalString(),r.Do.get(o)||r.So.has(i)||(qr("SyncEngine","New document in limbo: "+o),r.So.add(i),Sh(r))):u instanceof uh?(qr("SyncEngine","Document no longer in limbo: "+u.key),t.No.removeReference(u.key,e),t.No.containsKey(u.key)||Th(t,u.key)):Kr()}}function Sh(t){for(;0<t.So.size&&t.Do.size<t.maxConcurrentLimboResolutions;){var e=t.So.values().next().value;t.So.delete(e);var n=new Ti(oi.fromString(e)),e=t.ko.next();t.Co.set(e,new lh(n)),t.Do=t.Do.insert(n,e),Ec(t.remoteStore,new qa(Oo(So(n.path)),e,2,Or.o))}}function Ah(e,s,a){return y(this,void 0,void 0,function(){var n,r,i,o;return g(this,function(t){switch(t.label){case 0:return r=[],i=[],o=[],(n=e).Po.isEmpty()?[3,3]:(n.Po.forEach(function(t,e){o.push(n.Oo(e,s,a).then(function(t){t&&(n.isPrimaryClient&&n.sharedClientState.updateQueryState(e.targetId,t.fromCache?"not-current":"current"),r.push(t),t=eu.Pn(e.targetId,t),i.push(t))}))}),[4,Promise.all(o)]);case 1:return t.sent(),n.vo._r(r),[4,function(u,c){return y(this,void 0,void 0,function(){var r,e,n,i,o,s,a;return g(this,function(t){switch(t.label){case 0:r=u,t.label=1;case 1:return t.trys.push([1,3,,4]),[4,r.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(n){return La.forEach(c,function(e){return La.forEach(e.bn,function(t){return r.persistence.referenceDelegate.addReference(n,e.targetId,t)}).next(function(){return La.forEach(e.vn,function(t){return r.persistence.referenceDelegate.removeReference(n,e.targetId,t)})})})})];case 2:return t.sent(),[3,4];case 3:if(!Fa(e=t.sent()))throw e;return qr("LocalStore","Failed to update sequence numbers: "+e),[3,4];case 4:for(n=0,i=c;n<i.length;n++)a=i[n],o=a.targetId,a.fromCache||(s=r.Fn.get(o),a=s.snapshotVersion,a=s.withLastLimboFreeSnapshotVersion(a),r.Fn=r.Fn.insert(o,a));return[2]}})})}(n.localStore,i)];case 2:t.sent(),t.label=3;case 3:return[2]}})})}function Nh(i,o){return y(this,void 0,void 0,function(){var n,r;return g(this,function(t){switch(t.label){case 0:return(n=i).currentUser.isEqual(o)?[3,3]:(qr("SyncEngine","User change. New user:",o.toKey()),[4,hu(n.localStore,o)]);case 1:return r=t.sent(),n.currentUser=o,(e=n).Fo.forEach(function(t){t.forEach(function(t){t.reject(new Fr(Mr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Fo.clear(),n.sharedClientState.handleUserChange(o,r.removedBatchIds,r.addedBatchIds),[4,Ah(n,r.Ln)];case 2:t.sent(),t.label=3;case 3:return[2]}var e})})}function Dh(t,e,n){var r=t;!function(f,p,d){return y(this,void 0,void 0,function(){var a,u,c,h,l;return g(this,function(t){switch(t.label){case 0:return t.trys.push([0,14,,15]),[4,p.getMetadata()];case 1:return a=t.sent(),[4,(r=f.localStore,o=r,s=pa((i=a).createTime),o.persistence.runTransaction("hasNewerBundle","readonly",function(t){return o.Ke.getBundleMetadata(t,i.id)}).then(function(t){return!!t&&0<=t.createTime.compareTo(s)}))];case 2:return t.sent()?[4,p.close()]:[3,4];case 3:return[2,(t.sent(),void d._completeWith({taskState:"Success",documentsLoaded:a.totalDocuments,bytesLoaded:a.totalBytes,totalDocuments:a.totalDocuments,totalBytes:a.totalBytes}))];case 4:return d._updateProgress(sh(a)),u=new eh(a,f.localStore,p.R),[4,p.Lo()];case 5:c=t.sent(),t.label=6;case 6:return c?[4,u.oo(c)]:[3,10];case 7:return(h=t.sent())&&d._updateProgress(h),[4,p.Lo()];case 8:c=t.sent(),t.label=9;case 9:return[3,6];case 10:return[4,u.complete()];case 11:return l=t.sent(),[4,Ah(f,l.wn,void 0)];case 12:return t.sent(),[4,(r=f.localStore,e=a,(n=r).persistence.runTransaction("Save bundle","readwrite",function(t){return n.Ke.saveBundleMetadata(t,e)}))];case 13:return t.sent(),d._completeWith(l.progress),[3,15];case 14:return Br("SyncEngine","Loading bundle failed with "+(l=t.sent())),d._failWith(l),[3,15];case 15:return[2]}var e,n,r,i,o,s})})}(r,e,n).then(function(){r.sharedClientState.notifyBundleLoaded()})}var Ch=(Oh.prototype.initialize=function(e){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return this.R=ic(e.databaseInfo.databaseId),this.sharedClientState=this.Bo(e),this.persistence=this.qo(e),[4,this.persistence.start()];case 1:return t.sent(),this.gcScheduler=this.Uo(e),this.localStore=this.Ko(e),[2]}})})},Oh.prototype.Uo=function(t){return null},Oh.prototype.Ko=function(t){return e=this.persistence,n=new nu,r=t.initialUser,t=this.R,new ru(e,n,r,t);var e,n,r},Oh.prototype.qo=function(t){return new Nu(Cu.bs,this.R)},Oh.prototype.Bo=function(t){return new Ku},Oh.prototype.terminate=function(){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}})})},Oh),Rh=(kh.prototype.initialize=function(n,r){return y(this,void 0,void 0,function(){var e=this;return g(this,function(t){switch(t.label){case 0:return this.localStore?[3,2]:(this.localStore=n.localStore,this.sharedClientState=n.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!n.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return mh(e.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=Nh.bind(null,this.syncEngine),[4,function(n,r){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=n,r?(e.Or.delete(2),[4,bc(e)]):[3,2];case 1:return t.sent(),[3,5];case 2:return r?[3,4]:(e.Or.add(2),[4,_c(e)]);case 3:t.sent(),e.Br.set("Unknown"),t.label=4;case 4:t.label=5;case 5:return[2]}})})}(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},kh.prototype.createEventManager=function(t){return new jc},kh.prototype.createDatastore=function(t){var e=ic(t.databaseInfo.databaseId),n=(n=t.databaseInfo,new Yu(n));return t=t.credentials,new fc(t,n,e)},kh.prototype.createRemoteStore=function(t){var e=this,n=this.localStore,r=this.datastore,i=t.asyncQueue,o=function(t){return mh(e.syncEngine,t,0)},t=new(Wu.yt()?Wu:Hu);return new oc(n,r,i,o,t)},kh.prototype.createSyncEngine=function(t,e){return function(t,e,n,r,i,o,s){o=new fh(t,e,n,r,i,o);return s&&(o.$o=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)},kh.prototype.terminate=function(){return function(n){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=n,qr("RemoteStore","RemoteStore shutting down."),e.Or.add(5),[4,_c(e)];case 1:return t.sent(),e.Lr.shutdown(),e.Br.set("Unknown"),[2]}})})}(this.remoteStore)},kh);function kh(){}function Oh(){this.synchronizeTabs=!1}function Lh(n,r){void 0===r&&(r=10240);var i=0;return{read:function(){return y(this,void 0,void 0,function(){var e;return g(this,function(t){return i<n.byteLength?(e={value:n.slice(i,i+r),done:!1},[2,(i+=r,e)]):[2,{done:!0}]})})},cancel:function(){return y(this,void 0,void 0,function(){return g(this,function(t){return[2]})})},releaseLock:function(){},closed:Promise.reject("unimplemented")}}var Ph=(Gh.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},Gh.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},Gh.prototype.Wo=function(){this.muted=!0},Gh.prototype.jo=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},Gh),Mh=(Bh.prototype.close=function(){return this.Go.cancel()},Bh.prototype.getMetadata=function(){return y(this,void 0,void 0,function(){return g(this,function(t){return[2,this.metadata.promise]})})},Bh.prototype.Lo=function(){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}})})},Bh.prototype.Ho=function(){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:return[4,this.Jo()];case 1:return null===(e=t.sent())?[2,null]:(r=this.zo.decode(e),n=Number(r),isNaN(n)&&this.Yo("length string ("+r+") is not valid number"),[4,this.Xo(n)]);case 2:return r=t.sent(),[2,new Zc(JSON.parse(r),e.length+n)]}})})},Bh.prototype.Zo=function(){return this.buffer.findIndex(function(t){return t==="{".charCodeAt(0)})},Bh.prototype.Jo=function(){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return this.Zo()<0?[4,this.tc()]:[3,3];case 1:if(t.sent())return[3,3];t.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((e=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),n=this.buffer.slice(0,e),[2,(this.buffer=this.buffer.slice(e),n)])}})})},Bh.prototype.Xo=function(n){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return this.buffer.length<n?[4,this.tc()]:[3,3];case 1:t.sent()&&this.Yo("Reached the end of bundle when more is expected."),t.label=2;case 2:return[3,0];case 3:return e=this.zo.decode(this.buffer.slice(0,n)),[2,(this.buffer=this.buffer.slice(n),e)]}})})},Bh.prototype.Yo=function(t){throw this.Go.cancel(),new Error("Invalid bundle format: "+t)},Bh.prototype.tc=function(){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return[4,this.Go.read()];case 1:return(e=t.sent()).done||((n=new Uint8Array(this.buffer.length+e.value.length)).set(this.buffer),n.set(e.value,this.buffer.length),this.buffer=n),[2,e.done]}})})},Bh),Fh=(jh.prototype.lookup=function(r){return y(this,void 0,void 0,function(){var e,n=this;return g(this,function(t){switch(t.label){case 0:if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new Fr(Mr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(s,a){return y(this,void 0,void 0,function(){var n,e,r,i,o;return g(this,function(t){switch(t.label){case 0:return e=wa((n=s).R)+"/documents",r={documents:a.map(function(t){return ga(n.R,t)})},[4,n.$i("BatchGetDocuments",e,r)];case 1:return r=t.sent(),i=new Map,r.forEach(function(t){var e,t=(e=n.R,"found"in(t=t)?function(t,e){Hr(!!e.found),e.found.name,e.found.updateTime;var n=va(t,e.found.name),t=pa(e.found.updateTime),e=new Vi({mapValue:{fields:e.found.fields}});return qi.newFoundDocument(n,t,e)}(e,t):"missing"in t?function(t,e){Hr(!!e.missing),Hr(!!e.readTime);t=va(t,e.missing),e=pa(e.readTime);return qi.newNoDocument(t,e)}(e,t):Kr());i.set(t.key.toString(),t)}),o=[],[2,(a.forEach(function(t){t=i.get(t.toString());Hr(!!t),o.push(t)}),o)]}})})}(this.datastore,r)];case 1:return[2,((e=t.sent()).forEach(function(t){return n.recordVersion(t)}),e)]}})})},jh.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},jh.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},jh.prototype.delete=function(t){this.write(new As(t,this.precondition(t))),this.writtenDocs.add(t.toString())},jh.prototype.commit=function(){return y(this,void 0,void 0,function(){var e,n=this;return g(this,function(t){switch(t.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return e=this.readVersions,this.mutations.forEach(function(t){e.delete(t.key.toString())}),e.forEach(function(t,e){e=Ti.fromPath(e);n.mutations.push(new Ns(e,n.precondition(e)))}),[4,function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:return n=wa((e=i).R)+"/documents",r={writes:o.map(function(t){return Ea(e.R,t)})},[4,e.Ni("Commit",n,r)];case 1:return t.sent(),[2]}})})}(this.datastore,this.mutations)];case 1:return t.sent(),this.committed=!0,[2]}})})},jh.prototype.recordVersion=function(t){var e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw Kr();e=Jr.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Fr(Mr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},jh.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?as.updateTime(e):as.none()},jh.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(this.writtenDocs.has(t.toString())||!e)return as.exists(!0);if(e.isEqual(Jr.min()))throw new Fr(Mr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return as.updateTime(e)},jh.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},jh.prototype.ensureCommitNotCalled=function(){},jh),xh=(qh.prototype.run=function(){--this.ec,this.nc()},qh.prototype.nc=function(){var t=this;this.Zi.ji(function(){return y(t,void 0,void 0,function(){var e,n,r=this;return g(this,function(t){return e=new Fh(this.datastore),(n=this.sc(e))&&n.then(function(t){r.asyncQueue.enqueueAndForget(function(){return e.commit().then(function(){r.deferred.resolve(t)}).catch(function(t){r.ic(t)})})}).catch(function(t){r.ic(t)}),[2]})})})},qh.prototype.sc=function(t){try{var e=this.updateFunction(t);return!_i(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},qh.prototype.ic=function(t){var e=this;0<this.ec&&this.rc(t)?(--this.ec,this.asyncQueue.enqueueAndForget(function(){return e.nc(),Promise.resolve()})):this.deferred.reject(t)},qh.prototype.rc=function(t){if("FirebaseError"!==t.name)return!1;t=t.code;return"aborted"===t||"failed-precondition"===t||!Rs(t)},qh),Vh=(Uh.prototype.getConfiguration=function(){return y(this,void 0,void 0,function(){return g(this,function(t){return[2,{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}]})})},Uh.prototype.setCredentialChangeListener=function(t){this.credentialListener=t},Uh.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new Fr(Mr.FAILED_PRECONDITION,"The client has already been terminated.")},Uh.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var n=new Oa;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return t.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:t.sent(),t.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:t.sent(),t.label=4;case 4:return this.credentials.removeChangeListener(),n.resolve(),[3,6];case 5:return e=t.sent(),e=qc(e,"Failed to shutdown persistence"),n.reject(e),[3,6];case 6:return[2]}})})}),n.promise},Uh);function Uh(t,e,n){var r=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=Ru.UNAUTHENTICATED,this.clientId=Wr.u(),this.credentialListener=function(){return Promise.resolve()},this.credentials.setChangeListener(e,function(e){return y(r,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return qr("FirestoreClient","Received user=",e.uid),[4,this.credentialListener(e)];case 1:return t.sent(),this.user=e,[2]}})})})}function qh(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new cc(this.asyncQueue,"transaction_retry")}function jh(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}function Bh(t,e){var n=this;this.Go=t,this.R=e,this.metadata=new Oa,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then(function(t){t&&t.io()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))},function(t){return n.metadata.reject(t)})}function Gh(t){this.observer=t,this.muted=!1}function Kh(e){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return e.offlineComponents?[3,2]:(qr("FirestoreClient","Using default OfflineComponentProvider"),[4,function(i,o){return y(this,void 0,void 0,function(){var e,n,r=this;return g(this,function(t){switch(t.label){case 0:return i.asyncQueue.verifyOperationInProgress(),qr("FirestoreClient","Initializing OfflineComponentProvider"),[4,i.getConfiguration()];case 1:return e=t.sent(),[4,o.initialize(e)];case 2:return t.sent(),n=e.initialUser,i.setCredentialChangeListener(function(e){return y(r,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return n.isEqual(e)?[3,2]:[4,hu(o.localStore,e)];case 1:t.sent(),n=e,t.label=2;case 2:return[2]}})})}),o.persistence.setDatabaseDeletedListener(function(){return i.terminate()}),i.offlineComponents=o,[2]}})})}(e,new Ch)]);case 1:t.sent(),t.label=2;case 2:return[2,e.offlineComponents]}})})}function Hh(e){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return e.onlineComponents?[3,2]:(qr("FirestoreClient","Using default OnlineComponentProvider"),[4,function(r,i){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return r.asyncQueue.verifyOperationInProgress(),[4,Kh(r)];case 1:return e=t.sent(),qr("FirestoreClient","Initializing OnlineComponentProvider"),[4,r.getConfiguration()];case 2:return n=t.sent(),[4,i.initialize(e,n)];case 3:return t.sent(),r.setCredentialChangeListener(function(t){return function(r,i){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return(e=r).asyncQueue.verifyOperationInProgress(),qr("RemoteStore","RemoteStore received new credentials"),n=Dc(e),e.Or.add(3),[4,_c(e)];case 1:return t.sent(),n&&e.Br.set("Unknown"),[4,e.remoteSyncer.handleCredentialChange(i)];case 2:return t.sent(),e.Or.delete(3),[4,bc(e)];case 3:return t.sent(),[2]}})})}(i.remoteStore,t)}),r.onlineComponents=i,[2]}})})}(e,new Rh)]);case 1:t.sent(),t.label=2;case 2:return[2,e.onlineComponents]}})})}function Wh(t){return Kh(t).then(function(t){return t.persistence})}function Qh(t){return Kh(t).then(function(t){return t.localStore})}function zh(t){return Hh(t).then(function(t){return t.remoteStore})}function Yh(t){return Hh(t).then(function(t){return t.syncEngine})}function Xh(r){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return[4,Hh(r)];case 1:return e=t.sent(),[2,((n=e.eventManager).onListen=yh.bind(null,e.syncEngine),n.onUnlisten=function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:return n=(e=i).Po.get(o),1<(r=e.Vo.get(n.targetId)).length?[2,(e.Vo.set(n.targetId,r.filter(function(t){return!Po(t,o)})),void e.Po.delete(o))]:e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(n.targetId),e.sharedClientState.isActiveQueryTarget(n.targetId)?[3,2]:[4,gu(e.localStore,n.targetId,!1).then(function(){e.sharedClientState.clearQueryState(n.targetId),Tc(e.remoteStore,n.targetId),Eh(e,n.targetId)}).catch(Ja)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return Eh(e,n.targetId),[4,gu(e.localStore,n.targetId,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})}.bind(null,e.syncEngine),n)]}})})}function Jh(n,r,i){var t=this;void 0===i&&(i={});var o=new Oa;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(n,r,i,o,s){var t=new Ph({next:function(t){r.enqueueAndForget(function(){return Xc(n,a)});var e=t.docs.has(i);!e&&t.fromCache?s.reject(new Fr(Mr.UNAVAILABLE,"Failed to get document because the client is offline.")):e&&t.fromCache&&o&&"server"===o.source?s.reject(new Fr(Mr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(t)},error:function(t){return s.reject(t)}}),a=new $c(So(i.path),t,{includeMetadataChanges:!0,so:!0});return Yc(n,a)},[4,Xh(n)];case 1:return[2,e.apply(void 0,[t.sent(),n.asyncQueue,r,i,o])]}})})}),o.promise}function $h(n,r,i){var t=this;void 0===i&&(i={});var o=new Oa;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(e,n,t,r,i){var o=new Ph({next:function(t){n.enqueueAndForget(function(){return Xc(e,s)}),t.fromCache&&"server"===r.source?i.reject(new Fr(Mr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(t)},error:function(t){return i.reject(t)}}),s=new $c(t,o,{includeMetadataChanges:!0,so:!0});return Yc(e,s)},[4,Xh(n)];case 1:return[2,e.apply(void 0,[t.sent(),n.asyncQueue,r,i,o])]}})})}),o.promise}function Zh(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t}var tl=function(t,e,n,r,i,o,s,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s,this.useFetchStreams=a},el=(Object.defineProperty(pl.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),pl.prototype.isEqual=function(t){return t instanceof pl&&t.projectId===this.projectId&&t.database===this.database},pl),nl=new Map,rl=(fl.prototype.getToken=function(){return Promise.resolve(null)},fl.prototype.invalidateToken=function(){},fl.prototype.setChangeListener=function(t,e){this.changeListener=e,t.enqueueRetryable(function(){return e(Ru.UNAUTHENTICATED)})},fl.prototype.removeChangeListener=function(){this.changeListener=null},fl),il=(ll.prototype.getToken=function(){return Promise.resolve(this.token)},ll.prototype.invalidateToken=function(){},ll.prototype.setChangeListener=function(t,e){var n=this;this.changeListener=e,t.enqueueRetryable(function(){return e(n.token.user)})},ll.prototype.removeChangeListener=function(){this.changeListener=null},ll),ol=(hl.prototype.getToken=function(){var e=this,n=this.cc,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(function(t){return e.cc!==n?(qr("FirebaseCredentialsProvider","getToken aborted due to token change."),e.getToken()):t?(Hr("string"==typeof t.accessToken),new Zh(t.accessToken,e.currentUser)):null}):Promise.resolve(null)},hl.prototype.invalidateToken=function(){this.forceRefresh=!0},hl.prototype.setChangeListener=function(t,e){var n=this;this.asyncQueue=t,this.asyncQueue.enqueueRetryable(function(){return y(n,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return[4,this.oc.promise];case 1:return t.sent(),[4,e(this.currentUser)];case 2:return t.sent(),this.changeListener=e,[2]}})})})},hl.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.uc),this.changeListener=function(){return Promise.resolve()}},hl.prototype.ac=function(){var t=this.auth&&this.auth.getUid();return Hr(null===t||"string"==typeof t),new Ru(t)},hl),sl=(Object.defineProperty(cl.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.lc},e=this.hc.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.fc&&(t["X-Goog-Iam-Authorization-Token"]=this.fc),t},enumerable:!1,configurable:!0}),cl),al=(ul.prototype.getToken=function(){return Promise.resolve(new sl(this.hc,this.lc,this.fc))},ul.prototype.setChangeListener=function(t,e){t.enqueueRetryable(function(){return e(Ru.FIRST_PARTY)})},ul.prototype.removeChangeListener=function(){},ul.prototype.invalidateToken=function(){},ul);function ul(t,e,n){this.hc=t,this.lc=e,this.fc=n}function cl(t,e,n){this.hc=t,this.lc=e,this.fc=n,this.type="FirstParty",this.user=Ru.FIRST_PARTY}function hl(e){var n=this;this.currentUser=Ru.UNAUTHENTICATED,this.oc=new Oa,this.cc=0,this.forceRefresh=!1,this.auth=null,this.asyncQueue=null,this.uc=function(){n.cc++,n.currentUser=n.ac(),n.oc.resolve(),n.changeListener&&n.asyncQueue.enqueueRetryable(function(){return n.changeListener(n.currentUser)})};function r(t){qr("FirebaseCredentialsProvider","Auth detected"),n.auth=t,n.auth.addAuthTokenListener(n.uc)}e.onInit(r),setTimeout(function(){var t;n.auth||((t=e.getImmediate({optional:!0}))?r(t):(qr("FirebaseCredentialsProvider","Auth not yet detected"),n.oc.resolve()))},0)}function ll(t){this.token=t,this.changeListener=null}function fl(){this.changeListener=null}function pl(t,e){this.projectId=t,this.database=e||"(default)"}function dl(t,e,n){if(!n)throw new Fr(Mr.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function yl(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new Fr(Mr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function gl(t,e,n,r){if(!0===e&&!0===r)throw new Fr(Mr.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function vl(t){if(!Ti.isDocumentKey(t))throw new Fr(Mr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function ml(t){if(Ti.isDocumentKey(t))throw new Fr(Mr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function wl(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":Kr();if(e instanceof Array)return"an array";var t=function(){if(e.constructor){var t=/function\s+([^\s(]+)\s*\(/.exec(e.constructor.toString());if(t&&1<t.length)return t[1]}return null}();return t?"a custom "+t+" object":"an object"}function bl(t,e){if((t="_delegate"in t?t._delegate:t)instanceof e)return t;if(e.name===t.constructor.name)throw new Fr(Mr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");t=wl(t);throw new Fr(Mr.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+t)}function _l(t,e){if(e<=0)throw new Fr(Mr.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var El,Tl=(Ol.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams},Ol),Il=(Object.defineProperty(kl.prototype,"app",{get:function(){if(!this._app)throw new Fr(Mr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(kl.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(kl.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),kl.prototype._setSettings=function(t){if(this._settingsFrozen)throw new Fr(Mr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Tl(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new rl;switch(t.type){case"gapi":var e=t.client;return Hr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new al(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new Fr(Mr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},kl.prototype._getSettings=function(){return this._settings},kl.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},kl.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},kl.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},kl.prototype._terminate=function(){return(t=nl.get(this))&&(qr("ComponentProvider","Removing Datastore"),nl.delete(this),t.terminate()),Promise.resolve();var t},kl),Sl=(Object.defineProperty(Rl.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(Rl.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(Rl.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(Rl.prototype,"parent",{get:function(){return new Nl(this.firestore,this.converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),Rl.prototype.withConverter=function(t){return new Rl(this.firestore,t,this._key)},Rl),Al=(Cl.prototype.withConverter=function(t){return new Cl(this.firestore,t,this._query)},Cl),Nl=(n(Dl,El=Al),Object.defineProperty(Dl.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(Dl.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(Dl.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new Sl(this.firestore,null,new Ti(t))},enumerable:!1,configurable:!0}),Dl.prototype.withConverter=function(t){return new Dl(this.firestore,t,this._path)},Dl);function Dl(t,e,n){var r=this;return(r=El.call(this,t,e,So(n))||this)._path=n,r.type="collection",r}function Cl(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}function Rl(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}function kl(t,e){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Tl({}),this._settingsFrozen=!1,t instanceof el?(this._databaseId=t,this._credentials=new rl):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Fr(Mr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new el(t.options.projectId)}(t),this._credentials=new ol(e))}function Ol(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Fr(Mr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Fr(Mr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,gl("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}function Ll(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=m(t),dl("collection","path",e),t instanceof Il)return ml(n=oi.fromString.apply(oi,s([e],r))),new Nl(t,null,n);if(!(t instanceof Sl||t instanceof Nl))throw new Fr(Mr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return ml(n=oi.fromString.apply(oi,s([t.path],r)).child(oi.fromString(e))),new Nl(t.firestore,null,n)}function Pl(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=m(t),dl("doc","path",e=1===arguments.length?Wr.u():e),t instanceof Il)return vl(n=oi.fromString.apply(oi,s([e],r))),new Sl(t,null,new Ti(n));if(!(t instanceof Sl||t instanceof Nl))throw new Fr(Mr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return vl(n=t._path.child(oi.fromString.apply(oi,s([e],r)))),new Sl(t.firestore,t instanceof Nl?t.converter:null,new Ti(n))}function Ml(t,e){return t=m(t),e=m(e),(t instanceof Sl||t instanceof Nl)&&(e instanceof Sl||e instanceof Nl)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function Fl(t,e){return t=m(t),e=m(e),t instanceof Al&&e instanceof Al&&t.firestore===e.firestore&&Po(t._query,e._query)&&t.converter===e.converter}var xl=(Object.defineProperty(Vl.prototype,"isShuttingDown",{get:function(){return this._c},enumerable:!1,configurable:!0}),Vl.prototype.enqueueAndForget=function(t){this.enqueue(t)},Vl.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Ac(),this.Rc(t)},Vl.prototype.enterRestrictedMode=function(t){this._c||(this._c=!0,this.Ec=t||!1,(t=rc())&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Ic))},Vl.prototype.enqueue=function(t){var e=this;if(this.Ac(),this._c)return new Promise(function(){});var n=new Oa;return this.Rc(function(){return e._c&&e.Ec?Promise.resolve():(t().then(n.resolve,n.reject),n.promise)}).then(function(){return n.promise})},Vl.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget(function(){return e.wc.push(t),e.bc()})},Vl.prototype.bc=function(){return y(this,void 0,void 0,function(){var e,n=this;return g(this,function(t){switch(t.label){case 0:if(0===this.wc.length)return[3,5];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.wc[0]()];case 2:return t.sent(),this.wc.shift(),this.Zi.reset(),[3,4];case 3:if(!Fa(e=t.sent()))throw e;return qr("AsyncQueue","Operation failed with retryable error: "+e),[3,4];case 4:0<this.wc.length&&this.Zi.ji(function(){return n.bc()}),t.label=5;case 5:return[2]}})})},Vl.prototype.Rc=function(t){var r=this,e=this.dc.then(function(){return r.gc=!0,t().catch(function(t){throw r.yc=t,r.gc=!1,jr("INTERNAL UNHANDLED ERROR: ",(n=(e=t).message||"",n=e.stack?e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack:n)),t;var e,n}).then(function(t){return r.gc=!1,t})});return this.dc=e},Vl.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.Ac(),-1<this.Tc.indexOf(t)&&(e=0);n=Vc.createAndSchedule(this,t,e,n,function(t){return r.vc(t)});return this.mc.push(n),n},Vl.prototype.Ac=function(){this.yc&&Kr()},Vl.prototype.verifyOperationInProgress=function(){},Vl.prototype.Pc=function(){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return[4,e=this.dc];case 1:t.sent(),t.label=2;case 2:if(e!==this.dc)return[3,0];t.label=3;case 3:return[2]}})})},Vl.prototype.Vc=function(t){for(var e=0,n=this.mc;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},Vl.prototype.Sc=function(r){var i=this;return this.Pc().then(function(){i.mc.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var t=0,e=i.mc;t<e.length;t++){var n=e[t];if(n.skipDelay(),"all"!==r&&n.timerId===r)break}return i.Pc()})},Vl.prototype.Dc=function(t){this.Tc.push(t)},Vl.prototype.vc=function(t){t=this.mc.indexOf(t);this.mc.splice(t,1)},Vl);function Vl(){var e=this;this.dc=Promise.resolve(),this.wc=[],this._c=!1,this.mc=[],this.yc=null,this.gc=!1,this.Ec=!1,this.Tc=[],this.Zi=new cc(this,"async_queue_retry"),this.Ic=function(){var t=rc();t&&qr("AsyncQueue","Visibility state changed to "+t.visibilityState),e.Zi.Gi()};var t=rc();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Ic)}function Ul(i){return function(){if("object"==typeof i&&null!==i)for(var t=i,e=0,n=["next","error","complete"];e<n.length;e++){var r=n[e];if(r in t&&"function"==typeof t[r])return 1}}()}var ql,jl=(Kl.prototype.onProgress=function(t,e,n){this._progressObserver={next:t,error:e,complete:n}},Kl.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},Kl.prototype.then=function(t,e){return this._taskCompletionResolver.promise.then(t,e)},Kl.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},Kl.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},Kl.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)},Kl),Bl=(n(Gl,ql=Il),Gl.prototype._terminate=function(){return this._firestoreClient||Wl(this),this._firestoreClient.terminate()},Gl);function Gl(t,e){var n=this;return(n=ql.call(this,t,e)||this).type="firestore",n._queue=new xl,n._persistenceKey="name"in t?t.name:"[DEFAULT]",n}function Kl(){this._progressObserver={},this._taskCompletionResolver=new Oa,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}function Hl(t){return t._firestoreClient||Wl(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function Wl(t){var e,n,r,i=t._freezeSettings(),i=(e=t._databaseId,n=(null===(r=t._app)||void 0===r?void 0:r.options.appId)||"",r=t._persistenceKey,new tl(e,n,r,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,i.useFetchStreams));t._firestoreClient=new Vh(t._credentials,t._queue,i)}var Ql=(of.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},of),zl=(rf.fromBase64String=function(t){try{return new rf(ci.fromBase64String(t))}catch(t){throw new Fr(Mr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}},rf.fromUint8Array=function(t){return new rf(ci.fromUint8Array(t))},rf.prototype.toBase64=function(){return this._byteString.toBase64()},rf.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},rf.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},rf.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},rf),Yl=function(t){this._methodName=t},Xl=(Object.defineProperty(nf.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(nf.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),nf.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},nf.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},nf.prototype._compareTo=function(t){return zr(this._lat,t._lat)||zr(this._long,t._long)},nf),Jl=/^__.*__$/,$l=(ef.prototype.toMutation=function(t,e){return null!==this.fieldMask?new gs(t,this.data,this.fieldMask,e,this.fieldTransforms):new ys(t,this.data,e,this.fieldTransforms)},ef),Zl=(tf.prototype.toMutation=function(t,e){return new gs(t,this.data,this.fieldMask,e,this.fieldTransforms)},tf);function tf(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}function ef(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}function nf(t,e){if(!isFinite(t)||t<-90||90<t)throw new Fr(Mr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new Fr(Mr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}function rf(t){this._byteString=t}function of(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new Fr(Mr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ai(t)}function sf(t){switch(t){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw Kr()}}var af=(Object.defineProperty(hf.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(hf.prototype,"Nc",{get:function(){return this.settings.Nc},enumerable:!1,configurable:!0}),hf.prototype.xc=function(t){return new hf(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},hf.prototype.Fc=function(t){var e=null===(e=this.path)||void 0===e?void 0:e.child(t),e=this.xc({path:e,kc:!1});return e.$c(t),e},hf.prototype.Oc=function(t){var e,t=null===(e=this.path)||void 0===e?void 0:e.child(t),t=this.xc({path:t,kc:!1});return t.Cc(),t},hf.prototype.Mc=function(t){return this.xc({path:void 0,kc:!0})},hf.prototype.Lc=function(t){return Uf(t,this.settings.methodName,this.settings.Bc||!1,this.path,this.settings.qc)},hf.prototype.contains=function(e){return void 0!==this.fieldMask.find(function(t){return e.isPrefixOf(t)})||void 0!==this.fieldTransforms.find(function(t){return e.isPrefixOf(t.field)})},hf.prototype.Cc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.$c(this.path.get(t))},hf.prototype.$c=function(t){if(0===t.length)throw this.Lc("Document fields must not be empty");if(sf(this.Nc)&&Jl.test(t))throw this.Lc('Document fields cannot begin and end with "__"')},hf),uf=(cf.prototype.Uc=function(t,e,n,r){return void 0===r&&(r=!1),new af({Nc:t,methodName:e,qc:n,path:ai.emptyPath(),kc:!1,Bc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)},cf);function cf(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||ic(t)}function hf(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Cc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}function lf(t){var e=t._freezeSettings(),n=ic(t._databaseId);return new uf(t._databaseId,!!e.ignoreUndefinedProperties,n)}function ff(t,e,n,r,i,o){var s=t.Uc((o=void 0===o?{}:o).merge||o.mergeFields?2:0,e,n,i);Mf("Data must be an object, but it was:",s,r);var a,u,r=Lf(r,s);if(o.merge)a=new ui(s.fieldMask),u=s.fieldTransforms;else if(o.mergeFields){for(var c=[],h=0,l=o.mergeFields;h<l.length;h++){var f=Ff(e,l[h],n);if(!s.contains(f))throw new Fr(Mr.INVALID_ARGUMENT,"Field '"+f+"' is specified in your field mask but missing from your input data.");qf(c,f)||c.push(f)}a=new ui(c),u=s.fieldTransforms.filter(function(t){return a.covers(t.field)})}else a=null,u=s.fieldTransforms;return new $l(new Vi(r),a,u)}var pf,df=(n(yf,pf=Yl),yf.prototype._toFieldTransform=function(t){if(2!==t.Nc)throw 1===t.Nc?t.Lc(this._methodName+"() can only appear at the top level of your update data"):t.Lc(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},yf.prototype.isEqual=function(t){return t instanceof yf},yf);function yf(){return null!==pf&&pf.apply(this,arguments)||this}function gf(t,e,n){return new af({Nc:3,qc:e.settings.qc,methodName:t._methodName,kc:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}var vf,mf,wf,bf,_f=(n(Df,bf=Yl),Df.prototype._toFieldTransform=function(t){return new os(t.path,new Ho)},Df.prototype.isEqual=function(t){return t instanceof Df},Df),Ef=(n(Nf,wf=Yl),Nf.prototype._toFieldTransform=function(t){var e=gf(this,t,!0),n=this.Kc.map(function(t){return Of(t,e)}),n=new Wo(n);return new os(t.path,n)},Nf.prototype.isEqual=function(t){return this===t},Nf),Tf=(n(Af,mf=Yl),Af.prototype._toFieldTransform=function(t){var e=gf(this,t,!0),n=this.Kc.map(function(t){return Of(t,e)}),n=new Jo(n);return new os(t.path,n)},Af.prototype.isEqual=function(t){return this===t},Af),If=(n(Sf,vf=Yl),Sf.prototype._toFieldTransform=function(t){var e=new es(t.R,jo(t.R,this.Qc));return new os(t.path,e)},Sf.prototype.isEqual=function(t){return this===t},Sf);function Sf(t,e){var n=this;return(n=vf.call(this,t)||this).Qc=e,n}function Af(t,e){var n=this;return(n=mf.call(this,t)||this).Kc=e,n}function Nf(t,e){var n=this;return(n=wf.call(this,t)||this).Kc=e,n}function Df(){return null!==bf&&bf.apply(this,arguments)||this}function Cf(t,r,i,e){var o=t.Uc(1,r,i);Mf("Data must be an object, but it was:",o,e);var s=[],a=Vi.empty();ei(e,function(t,e){var n=Vf(r,t,i);e=m(e);t=o.Oc(n);e instanceof df?s.push(n):null!=(t=Of(e,t))&&(s.push(n),a.set(n,t))});e=new ui(s);return new Zl(a,e,o.fieldTransforms)}function Rf(t,e,n,r,i,o){var s=t.Uc(1,e,n),a=[Ff(e,r,n)],u=[i];if(o.length%2!=0)throw new Fr(Mr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)a.push(Ff(e,o[c])),u.push(o[c+1]);for(var h,l,f,p=[],d=Vi.empty(),y=a.length-1;0<=y;--y)qf(p,a[y])||(h=a[y],l=m(l=u[y]),f=s.Oc(h),l instanceof df?p.push(h):null!=(f=Of(l,f))&&(p.push(h),d.set(h,f)));i=new ui(p);return new Zl(d,i,s.fieldTransforms)}function kf(t,e,n,r){return Of(n,t.Uc((r=void 0===r?!1:r)?4:3,e))}function Of(s,t){if(Pf(s=m(s)))return Mf("Unsupported field value:",t,s),Lf(s,t);if(s instanceof Yl)return function(t,e){if(!sf(e.Nc))throw e.Lc(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.Lc(t._methodName+"() is not currently supported inside arrays");t=t._toFieldTransform(e);t&&e.fieldTransforms.push(t)}(s,t),null;if(void 0===s&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),s instanceof Array){if(t.settings.kc&&4!==t.Nc)throw t.Lc("Nested arrays are not supported");return function(t){for(var e=[],n=0,r=0,i=s;r<i.length;r++){var o=Of(i[r],t.Mc(n));null==o&&(o={nullValue:"NULL_VALUE"}),e.push(o),n++}return{arrayValue:{values:e}}}(t)}return function(t,e){if(null===(t=m(s)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return jo(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Xr.fromDate(t);return{timestampValue:la(e.R,n)}}if(t instanceof Xr)return n=new Xr(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:la(e.R,n)};if(t instanceof Xl)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof zl)return{bytesValue:fa(e.R,t._byteString)};if(t instanceof Sl){var n=e.databaseId,r=t.firestore._databaseId;if(!r.isEqual(n))throw e.Lc("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:da(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Lc("Unsupported field value: "+wl(t))}(0,t)}function Lf(t,n){var r={};return ni(t)?n.path&&0<n.path.length&&n.fieldMask.push(n.path):ei(t,function(t,e){e=Of(e,n.Fc(t));null!=e&&(r[t]=e)}),{mapValue:{fields:r}}}function Pf(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Xr||t instanceof Xl||t instanceof zl||t instanceof Sl||t instanceof Yl)}function Mf(t,e,n){if(!Pf(n)||("object"!=typeof(r=n)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r))){n=wl(n);throw"an object"===n?e.Lc(t+" a custom object"):e.Lc(t+" "+n)}var r}function Ff(t,e,n){if((e=m(e))instanceof Ql)return e._internalPath;if("string"==typeof e)return Vf(t,e);throw Uf("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var xf=new RegExp("[~\\*/\\[\\]]");function Vf(e,n,r){if(0<=n.search(xf))throw Uf("Invalid field path ("+n+"). Paths must not contain '~', '*', '/', '[', or ']'",e,!1,void 0,r);try{return(new(Ql.bind.apply(Ql,s([void 0],n.split(".")))))._internalPath}catch(t){throw Uf("Invalid field path ("+n+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",e,!1,void 0,r)}}function Uf(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,e="Function "+e+"() called with invalid data";n&&(e+=" (via `toFirestore()`)");n="";return(o||s)&&(n+=" (found",o&&(n+=" in field "+r),s&&(n+=" in document "+i),n+=")"),new Fr(Mr.INVALID_ARGUMENT,(e+=". ")+t+n)}function qf(t,e){return t.some(function(t){return t.isEqual(e)})}var jf,Bf=(Object.defineProperty(Hf.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(Hf.prototype,"ref",{get:function(){return new Sl(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),Hf.prototype.exists=function(){return null!==this._document},Hf.prototype.data=function(){if(this._document){if(this._converter){var t=new Gf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}},Hf.prototype.get=function(t){if(this._document){t=this._document.data.field(Wf("DocumentSnapshot.get",t));if(null!==t)return this._userDataWriter.convertValue(t)}},Hf),Gf=(n(Kf,jf=Bf),Kf.prototype.data=function(){return jf.prototype.data.call(this)},Kf);function Kf(){return null!==jf&&jf.apply(this,arguments)||this}function Hf(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}function Wf(t,e){return"string"==typeof e?Vf(t,e):(e instanceof Ql?e:e._delegate)._internalPath}var Qf,zf,Yf=(np.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},np),Xf=(n(ep,zf=Bf),ep.prototype.exists=function(){return zf.prototype.exists.call(this)},ep.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new Jf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}},ep.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){t=this._document.data.field(Wf("DocumentSnapshot.get",t));if(null!==t)return this._userDataWriter.convertValue(t,e.serverTimestamps)}},ep),Jf=(n(tp,Qf=Xf),tp.prototype.data=function(t){return Qf.prototype.data.call(this,t=void 0===t?{}:t)},tp),$f=(Object.defineProperty(Zf.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!1,configurable:!0}),Object.defineProperty(Zf.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(Zf.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),Zf.prototype.forEach=function(e,n){var r=this;this._snapshot.docs.forEach(function(t){e.call(n,new Jf(r._firestore,r._userDataWriter,t.key,t,new Yf(r._snapshot.mutatedKeys.has(t.key),r._snapshot.fromCache),r.query.converter))})},Zf.prototype.docChanges=function(t){t=!!(t=void 0===t?{}:t).includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Fr(Mr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,e){if(i._snapshot.oldDocs.isEmpty()){var n=0;return i._snapshot.docChanges.map(function(t){return{type:"added",doc:new Jf(i._firestore,i._userDataWriter,t.doc.key,t.doc,new Yf(i._snapshot.mutatedKeys.has(t.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:n++}})}var o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(function(t){return e||3!==t.type}).map(function(t){var e=new Jf(i._firestore,i._userDataWriter,t.doc.key,t.doc,new Yf(i._snapshot.mutatedKeys.has(t.doc.key),i._snapshot.fromCache),i.query.converter),n=-1,r=-1;return 0!==t.type&&(n=o.indexOf(t.doc.key),o=o.delete(t.doc.key)),1!==t.type&&(r=(o=o.add(t.doc)).indexOf(t.doc.key)),{type:function(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Kr()}}(t.type),doc:e,oldIndex:n,newIndex:r}})}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges},Zf);function Zf(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new Yf(r.hasPendingWrites,r.fromCache),this.query=n}function tp(){return null!==Qf&&Qf.apply(this,arguments)||this}function ep(t,e,n,r,i,o){var s=this;return(s=zf.call(this,t,e,n,r,o)||this)._firestore=t,s._firestoreImpl=t,s.metadata=i,s}function np(t,e){this.hasPendingWrites=t,this.fromCache=e}function rp(t,e){return t instanceof Xf&&e instanceof Xf?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof $f&&e instanceof $f&&t._firestore===e._firestore&&Fl(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function ip(t){if(No(t)&&0===t.explicitOrderBy.length)throw new Fr(Mr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}D=function(){};function op(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++)t=i[r]._apply(t);return t}var sp,ap,up,cp,hp,lp=(n(bp,hp=D),bp.prototype._apply=function(t){var e=lf(t.firestore),e=function(t,e,n,r,i,o){if(r.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new Fr(Mr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+i+"' queries on FieldPath.documentId().");if("in"===i||"not-in"===i){Tp(o,i);for(var s=[],a=0,u=o;a<u.length;a++){var c=u[a];s.push(Ep(n,t,c))}h={arrayValue:{values:s}}}else h=Ep(n,t,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||Tp(o,i),h=kf(e,"where",o,"in"===i||"not-in"===i);var h=zi.create(r,i,h);return function(t,e){if(e.g()){var n=Co(t);if(null!==n&&!n.isEqual(e.field))throw new Fr(Mr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");n=Do(t);null!==n&&Ip(0,e.field,n)}t=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(0<=e.indexOf(i.op))return i.op}return null}(t,function(){switch(e.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==t)throw t===e.op?new Fr(Mr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new Fr(Mr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+t.toString()+"' filters.")}(t,h),h}(t._query,e,t.firestore._databaseId,this.jc,this.Wc,this.Gc);return new Al(t.firestore,t.converter,(t=t._query,e=t.filters.concat([e]),new Io(t.path,t.collectionGroup,t.explicitOrderBy.slice(),e,t.limit,t.limitType,t.startAt,t.endAt)))},bp),fp=(n(wp,cp=D),wp.prototype._apply=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new Fr(Mr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Fr(Mr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new _o(e,n);return e=r,null!==Do(n=t)||null!==(t=Co(n))&&Ip(0,t,e.field),r}(t._query,this.jc,this.zc);return new Al(t.firestore,t.converter,(t=t._query,e=t.explicitOrderBy.concat([e]),new Io(t.path,t.collectionGroup,e,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)))},wp),pp=(n(mp,up=D),mp.prototype._apply=function(t){return new Al(t.firestore,t.converter,Lo(t._query,this.Hc,this.Jc))},mp),dp=(n(vp,ap=D),vp.prototype._apply=function(t){var e=_p(t,this.type,this.Yc,this.Xc);return new Al(t.firestore,t.converter,(t=t._query,e=e,new Io(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)))},vp),yp=(n(gp,sp=D),gp.prototype._apply=function(t){var e=_p(t,this.type,this.Yc,this.Xc);return new Al(t.firestore,t.converter,(t=t._query,e=e,new Io(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)))},gp);function gp(t,e,n){var r=this;return(r=sp.call(this)||this).type=t,r.Yc=e,r.Xc=n,r}function vp(t,e,n){var r=this;return(r=ap.call(this)||this).type=t,r.Yc=e,r.Xc=n,r}function mp(t,e,n){var r=this;return(r=up.call(this)||this).type=t,r.Hc=e,r.Jc=n,r}function wp(t,e){var n=this;return(n=cp.call(this)||this).jc=t,n.zc=e,n.type="orderBy",n}function bp(t,e,n){var r=this;return(r=hp.call(this)||this).jc=t,r.Wc=e,r.Gc=n,r.type="where",r}function _p(t,c,e,n){if(e[0]=m(e[0]),e[0]instanceof Bf)return function(t,e,n,r){if(!n)throw new Fr(Mr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+c+"().");for(var i=[],o=0,s=ko(t);o<s.length;o++){var a=s[o];if(a.field.isKeyField())i.push(ki(e,n.key));else{var u=n.data.field(a.field);if(wi(u))throw new Fr(Mr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===u){a=a.field.canonicalString();throw new Fr(Mr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+a+"' (used as the orderBy) does not exist.")}i.push(u)}}return new yo(i,r)}(t._query,t.firestore._databaseId,e[0]._document,n);var r=lf(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new Fr(Mr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],u=0;u<i.length;u++){var c=i[u];if(s[u].field.isKeyField()){if("string"!=typeof c)throw new Fr(Mr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!Ro(t)&&-1!==c.indexOf("/"))throw new Fr(Mr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(oi.fromString(c));if(!Ti.isDocumentKey(h))throw new Fr(Mr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");h=new Ti(h);a.push(ki(e,h))}else{c=kf(n,r,c);a.push(c)}}return new yo(a,o)}(t._query,t.firestore._databaseId,r,c,e,n)}function Ep(t,e,n){if("string"==typeof(n=m(n))){if(""===n)throw new Fr(Mr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ro(e)&&-1!==n.indexOf("/"))throw new Fr(Mr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");e=e.path.child(oi.fromString(n));if(!Ti.isDocumentKey(e))throw new Fr(Mr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return ki(t,new Ti(e))}if(n instanceof Sl)return ki(t,n._key);throw new Fr(Mr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+wl(n)+".")}function Tp(t,e){if(!Array.isArray(t)||0===t.length)throw new Fr(Mr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new Fr(Mr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function Ip(t,e,n){if(!n.isEqual(e))throw new Fr(Mr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}Sp.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),Si(t)){case 0:return null;case 1:return t.booleanValue;case 2:return vi(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(mi(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Kr()}},Sp.prototype.convertObject=function(t,n){var r=this,i={};return ei(t.fields,function(t,e){i[t]=r.convertValue(e,n)}),i},Sp.prototype.convertGeoPoint=function(t){return new Xl(vi(t.latitude),vi(t.longitude))},Sp.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map(function(t){return n.convertValue(t,e)})},Sp.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=function t(e){e=e.mapValue.fields.__previous_value__;return wi(e)?t(e):e}(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(bi(t));default:return null}},Sp.prototype.convertTimestamp=function(t){t=gi(t);return new Xr(t.seconds,t.nanos)},Sp.prototype.convertDocumentKey=function(t,e){var n=oi.fromString(t);Hr(ka(n));t=new el(n.get(1),n.get(3)),n=new Ti(n.popFirst(5));return t.isEqual(e)||jr("Document "+n+" contains a document reference within a different database ("+t.projectId+"/"+t.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),n},T=Sp;function Sp(){}function Ap(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var Np,Dp=(n(kp,Np=T),kp.prototype.convertBytes=function(t){return new zl(t)},kp.prototype.convertReference=function(t){t=this.convertDocumentKey(t,this.firestore._databaseId);return new Sl(this.firestore,null,t)},kp),Cp=(Rp.prototype.set=function(t,e,n){this._verifyNotCommitted();t=Op(t,this._firestore),e=Ap(t.converter,e,n),n=ff(this._dataReader,"WriteBatch.set",t._key,e,null!==t.converter,n);return this._mutations.push(n.toMutation(t._key,as.none())),this},Rp.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this._verifyNotCommitted();t=Op(t,this._firestore),e="string"==typeof(e=m(e))||e instanceof Ql?Rf(this._dataReader,"WriteBatch.update",t._key,e,n,r):Cf(this._dataReader,"WriteBatch.update",t._key,e);return this._mutations.push(e.toMutation(t._key,as.exists(!0))),this},Rp.prototype.delete=function(t){this._verifyNotCommitted();t=Op(t,this._firestore);return this._mutations=this._mutations.concat(new As(t._key,as.none())),this},Rp.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,0<this._mutations.length?this._commitHandler(this._mutations):Promise.resolve()},Rp.prototype._verifyNotCommitted=function(){if(this._committed)throw new Fr(Mr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},Rp);function Rp(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=lf(t)}function kp(t){var e=this;return(e=Np.call(this)||this).firestore=t,e}function Op(t,e){if((t=m(t)).firestore!==e)throw new Fr(Mr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var Lp,Pp=(n(Mp,Lp=T),Mp.prototype.convertBytes=function(t){return new zl(t)},Mp.prototype.convertReference=function(t){t=this.convertDocumentKey(t,this.firestore._databaseId);return new Sl(this.firestore,null,t)},Mp);function Mp(t){var e=this;return(e=Lp.call(this)||this).firestore=t,e}function Fp(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=bl(t,Sl);var o=bl(t.firestore,Bl),s=lf(o);return Vp(o,[("string"==typeof(e=m(e))||e instanceof Ql?Rf(s,"updateDoc",t._key,e,n,r):Cf(s,"updateDoc",t._key,e)).toMutation(t._key,as.exists(!0))])}function xp(e){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];e=m(e);var r={includeMetadataChanges:!1},i=0;"object"!=typeof n[i]||Ul(n[i])||(r=n[i],i++);var o,s,a,u,c,h,l={includeMetadataChanges:r.includeMetadataChanges};return Ul(n[i])&&(o=n[i],n[i]=null===(r=o.next)||void 0===r?void 0:r.bind(o),n[i+1]=null===(r=o.error)||void 0===r?void 0:r.bind(o),n[i+2]=null===(r=o.complete)||void 0===r?void 0:r.bind(o)),e instanceof Sl?(a=bl(e.firestore,Bl),u=So(e._key.path),h={next:function(t){n[i]&&n[i](Up(a,e,t))},error:n[i+1],complete:n[i+2]}):(s=bl(e,Al),a=bl(s.firestore,Bl),u=s._query,c=new Pp(a),h={next:function(t){n[i]&&n[i](new $f(a,c,s,t))},error:n[i+1],complete:n[i+2]},ip(e._query)),function(n,t,e){var r=this,i=new Ph(h),o=new $c(t,i,e);return n.asyncQueue.enqueueAndForget(function(){return y(r,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=Yc,[4,Xh(n)];case 1:return[2,e.apply(void 0,[t.sent(),o])]}})})}),function(){i.Wo(),n.asyncQueue.enqueueAndForget(function(){return y(r,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=Xc,[4,Xh(n)];case 1:return[2,e.apply(void 0,[t.sent(),o])]}})})})}}(Hl(a),u,l)}function Vp(t,e){return function(n,r){var t=this,i=new Oa;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=gh,[4,Yh(n)];case 1:return[2,e.apply(void 0,[t.sent(),r,i])]}})})}),i.promise}(Hl(t),e)}function Up(t,e,n){var r=n.docs.get(e._key),i=new Pp(t);return new Xf(t,i,e._key,r,new Yf(n.hasPendingWrites,n.fromCache),e.converter)}var qp,jp=(Gp.prototype.get=function(t){var e=this,n=Op(t,this._firestore),r=new Dp(this._firestore);return this._transaction.lookup([n._key]).then(function(t){if(!t||1!==t.length)return Kr();t=t[0];if(t.isFoundDocument())return new Bf(e._firestore,r,t.key,t,n.converter);if(t.isNoDocument())return new Bf(e._firestore,r,n._key,null,n.converter);throw Kr()})},Gp.prototype.set=function(t,e,n){t=Op(t,this._firestore),e=Ap(t.converter,e,n),n=ff(this._dataReader,"Transaction.set",t._key,e,null!==t.converter,n);return this._transaction.set(t._key,n),this},Gp.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=Op(t,this._firestore),e="string"==typeof(e=m(e))||e instanceof Ql?Rf(this._dataReader,"Transaction.update",t._key,e,n,r):Cf(this._dataReader,"Transaction.update",t._key,e);return this._transaction.update(t._key,e),this},Gp.prototype.delete=function(t){t=Op(t,this._firestore);return this._transaction.delete(t._key),this},n(Bp,qp=Gp),Bp.prototype.get=function(t){var e=this,n=Op(t,this._firestore),r=new Pp(this._firestore);return qp.prototype.get.call(this,t).then(function(t){return new Xf(e._firestore,r,n._key,t._document,new Yf(!1,!1),n.converter)})},Bp);function Bp(t,e){var n=this;return(n=qp.call(this,t,e)||this)._firestore=t,n}function Gp(t,e){this._firestore=t,this._transaction=e,this._dataReader=lf(t)}function Kp(){if("undefined"==typeof Uint8Array)throw new Fr(Mr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Hp(){if("undefined"==typeof atob)throw new Fr(Mr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Wp,Qp=(ed.fromBase64String=function(t){return Hp(),new ed(zl.fromBase64String(t))},ed.fromUint8Array=function(t){return Kp(),new ed(zl.fromUint8Array(t))},ed.prototype.toBase64=function(){return Hp(),this._delegate.toBase64()},ed.prototype.toUint8Array=function(){return Kp(),this._delegate.toUint8Array()},ed.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},ed.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},ed),zp="You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.",Yp=(td.prototype.enableIndexedDbPersistence=function(t,e){throw new Fr(Mr.FAILED_PRECONDITION,zp)},td.prototype.enableMultiTabIndexedDbPersistence=function(t){throw new Fr(Mr.FAILED_PRECONDITION,zp)},td.prototype.clearIndexedDbPersistence=function(t){throw new Fr(Mr.FAILED_PRECONDITION,zp)},td),Xp=(Object.defineProperty(Zp.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),Zp.prototype.settings=function(t){var e=this._delegate._getSettings();t.merge||e.host===t.host||Br("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},e),t)).merge,this._delegate._setSettings(t)},Zp.prototype.useEmulator=function(t,e,n){(function(t,e,n,r){void 0===r&&(r={});var i=(t=bl(t,Il))._getSettings();if("firestore.googleapis.com"!==i.host&&i.host!==e&&Br("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},i),{host:e+":"+n,ssl:!1})),r.mockUserToken){n=function(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n=e||"demo-project",r=t.iat||0;if(!(e=t.sub||t.user_id))throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");return t=o({iss:"https://securetoken.google.com/"+n,aud:n,iat:r,exp:r+3600,auth_time:r,sub:e,user_id:e,firebase:{sign_in_provider:"custom",identities:{}}},t),[a.encodeString(JSON.stringify({alg:"none",type:"JWT"}),!1),a.encodeString(JSON.stringify(t),!1),""].join(".")}(r.mockUserToken),r=r.mockUserToken.sub||r.mockUserToken.user_id;if(!r)throw new Fr(Mr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");t._credentials=new il(new Zh(n,new Ru(r)))}})(this._delegate,t,e,n=void 0===n?{}:n)},Zp.prototype.enableNetwork=function(){return function(i){var t=this;return i.asyncQueue.enqueue(function(){return y(t,void 0,void 0,function(){var n,r;return g(this,function(t){switch(t.label){case 0:return[4,Wh(i)];case 1:return n=t.sent(),[4,zh(i)];case 2:return r=t.sent(),[2,(n.setNetworkEnabled(!0),(e=r).Or.delete(0),bc(e))]}var e})})})}(Hl(bl(this._delegate,Bl)))},Zp.prototype.disableNetwork=function(){return function(r){var t=this;return r.asyncQueue.enqueue(function(){return y(t,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return[4,Wh(r)];case 1:return e=t.sent(),[4,zh(r)];case 2:return n=t.sent(),[2,(e.setNetworkEnabled(!1),function(n){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return(e=n).Or.add(0),[4,_c(e)];case 1:return t.sent(),e.Br.set("Offline"),[2]}})})}(n))]}})})})}(Hl(bl(this._delegate,Bl)))},Zp.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&gl("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Zc.enableMultiTabIndexedDbPersistence(this):this.Zc.enableIndexedDbPersistence(this,n)},Zp.prototype.clearPersistence=function(){return this.Zc.clearIndexedDbPersistence(this)},Zp.prototype.terminate=function(){return this.tu&&(this.tu._removeServiceInstance("firestore"),this.tu._removeServiceInstance("firestore-exp")),this._delegate._delete()},Zp.prototype.waitForPendingWrites=function(){return function(n){var t=this,r=new Oa;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=wh,[4,Yh(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})}),r.promise}(Hl(bl(this._delegate,Bl)))},Zp.prototype.onSnapshotsInSync=function(t){return e=this._delegate,t=t,function(n,t){var e=this,r=new Ph(t);return n.asyncQueue.enqueueAndForget(function(){return y(e,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(t,e){t.Gr.add(e),e.next()},[4,Xh(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})}),function(){r.Wo(),n.asyncQueue.enqueueAndForget(function(){return y(e,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(t,e){t.Gr.delete(e)},[4,Xh(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})})}}(Hl(bl(e,Bl)),Ul(t)?t:{next:t});var e},Object.defineProperty(Zp.prototype,"app",{get:function(){if(!this.tu)throw new Fr(Mr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.tu},enumerable:!1,configurable:!0}),Zp.prototype.collection=function(t){try{return new bd(this,Ll(this._delegate,t))}catch(t){throw hd(t,"collection()","Firestore.collection()")}},Zp.prototype.doc=function(t){try{return new ud(this,Pl(this._delegate,t))}catch(t){throw hd(t,"doc()","Firestore.doc()")}},Zp.prototype.collectionGroup=function(t){try{return new vd(this,function(t,e){if(t=bl(t,Il),dl("collectionGroup","collection id",e),0<=e.indexOf("/"))throw new Fr(Mr.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new Al(t,null,(e=e,new Io(oi.emptyPath(),e)))}(this._delegate,t))}catch(t){throw hd(t,"collectionGroup()","Firestore.collectionGroup()")}},Zp.prototype.runTransaction=function(e){var n,r=this;return function(n,r){var t=this,i=new Oa;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return[4,Hh(n).then(function(t){return t.datastore})];case 1:return e=t.sent(),new xh(n.asyncQueue,e,r,i).run(),[2]}})})}),i.promise}(Hl(n=this._delegate),function(t){return t=new jp(n,t),e(new nd(r,t))})},Zp.prototype.batch=function(){var e=this;return Hl(this._delegate),new rd(new Cp(this._delegate,function(t){return Vp(e._delegate,t)}))},Zp.prototype.loadBundle=function(t){throw new Fr(Mr.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},Zp.prototype.namedQuery=function(t){throw new Fr(Mr.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},Zp),Jp=(n($p,Wp=T),$p.prototype.convertBytes=function(t){return new Qp(new zl(t))},$p.prototype.convertReference=function(t){t=this.convertDocumentKey(t,this.firestore._databaseId);return ud.eu(t,this.firestore,null)},$p);function $p(t){var e=this;return(e=Wp.call(this)||this).firestore=t,e}function Zp(t,e,n){var r=this;this._delegate=e,this.Zc=n,this.INTERNAL={delete:function(){return r.terminate()}},t instanceof el||(this.tu=t)}function td(){}function ed(t){this._delegate=t}var nd=(ad.prototype.get=function(t){var e=this,n=Nd(t);return this._delegate.get(n).then(function(t){return new yd(e._firestore,new Xf(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n.converter))})},ad.prototype.set=function(t,e,n){t=Nd(t);return n?(yl("Transaction.set",n),this._delegate.set(t,e,n)):this._delegate.set(t,e),this},ad.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o=Nd(t);return 2===arguments.length?this._delegate.update(o,e):(t=this._delegate).update.apply(t,s([o,e,n],r)),this},ad.prototype.delete=function(t){t=Nd(t);return this._delegate.delete(t),this},ad),rd=(sd.prototype.set=function(t,e,n){t=Nd(t);return n?(yl("WriteBatch.set",n),this._delegate.set(t,e,n)):this._delegate.set(t,e),this},sd.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o=Nd(t);return 2===arguments.length?this._delegate.update(o,e):(t=this._delegate).update.apply(t,s([o,e,n],r)),this},sd.prototype.delete=function(t){t=Nd(t);return this._delegate.delete(t),this},sd.prototype.commit=function(){return this._delegate.commit()},sd),id=(od.prototype.fromFirestore=function(t,e){t=new Jf(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new gd(this._firestore,t),null!=e?e:{})},od.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},od.nu=function(t,e){var n=od.su,r=n.get(t);r||(r=new WeakMap,n.set(t,r));n=r.get(e);return n||(n=new od(t,new Jp(t),e),r.set(e,n)),n},od);function od(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}function sd(t){this._delegate=t}function ad(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new Jp(t)}id.su=new WeakMap;var ud=(cd.iu=function(t,e,n){if(t.length%2!=0)throw new Fr(Mr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.canonicalString()+" has "+t.length);return new cd(e,new Sl(e._delegate,n,new Ti(t)))},cd.eu=function(t,e,n){return new cd(e,new Sl(e._delegate,n,t))},Object.defineProperty(cd.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(cd.prototype,"parent",{get:function(){return new bd(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(cd.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),cd.prototype.collection=function(t){try{return new bd(this.firestore,Ll(this._delegate,t))}catch(t){throw hd(t,"collection()","DocumentReference.collection()")}},cd.prototype.isEqual=function(t){return(t=m(t))instanceof Sl&&Ml(this._delegate,t)},cd.prototype.set=function(t,e){e=yl("DocumentReference.set",e);try{return function(t,e,n){t=bl(t,Sl);var r=bl(t.firestore,Bl),e=Ap(t.converter,e,n);return Vp(r,[ff(lf(r),"setDoc",t._key,e,null!==t.converter,n).toMutation(t._key,as.none())])}(this._delegate,t,e)}catch(t){throw hd(t,"setDoc()","DocumentReference.set()")}},cd.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?Fp(this._delegate,t):Fp.apply(void 0,s([this._delegate,t,e],n))}catch(t){throw hd(t,"updateDoc()","DocumentReference.update()")}},cd.prototype.delete=function(){return Vp(bl((t=this._delegate).firestore,Bl),[new As(t._key,as.none())]);var t},cd.prototype.onSnapshot=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=ld(t),i=fd(t,function(t){return new yd(e.firestore,new Xf(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate.converter))});return xp(this._delegate,r,i)},cd.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(e){e=bl(e,Sl);var n=bl(e.firestore,Bl),t=Hl(n),r=new Pp(n);return function(n,r){var t=this,i=new Oa;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(o,s,a){return y(this,void 0,void 0,function(){var r,i;return g(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,(e=s,(n=o).persistence.runTransaction("read document","readonly",function(t){return n.Mn.mn(t,e)}))];case 1:return(i=t.sent()).isFoundDocument()?a.resolve(i):i.isNoDocument()?a.resolve(null):a.reject(new Fr(Mr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=t.sent(),i=qc(r,"Failed to get document '"+s+" from cache"),a.reject(i),[3,3];case 3:return[2]}var e,n})})},[4,Qh(n)];case 1:return[2,e.apply(void 0,[t.sent(),r,i])]}})})}),i.promise}(t,e._key).then(function(t){return new Xf(n,r,e._key,t,new Yf(null!==t&&t.hasLocalMutations,!0),e.converter)})}:"server"===(null==t?void 0:t.source)?function(e){e=bl(e,Sl);var n=bl(e.firestore,Bl);return Jh(Hl(n),e._key,{source:"server"}).then(function(t){return Up(n,e,t)})}:function(e){e=bl(e,Sl);var n=bl(e.firestore,Bl);return Jh(Hl(n),e._key).then(function(t){return Up(n,e,t)})})(this._delegate).then(function(t){return new yd(e.firestore,new Xf(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate.converter))})},cd.prototype.withConverter=function(t){return new cd(this.firestore,t?this._delegate.withConverter(id.nu(this.firestore,t)):this._delegate.withConverter(null))},cd);function cd(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Jp(t)}function hd(t,e,n){return t.message=t.message.replace(e,n),t}function ld(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!Ul(r))return r}return{}}function fd(t,e){var n;return{next:function(t){n.next&&n.next(e(t))},error:null===(t=(n=Ul(t[0])?t[0]:Ul(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===t?void 0:t.bind(n),complete:null===(t=n.complete)||void 0===t?void 0:t.bind(n)}}var pd,dd,yd=(Object.defineProperty(Ad.prototype,"ref",{get:function(){return new ud(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(Ad.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(Ad.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(Ad.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),Ad.prototype.data=function(t){return this._delegate.data(t)},Ad.prototype.get=function(t,e){return this._delegate.get(t,e)},Ad.prototype.isEqual=function(t){return rp(this._delegate,t._delegate)},Ad),gd=(n(Sd,dd=yd),Sd.prototype.data=function(t){return this._delegate.data(t)},Sd),vd=(Id.prototype.where=function(t,e,n){try{return new Id(this.firestore,op(this._delegate,(r=n,i=e,o=Wf("where",t),new lp(o,i,r))))}catch(t){throw hd(t,/(orderBy|where)\(\)/,"Query.$1()")}var r,i,o},Id.prototype.orderBy=function(t,e){try{return new Id(this.firestore,op(this._delegate,(n=void 0===e?"asc":e,r=Wf("orderBy",t),new fp(r,n))))}catch(t){throw hd(t,/(orderBy|where)\(\)/,"Query.$1()")}var n,r},Id.prototype.limit=function(t){try{return new Id(this.firestore,op(this._delegate,(_l("limit",e=t),new pp("limit",e,"F"))))}catch(t){throw hd(t,"limit()","Query.limit()")}var e},Id.prototype.limitToLast=function(t){try{return new Id(this.firestore,op(this._delegate,(_l("limitToLast",e=t),new pp("limitToLast",e,"L"))))}catch(t){throw hd(t,"limitToLast()","Query.limitToLast()")}var e},Id.prototype.startAt=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new Id(this.firestore,op(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new dp("startAt",t,!0)}.apply(void 0,t)))}catch(t){throw hd(t,"startAt()","Query.startAt()")}},Id.prototype.startAfter=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new Id(this.firestore,op(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new dp("startAfter",t,!1)}.apply(void 0,t)))}catch(t){throw hd(t,"startAfter()","Query.startAfter()")}},Id.prototype.endBefore=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new Id(this.firestore,op(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new yp("endBefore",t,!0)}.apply(void 0,t)))}catch(t){throw hd(t,"endBefore()","Query.endBefore()")}},Id.prototype.endAt=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new Id(this.firestore,op(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new yp("endAt",t,!1)}.apply(void 0,t)))}catch(t){throw hd(t,"endAt()","Query.endAt()")}},Id.prototype.isEqual=function(t){return Fl(this._delegate,t._delegate)},Id.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(e){e=bl(e,Al);var n=bl(e.firestore,Bl),t=Hl(n),r=new Pp(n);return function(n,r){var t=this,i=new Oa;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(i,o,s){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,vu(i,o,!0)];case 1:return r=t.sent(),e=new ch(o,r.Bn),n=e._o(r.documents),n=e.applyChanges(n,!1),s.resolve(n.snapshot),[3,3];case 2:return n=t.sent(),r=qc(n,"Failed to execute query '"+o+" against cache"),s.reject(r),[3,3];case 3:return[2]}})})},[4,Qh(n)];case 1:return[2,e.apply(void 0,[t.sent(),r,i])]}})})}),i.promise}(t,e._query).then(function(t){return new $f(n,r,e,t)})}:"server"===(null==t?void 0:t.source)?function(e){e=bl(e,Al);var n=bl(e.firestore,Bl),t=Hl(n),r=new Pp(n);return $h(t,e._query,{source:"server"}).then(function(t){return new $f(n,r,e,t)})}:function(e){e=bl(e,Al);var n=bl(e.firestore,Bl),t=Hl(n),r=new Pp(n);return ip(e._query),$h(t,e._query).then(function(t){return new $f(n,r,e,t)})})(this._delegate).then(function(t){return new wd(e.firestore,new $f(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))})},Id.prototype.onSnapshot=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=ld(t),i=fd(t,function(t){return new wd(e.firestore,new $f(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))});return xp(this._delegate,r,i)},Id.prototype.withConverter=function(t){return new Id(this.firestore,t?this._delegate.withConverter(id.nu(this.firestore,t)):this._delegate.withConverter(null))},Id),md=(Object.defineProperty(Td.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(Td.prototype,"doc",{get:function(){return new gd(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(Td.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(Td.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),Td),wd=(Object.defineProperty(Ed.prototype,"query",{get:function(){return new vd(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(Ed.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(Ed.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(Ed.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(Ed.prototype,"docs",{get:function(){var e=this;return this._delegate.docs.map(function(t){return new gd(e._firestore,t)})},enumerable:!1,configurable:!0}),Ed.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map(function(t){return new md(e._firestore,t)})},Ed.prototype.forEach=function(e,n){var r=this;this._delegate.forEach(function(t){e.call(n,new gd(r._firestore,t))})},Ed.prototype.isEqual=function(t){return rp(this._delegate,t._delegate)},Ed),bd=(n(_d,pd=vd),Object.defineProperty(_d.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(_d.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(_d.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new ud(this.firestore,t):null},enumerable:!1,configurable:!0}),_d.prototype.doc=function(t){try{return new ud(this.firestore,void 0===t?Pl(this._delegate):Pl(this._delegate,t))}catch(t){throw hd(t,"doc()","CollectionReference.doc()")}},_d.prototype.add=function(t){var e,n,r,i=this;return e=this._delegate,n=t,t=bl(e.firestore,Bl),r=Pl(e),n=Ap(e.converter,n),Vp(t,[ff(lf(e.firestore),"addDoc",r._key,n,null!==e.converter,{}).toMutation(r._key,as.exists(!1))]).then(function(){return r}).then(function(t){return new ud(i.firestore,t)})},_d.prototype.isEqual=function(t){return Ml(this._delegate,t._delegate)},_d.prototype.withConverter=function(t){return new _d(this.firestore,t?this._delegate.withConverter(id.nu(this.firestore,t)):this._delegate.withConverter(null))},_d);function _d(t,e){var n=this;return(n=pd.call(this,t,e)||this).firestore=t,n._delegate=e,n}function Ed(t,e){this._firestore=t,this._delegate=e}function Td(t,e){this._firestore=t,this._delegate=e}function Id(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Jp(t)}function Sd(){return null!==dd&&dd.apply(this,arguments)||this}function Ad(t,e){this._firestore=t,this._delegate=e}function Nd(t){return bl(t,Sl)}Cd.documentId=function(){return new Cd(ai.keyField().canonicalString())},Cd.prototype.isEqual=function(t){return(t=m(t))instanceof Ql&&this._delegate._internalPath.isEqual(t._internalPath)},D=Cd,Dd.serverTimestamp=function(){var t=new _f("serverTimestamp");return t._methodName="FieldValue.serverTimestamp",new Dd(t)},Dd.delete=function(){var t=new df("deleteField");return t._methodName="FieldValue.delete",new Dd(t)},Dd.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Ef("arrayUnion",t)}.apply(void 0,t);return n._methodName="FieldValue.arrayUnion",new Dd(n)},Dd.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Tf("arrayRemove",t)}.apply(void 0,t);return n._methodName="FieldValue.arrayRemove",new Dd(n)},Dd.increment=function(t){t=new If("increment",t);return t._methodName="FieldValue.increment",new Dd(t)},Dd.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},T=Dd;function Dd(t){this._delegate=t}function Cd(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._delegate=new(Ql.bind.apply(Ql,s([void 0],t)))}function Rd(t){return e=this._delegate,s=t,n=Hl(e=bl(e,Bl)),t=new jl,function(n,t,r){var e,i=this,o=(e=s,t=ic(t),e=function(t){if(t instanceof Uint8Array)return Lh(t,void 0);if(t instanceof ArrayBuffer)return Lh(new Uint8Array(t),void 0);if(t instanceof ReadableStream)return t.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof e?(new TextEncoder).encode(e):e),new Mh(e,t));n.asyncQueue.enqueueAndForget(function(){return y(i,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=Dh,[4,Yh(n)];case 1:return e.apply(void 0,[t.sent(),o,r]),[2]}})})})}(n,e._databaseId,t),t;var e,s,n}function kd(t){var e=this,n=this._delegate,t=t;return function(n,r){var t=this;return n.asyncQueue.enqueue(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(t,e){var n=t;return n.persistence.runTransaction("Get named query","readonly",function(t){return n.Ke.getNamedQuery(t,e)})},[4,Qh(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})})}(Hl(n=bl(n,Bl)),t).then(function(t){return t?new Al(n,null,t.query):null}).then(function(t){return t?new vd(e,t):null})}var Od=(Ld.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},Ld.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},Ld.prototype.setServiceProps=function(t){return this.serviceProps=t,this},Ld.prototype.setInstanceCreatedCallback=function(t){return this.onInstanceCreated=t,this},Ld);function Ld(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}var Pd,Md,Fd={Firestore:Xp,GeoPoint:Xl,Timestamp:Xr,Blob:Qp,Transaction:nd,WriteBatch:rd,DocumentReference:ud,DocumentSnapshot:yd,Query:vd,QueryDocumentSnapshot:gd,QuerySnapshot:wd,CollectionReference:bd,FieldPath:D,FieldValue:T,setLogLevel:function(t){xr.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};(Pd=e.default).INTERNAL.registerComponent(new Od("firestore",function(t){var e=t.getProvider("app").getImmediate();return e=e,t=t.getProvider("auth-internal"),new Xp(e,new Bl(e,t),new Yp)},"PUBLIC").setServiceProps(Object.assign({},Fd))),Pd.registerVersion("@firebase/firestore","2.3.9"),(Md=Xp).prototype.loadBundle=Rd,Md.prototype.namedQuery=kd}.apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.memory.js - be sure to load firebase-app.js first.")}});
//# sourceMappingURL=firebase-firestore.memory.js.map
